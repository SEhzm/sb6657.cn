import{_ as H,h as w}from"./index.B7rbyhYE.js";import{b as _}from"./element-plus.BELI2msV.js";import{l as J,h as x,al as a,ar as K,c as r,o as i,a as m,K as Q,L as k,R as s,Q as C,a6 as I,J as l,O as d,P as p}from"./@vue.BltuATdo.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.BFvkXMb7.js";import"./@element-plus.D0bpsst8.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.BO4JNAXw.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const R={class:"image-list"},j={style:{"text-align":"center",padding:"0 0 5px 0"}},G={key:0,class:"comment-list"},W={class:"comment-content"},X={class:"comment-content"},Y={class:"comment-date"},Z={key:1,class:"card no-more",style:{"text-align":"center",color:"#999",margin:"20px 0"}},O={class:"dialog-footer"},h=20,ee={__name:"image",setup(te){(()=>{_({type:"success",dangerouslyUseHTMLString:!0,title:"照片可以评论喔",offset:100,duration:1500})})();const o=J({outerImg:[],id:"",imageId:"",Commentname:"",douyuId:"",dialogFormVisible:!1}),g=x(1),f=x(!0),v=x(!1),y=async()=>{if(!(v.value||!f.value)){v.value=!0;try{const t=await w.get("/machine/showImage",{params:{pageNum:g.value,pageSize:h}});(t.data.list.length<h||t.data.lastPage===!0)&&(f.value=!1),g.value===1?o.outerImg=t.data.list||[]:o.outerImg.push(...t.data.list),g.value++}catch(t){console.error("加载数据失败:",t)}finally{v.value=!1}}},b=()=>{y()};y();const V=t=>{t.showComments=!t.showComments},z=t=>new Date(t).toLocaleString(),D={Commentname:[{required:!0,message:"请输入评论",trigger:"blur"}]},F=t=>{o.imageId=t.id,_({title:"温馨提醒",message:"请注意你的行为，不要上传违反法律的内容，后台能监控到你",type:"warning"}),o.douyuID="",o.Commentname="",o.dialogFormVisible=!0},N=async t=>{if(t.Commentname==="")_.error("请输入评论");else try{const e=await w.post("/machine/addCommentname",{id:"",imageId:o.imageId,douyuID:t.douyuID,createdAt:"",commentname:t.Commentname});g.value=1,f.value=!0,await y(),_.success("评论成功"),o.dialogFormVisible=!1}catch(e){console.error("加载数据失败:",e)}};return(t,e)=>{const B=a("el-image"),c=a("el-button"),S=a("ArrowDownBold"),$=a("el-icon"),A=a("el-input"),L=a("el-form-item"),M=a("el-form"),U=a("el-dialog"),E=a("el-backtop"),P=K("infinite-scroll");return i(),r(C,null,[e[9]||(e[9]=m("div",{class:"outer"},[m("span",null,"主播相册"),m("span",{style:{"font-size":"16px"}},"(点击放大图片)"),m("em",{style:{"font-size":"14px"}},"如侵权，请右上角联系删除")],-1)),Q((i(),r("div",R,[(i(!0),r(C,null,I(o.outerImg,(n,T)=>(i(),r("div",{key:T,class:"image-block"},[s(B,{"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"hide-on-click-modal":!0,src:n.url,"preview-src-list":[n.url],fit:"cover",lazy:"",style:{width:"250px",height:"300px"}},null,8,["src","preview-src-list"]),m("div",j,[s(c,{style:{width:"230px","font-size":"16px","white-space":"normal","word-break":"break-word"}},{default:l(()=>[d(p(n.date),1)]),_:2},1024)]),s(c,{onClick:u=>V(n),style:{"font-size":"18px","margin-left":"15px","box-sizing":"border-box"}},{default:l(()=>[d(p(n.showComments?"隐藏评论":"显示评论("+n.comments.length+")"),1)]),_:2},1032,["onClick"]),n.showComments?(i(),r("div",G,[(i(!0),r(C,null,I(n.comments,(u,q)=>(i(),r("div",{key:q,class:"comment-item"},[m("span",W,p(u.douyuID)+" :",1),m("span",X,p(u.commentname),1),m("span",Y,p(z(u.createdAt)),1)]))),128))])):k("",!0),s(c,{type:"success",plain:"",onClick:u=>F(n),style:{"font-size":"18px","box-sizing":"border-box"}},{default:l(()=>[...e[5]||(e[5]=[d(" 我要评论 ",-1)])]),_:1},8,["onClick"])]))),128))])),[[P,b]]),f.value?(i(),r("div",{key:0,class:"card load-more",style:{"text-align":"center",cursor:"pointer",color:"orangered"},onClick:e[0]||(e[0]=n=>b())},[e[6]||(e[6]=d(" 加载更多",-1)),s($,null,{default:l(()=>[s(S)]),_:1})])):o.outerImg.length>0?(i(),r("div",Z," 没有更多图片了 ")):k("",!0),s(U,{modelValue:o.dialogFormVisible,"onUpdate:modelValue":e[4]||(e[4]=n=>o.dialogFormVisible=n),draggable:"",title:"评论"},{footer:l(()=>[m("div",O,[s(c,{onClick:e[2]||(e[2]=n=>o.dialogFormVisible=!1)},{default:l(()=>[...e[7]||(e[7]=[d("关闭",-1)])]),_:1}),s(c,{type:"primary",onClick:e[3]||(e[3]=n=>N(o))},{default:l(()=>[...e[8]||(e[8]=[d(" 评论并关闭 ",-1)])]),_:1})])]),default:l(()=>[s(M,{model:o,"label-width":"100px",rules:D,"label-position":"right"},{default:l(()=>[s(L,{label:"评论内容",prop:"Commentname"},{default:l(()=>[s(A,{modelValue:o.Commentname,"onUpdate:modelValue":e[1]||(e[1]=n=>o.Commentname=n),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(E,{right:20,bottom:50})],64)}}},Ce=H(ee,[["__scopeId","data-v-c230dbf4"]]);export{Ce as default};
