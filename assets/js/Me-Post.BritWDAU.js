import{a as L,y as K,f as O,d as U,L as j}from"./element-plus.DX6Kv4BD.js";import{_ as q,a as W,b as X,c as Y,C as Z}from"./sendPost.vue_vue_type_style_index_0_scoped_86d80eb7_lang.tpgU0Pl6.js";import{h as p,_ as ee}from"./index.D4OM2dW3.js";import{c as te}from"./setMeme.CXshki8K.js";import{a as ae}from"./clipboard.CdEJwdUj.js";import{b as ne}from"./vue-router.PTNpl1pN.js";import{d as se,b as l,f as oe,I as re,o as r,c,P as f,O as v,a4 as k,a,M as u,H as d,G as ce,K as C,L as B}from"./@vue.BqJqC78G.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.C-35htfh.js";import"./@element-plus.Du5FBV_q.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.D6RD0Zoz.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";const ie={class:"main-post"},le={class:"post-card-header"},ue=["src"],de={class:"post-user-name"},me={class:"post-meta"},pe={class:"post-createTime"},fe={style:{color:"black"}},ge=["onClick"],be={class:"post-content"},_e={key:0,class:"post-statements"},ye=["src"],he={class:"post-footer"},ve={class:"post-footer-meta"},ke={style:{display:"flex"}},Ce=["onClick"],Ne=["src"],Se={style:{cursor:"pointer"}},we=["onClick"],Me=["onClick"],xe=["onClick"],Pe={key:0},$=5,Le=se({__name:"Me-Post",setup(Be){const E=ne(),F=()=>{E.back()},N=l(new Map),g=l(new Map),S=l([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),_=l([]),m=l(new Map);l({});const w=l(1),M=l(!0),y=l(!1),T=async e=>{const n=await p.get(`/machine/Post/Comment/getComment/${e}`);N.value.set(e,n.data)},I=async e=>{g.value.get(e)||await T(e),g.value.set(e,!g.value.get(e))},x=async()=>{if(!(y.value||!M.value)){y.value=!0,console.log("Loading more posts...");try{const e=await p.get("/machine/Post/selectIsMePageList",{params:{pageNum:w.value,pageSize:$}});e.data.list.length<$&&(M.value=!1),_.value.push(...e.data.list),w.value++}catch{}finally{y.value=!1}}},V=e=>new Date(e).toLocaleString(),D=e=>`/src/assets/imgs/user-img-${Math.floor(Math.random()*5)}.png`,R=async e=>{if(m.value.has(e))return m.value.get(e);const i=(await p.get(`/machine/getBarrageInfo/${e}`)).data;return m.value.set(e,i),i};function P(e){e.likeFlag||p.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const A=(e,n)=>{const o={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];return!!o&&e[o]>0},J=(e,n)=>{const o={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];return o?e[o]:0},Q=e=>e?S.value.filter(n=>A(e,n.statementNum)):[];function G(e,n,i){const o=_.value.find(t=>t.id===i);if(!o||!o.postStatement)return;const b={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];b&&p.post("/machine/Post/Statement",{portId:e,postId:i,statementNum:n}).then(()=>{o.postStatement[b]++,L.success("表态成功")})}function H(e){e&&(ae(e.barrage),te(e.id.toString()).then(()=>{L.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return oe(()=>{x()}),(e,n)=>{const i=K,o=O,h=U,b=j;return re((r(),c("div",ie,[f(i,{onBack:F,class:"card",content:"我的帖子"}),(r(!0),c(v,null,k(_.value,t=>(r(),c("div",{key:t.id,class:"card post-card-main"},[a("div",null,[a("div",le,[a("img",{class:"user-img",src:D(t.userName),alt:""},null,8,ue),a("span",de,u(t.userName),1)]),a("div",me,[a("span",pe,u(V(t.createTime)),1),f(h,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:s=>R(t.barrageId)},{reference:d(()=>[t.barrage?(r(),ce(o,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:d(()=>[a("span",fe,"#烂梗："+u(t.barrage),1)]),_:2},1024)):C("",!0)]),default:d(()=>{var s;return[a("div",{style:{cursor:"pointer"},onClick:z=>H(m.value.get(t.barrageId))},u((s=m.value.get(t.barrageId))==null?void 0:s.barrage),9,ge)]}),_:2},1032,["onBeforeEnter"])])]),a("span",be,u(t.content),1),t.postStatement?(r(),c("div",_e,[(r(!0),c(v,null,k(Q(t.postStatement),s=>(r(),c("span",{key:s.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[f(o,{round:""},{default:d(()=>[a("img",{src:s.url},null,8,ye),a("span",null,u(J(t.postStatement,s.statementNum)),1)]),_:2},1024)]))),128))])):C("",!0),a("div",he,[a("div",ve,[f(h,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:d(()=>[a("div",ke,[(r(!0),c(v,null,k(S.value,s=>(r(),c("div",{key:s.statementNum,style:{"margin-right":"10px"}},[a("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:z=>G(t.id,s.statementNum,t.id)},[a("img",{style:{width:"30px",cursor:"pointer"},src:s.url},null,8,Ne),a("span",Se,u(s.name),1)],8,Ce)]))),128))])]),reference:d(()=>n[0]||(n[0]=[a("span",null,[a("img",{src:q}),B(" 表态")],-1)])),_:2},1024),a("span",{style:{cursor:"pointer"},onClick:s=>I(t.id)},[n[1]||(n[1]=a("img",{src:W},null,-1)),a("span",null," "+u(t.commentCount),1)],8,we),t.likeFlag?(r(),c("span",{key:0,style:{cursor:"not-allowed"},onClick:s=>P(t)},[n[2]||(n[2]=a("img",{src:X},null,-1)),a("span",null," "+u(t.postLike),1)],8,Me)):(r(),c("span",{key:1,style:{cursor:"pointer"},onClick:s=>P(t)},n[3]||(n[3]=[a("img",{src:Y},null,-1),B(" 赞 ")]),8,xe))]),g.value.get(t.id)?(r(),c("div",Pe,[f(Z,{comments:N.value.get(t.id)||[],"post-id":t.id},null,8,["comments","post-id"])])):C("",!0)])]))),128))])),[[b,x]])}}}),We=ee(Le,[["__scopeId","data-v-1b89b199"]]);export{We as default};
