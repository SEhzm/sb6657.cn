import{d as le,n as oe,c as ne,h as ae,k as fe,e as _e,b as $,v as ge,g as be,x as ye,f as he,K as we}from"./element-plus.BPmODNcd.js";import{r as p,bK as ke,ag as O,H as k,o as i,I as o,a as n,Q as a,M as c,c as _,P as j,a6 as A,K as M,O as w,d as Ce,k as xe,w as Te,J as Ve,u as Z,V as Ee}from"./@vue.Ca5AQEsS.js";import{u as Ue,b as $e}from"./vue-router.DhOS9MZH.js";import{_ as se,h as G,A as re,M as Me}from"./index.DkI5jqre.js";import{b as ee}from"./getMeme.CJu4h1c6.js";import{f as ze,t as Se}from"./flip-num.Bv2cXO95.js";import{c as De,l as Le,a as Fe}from"./clipboard.BNuoRXGs.js";import{c as te,p as Pe}from"./setMeme.BTroam5_.js";/* empty css                                                                 */import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@element-plus.De7neK-R.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";const Be={class:"preset-tags-container"},Ie={class:"preset-tags"},je=["src"],Ae={style:{"vertical-align":"middle"}},Re={class:"added-tags"},Ne={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(q){const m=p(""),C=p([]),x=p([]),v=p([]);function T(){G.get("/machine/dictList").then(r=>{r.code===200&&(C.value=r.data.map(t=>({iconUrl:t.iconUrl,label:t.dictLabel,value:t.dictValue})))})}T();const D=r=>{x.value=x.value.filter(t=>t.value!==r.value),v.value=v.value.filter(t=>t!==r.value),C.value.push(r)},b=r=>{if(v.value.length>=5){$.info("最多5个标签");return}x.value.some(t=>t.value===r.value)||(x.value.push(r),v.value.push(r.value),C.value=C.value.filter(t=>t.value!==r.value))},z=()=>{if(v.value.length===0||m.value===""||m.value===null)$.error("请选择标签或输入弹幕");else{if(v.value.length>5){$.error("最少一个标签，最多五个标签。");return}G.post(re.SUBMIT_MEME,{tags:v.value.join(","),barrage:m.value}).then(r=>{m.value="",r.code===200?$.success("投稿成功，待审核(一天内)"):r.code===500?$.error("烂梗已经有了，勿重复提交"):$.error("请求失败")}).catch(r=>{console.error("投稿失败",r),$.error("请求失败")})}},V=ke(q,"modelValue");return(r,t)=>{const f=O("Warning"),y=oe,E=le,H=O("QuestionFilled"),L=ne,R=ae,N=fe,F=_e;return i(),k(F,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=d=>V.value=d),draggable:"",title:"投稿烂梗",width:"82%"},{footer:o(()=>[a(L,{type:"plain",onClick:t[1]||(t[1]=d=>V.value=!1)},{default:o(()=>t[13]||(t[13]=[c("关闭")])),_:1,__:[13]}),a(L,{type:"primary",onClick:z},{default:o(()=>t[14]||(t[14]=[c("投稿")])),_:1,__:[14]})]),default:o(()=>[n("h4",null,[t[10]||(t[10]=c("可选标签")),a(E,{width:300},{reference:o(()=>[a(y,{size:"16"},{default:o(()=>[a(f)]),_:1})]),default:o(()=>[t[3]||(t[3]=c(" 为解决烂梗分栏不足和分类不清晰问题。")),t[4]||(t[4]=n("br",null,null,-1)),t[5]||(t[5]=n("b",null,"点击标签即可添加",-1))]),_:1,__:[3,4,5]}),a(L,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[t[9]||(t[9]=c("投稿标签 ")),a(E,{width:300},{reference:o(()=>[a(y,{size:"16"},{default:o(()=>[a(H)]),_:1})]),default:o(()=>[t[6]||(t[6]=n("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),t[7]||(t[7]=n("br",null,null,-1)),t[8]||(t[8]=n("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1,__:[6,7,8]})]),_:1,__:[9]})]),n("div",Be,[n("div",Ie,[(i(!0),_(j,null,A(C.value,(d,S)=>(i(),k(R,{round:"",key:S,closable:"",onClose:P=>b(d),onClick:P=>b(d),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[d.iconUrl?(i(),_("img",{key:0,src:d.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,je)):M("",!0),n("span",Ae,w(d.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),n("h4",null,[t[12]||(t[12]=c("已选标签 ")),a(E,{width:300},{reference:o(()=>[a(y,{size:"16"},{default:o(()=>[a(f)]),_:1})]),default:o(()=>[t[11]||(t[11]=n("b",null,"最少一个标签，最多五个标签。",-1))]),_:1,__:[11]})]),n("div",Re,[(i(!0),_(j,null,A(x.value,(d,S)=>(i(),k(R,{round:"",key:S,closable:"",onClick:P=>D(d),onClose:P=>D(d),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[c(w(d.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),a(N,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=d=>m.value=d),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Qe=se(Ne,[["__scopeId","data-v-093bb159"]]),We={class:"memes-view"},Ke={class:"card-table"},Oe={key:0,class:"card"},Ge={class:"preset-tags-container"},He={class:"preset-tags"},Je=["src"],qe={style:{"vertical-align":"middle"}},Xe={class:"added-tags"},Ye=["src"],Ze={style:{"vertical-align":"middle"}},et={class:"top"},tt=["onTouchstart","onTouchend"],lt={class:"barrage-text"},ot={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},nt=["src"],at={style:{"vertical-align":"middle"}},st={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},rt={class:"pagination-wrapper"},K=50,it=Ce({__name:"memes-view",setup(q){const m=Ue(),C=$e(),x=xe(()=>(f.value=[],Me.find(l=>l.path===m.path))),v=p(!0),T=p([]),D=p(0),b=p(1),z=p(!1),V=p([]),r=p([]),t=p([]),f=p([]);async function y(l){var U;const e=(U=x.value)==null?void 0:U.category;if(!e){C.push("/404");return}let u;console.log(f.value.join(",")),f.value.length==0?u=await ee(e,l,K):u=await ee(e,l,K,f.value.join(",")),T.value=u.memeArr,console.log(T.value),D.value=u.total,v.value=!1}y(1);async function E(l){S(),G.get(re.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:K,tags:`${f.value}`}}).then(e=>{z.value=!0,T.value=e.data.list.map(u=>({total:u.total,content:u.barrage,id:u.id,copyCount:+u.cnt,tags:u.tags}))}).catch(e=>{T.value=[]})}Te(()=>m.path,()=>{console.log("当前页面path:",m.path),z.value=!1,b.value=1,v.value=!0,y(1)});const H=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=l=>{b.value=l,H(),z.value==!1?y(l):E(l)},R=Se(Fe,Le,2e3);async function N(l){const e=l.content,u=R(e);if(!(!u||u==="limitedSuccess")){if(De(),z.value==!0){if(await te("allbarrage",l.id,b.value)){await E(b.value);return}}else if(await te(l.category,l.id,b.value)){await y(b.value);return}Pe()}}const F=p(!1),d=()=>{F.value=!0},S=()=>{G.get("/machine/dictList").then(l=>{l.code===200&&(V.value=l.data,r.value=l.data.map(e=>({iconUrl:e.iconUrl,label:e.dictLabel,value:e.dictValue})))}).catch(l=>{console.error("获取字典数据失败",l)})},P=l=>{if(!l||l.trim()==="")return[];const e=Array.from(new Set(l.split(",").map(g=>g.trim())));if(!V.value)return e.map(()=>({label:"",iconUrl:""}));const u=new Map(V.value.map(g=>[String(g.dictValue).trim(),g]));return e.map(g=>{const B=u.get(g);return B?{label:B.dictLabel,iconUrl:B.iconUrl}:{label:"",iconUrl:""}})};S();const X=l=>{t.value=t.value.filter(e=>e.value!==l.value),f.value=f.value.filter(e=>e!==l.value),r.value.push(l),y(1)},Y=l=>{t.value.some(e=>e.value===l.value)||(t.value.push(l),f.value.push(l.value),r.value=r.value.filter(e=>e.value!==l.value)),console.log(f.value),y(1)},ie=l=>{l.touchStartTime=Date.now()},ue=l=>{Date.now()-l.touchStartTime>100&&(l.popoverVisible=!0,setTimeout(()=>{l.popoverVisible=!1},1500))},de=l=>l?l.replace("T"," ").split(".")[0]:"";return(l,e)=>{const u=O("Warning"),U=oe,g=le,B=O("QuestionFilled"),Q=ne,W=ae,J=be,ce=he,pe=we,me=ye,ve=ge;return i(),_("div",We,[n("div",Ke,[Z(m).path==="/memes/AllBarrage"?(i(),_("div",Oe,[n("h4",null,[e[9]||(e[9]=c("按标签查看烂梗")),a(g,{width:300},{reference:o(()=>[a(U,{size:"16"},{default:o(()=>[a(u)]),_:1})]),default:o(()=>[e[2]||(e[2]=c(" 为解决烂梗分栏不足和分类不清晰问题。")),e[3]||(e[3]=n("br",null,null,-1)),e[4]||(e[4]=n("b",null,"点击标签即可添加",-1))]),_:1,__:[2,3,4]}),a(Q,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[e[8]||(e[8]=c("投稿标签 ")),a(g,{width:300},{reference:o(()=>[a(U,{size:"16"},{default:o(()=>[a(B)]),_:1})]),default:o(()=>[e[5]||(e[5]=n("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=n("br",null,null,-1)),e[7]||(e[7]=n("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1,__:[5,6,7]})]),_:1,__:[8]})]),n("div",Ge,[n("div",He,[(i(!0),_(j,null,A(r.value,(s,h)=>(i(),k(W,{round:"",key:h,closable:"",onClose:I=>Y(s),onClick:I=>Y(s),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[s.iconUrl?(i(),_("img",{key:0,src:s.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,Je)):M("",!0),n("span",qe,w(s.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),n("h4",null,[e[11]||(e[11]=c("包含标签 ")),a(g,null,{reference:o(()=>[a(U,{size:"16"},{default:o(()=>[a(u)]),_:1})]),default:o(()=>[e[10]||(e[10]=n("b",null,"烂梗包含该标签",-1))]),_:1,__:[10]})]),n("div",Xe,[(i(!0),_(j,null,A(t.value,(s,h)=>(i(),k(W,{round:"",key:h,closable:"",onClick:I=>X(s),onClose:I=>X(s),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[s.iconUrl?(i(),_("img",{key:0,src:s.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Ye)):M("",!0),n("span",Ze,w(s.label),1)]),_:2},1032,["onClick","onClose"]))),128))])])):M("",!0),n("div",et,[e[14]||(e[14]=n("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),a(Q,{type:"primary",onClick:d},{default:o(()=>e[12]||(e[12]=[c("烂梗投稿")])),_:1,__:[12]}),Z(m).path==="/memes/AllBarrage"?(i(),k(Q,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=s=>E(1))},{default:o(()=>e[13]||(e[13]=[c("按复制次数排序")])),_:1,__:[13]})):M("",!0)]),Ve((i(),k(ce,{class:"main-table",data:T.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:N},{default:o(()=>[a(J,{align:"center",width:"60"},{default:o(s=>[a(W,{round:"",effect:"plain"},{default:o(()=>[c(w(s.row.id),1)]),_:2},1024)]),_:1}),a(J,{prop:"content"},{default:o(s=>[a(g,{placement:"top",width:"auto",trigger:"hover",visible:s.row.popoverVisible},{reference:o(()=>[n("div",{style:{cursor:"pointer"},onTouchstart:h=>ie(s.row),onTouchend:h=>ue(s.row)},[n("span",lt,w(s.row.content),1)],40,tt)]),default:o(()=>[n("div",ot,[(i(!0),_(j,null,A(P(s.row.tags),(h,I)=>(i(),_("div",{key:I,style:{"margin-right":"8px"}},[a(W,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:o(()=>[h.iconUrl?(i(),_("img",{key:0,src:h.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,nt)):M("",!0),n("span",at,w(h.label),1)]),_:2},1024)]))),128)),n("span",st,"投稿时间: "+w(de(s.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),a(J,{align:"center",width:"100"},{default:o(s=>[a(Q,{type:"primary",class:"copy-btn",onClick:Ee(h=>N(s.row),["stop"])},{default:o(()=>[e[15]||(e[15]=c("复制 🌈")),a(ze,{num:s.row.copyCount},null,8,["num"])]),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,v.value]]),n("div",rt,[v.value?M("",!0):(i(),k(pe,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":b.value,total:D.value,"pager-count":4,"page-size":K,onCurrentChange:L},null,8,["current-page","total"]))])]),a(Qe,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=s=>F.value=s)},null,8,["modelValue"]),a(me,{right:50,bottom:50},{default:o(()=>e[16]||(e[16]=[c("UP")])),_:1,__:[16]})])}}}),zt=se(it,[["__scopeId","data-v-00a8ee1b"]]);export{zt as default};
