import{d as ae,j as ne,c as se,h as ie,n as fe,q as _e,e as ge,b as M,v as be,g as he,A as ye,f as we,l as ke}from"./element-plus.BExUxls1.js";import{r as p,bK as Ce,al as X,I as C,o as r,J as a,a as o,R as n,O as c,c as v,Q as N,a6 as R,L as z,P as h,d as xe,j as Te,w as Ve,K as $e,u as te,W as Ee}from"./@vue.kiFpFjC4.js";import{u as Ue,b as Me}from"./vue-router.DfLJYrxF.js";import{_ as re,h as Q,A as ue,M as ze}from"./index.BSBuSj8x.js";import{c as le}from"./getMeme.CwQUZfU8.js";import{f as De,t as Se}from"./flip-num.C3f5vQru.js";import{c as Le,a as oe,p as Ie,l as Pe,b as Fe}from"./setMeme.Ct3L-y2E.js";import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.DR1wJ5Y1.js";import"./@element-plus.CD6l22se.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";import"./pinia.C1jrEj6N.js";import"./axios.NIGUFBhG.js";import"./js-cookie.Cz0CWeBA.js";const Be={class:"preset-tags-container"},je={class:"preset-tags"},Ae={class:"tag-icon-wrapper"},Ne=["src"],Re={style:{"vertical-align":"middle"}},Qe={class:"added-tags"},We={class:"footer-container"},Ke={class:"match-section"},Oe={key:0,class:"match-details-box"},qe={class:"match-info-row"},Ge=["src","alt"],Je={class:"match-name"},He={class:"match-time"},Xe={key:1,class:"no-match-info"},Ye={class:"button-group"},Ze={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(ee){const _=p(""),x=p([]),T=p([]),g=p([]);function D(){Q.get("/machine/dictList").then(s=>{s.code===200&&(x.value=s.data.map(t=>({iconUrl:t.iconUrl,label:t.dictLabel,value:t.dictValue})))})}D();const m=p(null);function w(){Q.get("/machine/InProgressMatch").then(s=>{s.code===200&&s.data?m.value=s.data:m.value=null})}w();const V=s=>{T.value=T.value.filter(t=>t.value!==s.value),g.value=g.value.filter(t=>t!==s.value),x.value.push(s)},S=s=>{if(g.value.length>=5){M.info("最多5个标签");return}T.value.some(t=>t.value===s.value)||(T.value.push(s),g.value.push(s.value),x.value=x.value.filter(t=>t.value!==s.value))},$=()=>{if(g.value.length===0||_.value===""||_.value===null)M.error("请选择标签或输入弹幕");else{if(g.value.length>5){M.error("最少一个标签，最多五个标签。");return}const s={tags:g.value.join(","),barrage:_.value};f.value&&m.value&&(s.matchId=m.value.id),Q.post(ue.SUBMIT_MEME,s).then(t=>{_.value="",f.value=!1,t.code===200?M.success("投稿成功，待审核(一天内)"):t.code===500?M.error("烂梗已经有了，勿重复提交"):M.error("请求失败")}).catch(t=>{console.error("投稿失败",t),M.error("请求失败")})}},k=Ce(ee,"modelValue"),f=p(!1);return(s,t)=>{const W=X("Warning"),L=ne,I=ae,P=X("QuestionFilled"),E=se,K=ie,O=fe,Y=_e,q=ge;return r(),C(q,{modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=u=>k.value=u),draggable:"",title:"投稿烂梗",width:"82%"},{footer:a(()=>[o("div",We,[o("div",Ke,[n(Y,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=u=>f.value=u),disabled:!m.value,class:"match-checkbox"},{default:a(()=>[t[13]||(t[13]=c(" 关联赛事库 ",-1)),n(L,{color:"#3db302ff",size:"16"},{default:a(()=>[n(P)]),_:1})]),_:1},8,["modelValue","disabled"]),m.value?(r(),v("div",Oe,[o("div",qe,[o("img",{src:m.value.matchesImg,class:"match-image",alt:m.value.matchesName},null,8,Ge),o("span",Je,h(m.value.matchesName),1)]),o("div",He,h(m.value.startTime)+" 至 "+h(m.value.endTime),1)])):(r(),v("div",Xe," 当前无正在进行的大型赛事 "))]),o("div",Ye,[n(E,{plain:"",onClick:t[2]||(t[2]=u=>k.value=!1)},{default:a(()=>[...t[14]||(t[14]=[c("关闭",-1)])]),_:1}),n(E,{type:"primary",onClick:$},{default:a(()=>[...t[15]||(t[15]=[c("投稿",-1)])]),_:1})])])]),default:a(()=>[o("h4",null,[t[10]||(t[10]=c("可选标签",-1)),n(I,{width:300},{reference:a(()=>[n(L,{size:"16"},{default:a(()=>[n(W)]),_:1})]),default:a(()=>[t[4]||(t[4]=c(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[5]||(t[5]=o("br",null,null,-1)),t[6]||(t[6]=o("b",null,"点击标签即可添加",-1))]),_:1}),n(E,{link:"",type:"success",style:{"margin-left":"50%"}},{default:a(()=>[t[9]||(t[9]=c("投稿标签 ",-1)),n(I,{width:300},{reference:a(()=>[n(L,{size:"16"},{default:a(()=>[n(P)]),_:1})]),default:a(()=>[t[7]||(t[7]=o("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[8]||(t[8]=o("br",null,null,-1))]),_:1})]),_:1})]),o("div",Be,[o("div",je,[(r(!0),v(N,null,R(x.value,(u,F)=>(r(),C(K,{round:"",key:F,closable:"",onClose:B=>S(u),onClick:B=>S(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:a(()=>[o("div",Ae,[u.iconUrl?(r(),v("img",{key:0,src:u.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Ne)):z("",!0),o("span",Re,h(u.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),o("h4",null,[t[12]||(t[12]=c("已选标签 ",-1)),n(I,{width:300},{reference:a(()=>[n(L,{size:"16"},{default:a(()=>[n(W)]),_:1})]),default:a(()=>[t[11]||(t[11]=o("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),o("div",Qe,[(r(!0),v(N,null,R(T.value,(u,F)=>(r(),C(K,{round:"",key:F,closable:"",onClick:B=>V(u),onClose:B=>V(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:a(()=>[c(h(u.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),n(O,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=u=>_.value=u),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},et=re(Ze,[["__scopeId","data-v-0d9dea11"]]),tt={class:"memes-view"},lt={class:"card-table"},ot={key:0,class:"card"},at={class:"preset-tags-container"},nt={class:"preset-tags"},st={class:"tag-icon-wrapper"},it=["src"],rt={style:{"vertical-align":"middle"}},ut={class:"added-tags"},dt={class:"tag-icon-wrapper"},ct=["src"],pt={style:{"vertical-align":"middle"}},mt={class:"top"},vt=["onTouchstart","onTouchend"],ft={class:"barrage-text"},_t={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},gt={class:"tag-icon-wrapper"},bt=["src"],ht={style:{"vertical-align":"middle"}},yt={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},wt={class:"pagination-wrapper"},H=50,kt=xe({__name:"memes-view",setup(ee){const _=Ue(),x=Me(),T=Te(()=>(f.value=[],ze.find(l=>l.path===_.path))),g=p(!0),D=p([]),m=p(0),w=p(1),V=p(!1),S=p([]),$=p([]),k=p([]),f=p([]);async function s(l){var U;const e=(U=T.value)==null?void 0:U.category;if(!e){x.push("/404");return}let d;f.value.length==0?d=await le(e,l,H):d=await le(e,l,H,f.value.join(",")),D.value=d.memeArr,m.value=d.total,g.value=!1}s(1);async function t(l){O(),Q.get(ue.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:H,tags:`${f.value}`}}).then(e=>{V.value=!0,D.value=e.data.list.map(d=>({total:d.total,content:d.barrage,id:d.id,copyCount:+d.cnt,tags:d.tags}))}).catch(e=>{D.value=[]})}Ve(()=>_.path,()=>{console.log("当前页面path:",_.path),V.value=!1,w.value=1,g.value=!0,s(1)});const W=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=l=>{w.value=l,W(),V.value==!1?s(l):t(l)},I=Se(Fe,Pe,2e3);async function P(l){const e=l.content,d=I(e);if(!(!d||d==="limitedSuccess")){if(Le(),V.value==!0){if(await oe("allbarrage",l.id,w.value)){await t(w.value);return}}else if(await oe(l.category,l.id,w.value)){await s(w.value);return}Ie()}}const E=p(!1),K=()=>{E.value=!0},O=()=>{Q.get("/machine/dictList").then(l=>{l.code===200&&(S.value=l.data,$.value=l.data.map(e=>({iconUrl:e.iconUrl,label:e.dictLabel,value:e.dictValue})))}).catch(l=>{console.error("获取字典数据失败",l)})},Y=l=>{if(!l||l.trim()==="")return[];const e=Array.from(new Set(l.split(",").map(b=>b.trim())));if(!S.value)return e.map(()=>({label:"",iconUrl:""}));const d=new Map(S.value.map(b=>[String(b.dictValue).trim(),b]));return e.map(b=>{const j=d.get(b);return j?{label:j.dictLabel,iconUrl:j.iconUrl}:{label:"",iconUrl:""}})};O();const q=l=>{k.value=k.value.filter(e=>e.value!==l.value),f.value=f.value.filter(e=>e!==l.value),$.value.push(l),s(1)},u=l=>{k.value.some(e=>e.value===l.value)||(k.value.push(l),f.value.push(l.value),$.value=$.value.filter(e=>e.value!==l.value)),console.log(f.value),s(1)},F=l=>{l.touchStartTime=Date.now()},B=l=>{Date.now()-l.touchStartTime>100&&(l.popoverVisible=!0,setTimeout(()=>{l.popoverVisible=!1},1500))},de=l=>l?l.replace("T"," ").split(".")[0]:"";return(l,e)=>{const d=X("Warning"),U=ne,b=ae,j=X("QuestionFilled"),G=se,J=ie,Z=he,ce=we,pe=ke,me=ye,ve=be;return r(),v("div",tt,[o("div",lt,[te(_).path==="/memes/AllBarrage"?(r(),v("div",ot,[o("h4",null,[e[9]||(e[9]=c("按标签查看烂梗",-1)),n(b,{width:300},{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(d)]),_:1})]),default:a(()=>[e[2]||(e[2]=c(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),e[3]||(e[3]=o("br",null,null,-1)),e[4]||(e[4]=o("b",null,"点击标签即可添加",-1))]),_:1}),n(G,{link:"",type:"success",style:{"margin-left":"50%"}},{default:a(()=>[e[8]||(e[8]=c("投稿标签 ",-1)),n(b,{width:300},{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(j)]),_:1})]),default:a(()=>[e[5]||(e[5]=o("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=o("br",null,null,-1)),e[7]||(e[7]=o("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),o("div",at,[o("div",nt,[(r(!0),v(N,null,R($.value,(i,y)=>(r(),C(J,{round:"",key:y,closable:"",onClose:A=>u(i),onClick:A=>u(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:a(()=>[o("div",st,[i.iconUrl?(r(),v("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,it)):z("",!0),o("span",rt,h(i.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),o("h4",null,[e[11]||(e[11]=c("包含标签 ",-1)),n(b,null,{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(d)]),_:1})]),default:a(()=>[e[10]||(e[10]=o("b",null,"烂梗包含该标签",-1))]),_:1})]),o("div",ut,[(r(!0),v(N,null,R(k.value,(i,y)=>(r(),C(J,{round:"",key:y,closable:"",onClick:A=>q(i),onClose:A=>q(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:a(()=>[o("div",dt,[i.iconUrl?(r(),v("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,ct)):z("",!0),o("span",pt,h(i.label),1)])]),_:2},1032,["onClick","onClose"]))),128))])])):z("",!0),o("div",mt,[e[14]||(e[14]=o("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),n(G,{type:"primary",onClick:K},{default:a(()=>[...e[12]||(e[12]=[c("烂梗投稿",-1)])]),_:1}),te(_).path==="/memes/AllBarrage"?(r(),C(G,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=i=>t(1))},{default:a(()=>[...e[13]||(e[13]=[c("按复制次数排序",-1)])]),_:1})):z("",!0)]),$e((r(),C(ce,{class:"main-table",data:D.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:P},{default:a(()=>[n(Z,{align:"center",width:"60"},{default:a(i=>[n(J,{round:"",effect:"plain"},{default:a(()=>[c(h(i.row.id),1)]),_:2},1024)]),_:1}),n(Z,{prop:"content"},{default:a(i=>[n(b,{placement:"top",width:"auto",trigger:"hover",visible:i.row.popoverVisible},{reference:a(()=>[o("div",{style:{cursor:"pointer"},onTouchstart:y=>F(i.row),onTouchend:y=>B(i.row)},[o("span",ft,h(i.row.content),1)],40,vt)]),default:a(()=>[o("div",_t,[(r(!0),v(N,null,R(Y(i.row.tags),(y,A)=>(r(),v("div",{key:A,style:{"margin-right":"8px"}},[n(J,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:a(()=>[o("div",gt,[y.iconUrl?(r(),v("img",{key:0,src:y.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,bt)):z("",!0),o("span",ht,h(y.label),1)])]),_:2},1024)]))),128)),o("span",yt,"投稿时间: "+h(de(i.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),n(Z,{align:"center",width:"100"},{default:a(i=>[n(G,{type:"primary",class:"copy-btn",onClick:Ee(y=>P(i.row),["stop"])},{default:a(()=>[e[15]||(e[15]=c("复制 🌈",-1)),n(De,{num:i.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,g.value]]),o("div",wt,[g.value?z("",!0):(r(),C(pe,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":w.value,total:m.value,"pager-count":4,"page-size":H,onCurrentChange:L},null,8,["current-page","total"]))])]),n(et,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=i=>E.value=i)},null,8,["modelValue"]),n(me,{right:50,bottom:50},{default:a(()=>[...e[16]||(e[16]=[c("UP",-1)])]),_:1})])}}}),Qt=re(kt,[["__scopeId","data-v-594d1d91"]]);export{Qt as default};
