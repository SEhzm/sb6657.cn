import{h as m,bK as ce,al as d,I as C,o as r,J as n,a as o,R as a,O as p,c as f,Q as R,a6 as Q,L as S,P as y,d as pe,i as me,j as ve,ar as fe,K as _e,u as te,W as ge}from"./@vue.BltuATdo.js";import{u as be,b as he}from"./vue-router.oDprkwHL.js";import{_ as ne,h as W,A as ae,M as ye}from"./index.D_rqf7g3.js";import{c as le}from"./getMeme.B0pj2zOi.js";import{t as we}from"./throttle.DXAb9wGD.js";import{c as ke,l as xe,a as Ce}from"./clipboard.DZJChlsd.js";import{c as oe,p as Te}from"./setMeme.DvJXX_F3.js";import{b as D}from"./element-plus.DQRrSmQa.js";import{f as Ve}from"./flip-num.CJ6pvVU4.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./@element-plus.BgPfl9pw.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const $e={class:"preset-tags-container"},Ue={class:"preset-tags"},Me={class:"tag-icon-wrapper"},ze=["src"],De={style:{"vertical-align":"middle"}},Se={class:"added-tags"},Ee={class:"footer-container"},Le={class:"match-section"},Fe={key:0,class:"match-details-box"},Ie={class:"match-info-row"},Pe=["src","alt"],je={class:"match-name"},Ae={class:"match-time"},Be={key:1,class:"no-match-info"},Ne={class:"button-group"},Re={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(ee){const g=m(""),T=m([]),V=m([]),b=m([]);function E(){W.get("/machine/dictList").then(s=>{s.code===200&&(T.value=s.data.map(t=>({iconUrl:t.iconUrl,label:t.dictLabel,value:t.dictValue})))})}E();const v=m(null);function k(){W.get("/machine/InProgressMatch").then(s=>{s.code===200&&s.data?v.value=s.data:v.value=null})}k();const $=s=>{V.value=V.value.filter(t=>t.value!==s.value),b.value=b.value.filter(t=>t!==s.value),T.value.push(s)},L=s=>{if(b.value.length>=5){D.info("最多5个标签");return}V.value.some(t=>t.value===s.value)||(V.value.push(s),b.value.push(s.value),T.value=T.value.filter(t=>t.value!==s.value))},U=()=>{if(b.value.length===0||g.value===""||g.value===null)D.error("请选择标签或输入弹幕");else{if(b.value.length>5){D.error("最少一个标签，最多五个标签。");return}const s={tags:b.value.join(","),barrage:g.value};_.value&&v.value&&(s.matchId=v.value.id),W.post(ae.SUBMIT_MEME,s).then(t=>{g.value="",_.value=!1,t.code===200?D.success("投稿成功，待审核(一天内)"):t.code===500?D.error("烂梗已经有了，勿重复提交"):D.error("请求失败")}).catch(t=>{console.error("投稿失败",t),D.error("请求失败")})}},x=ce(ee,"modelValue"),_=m(!1);return(s,t)=>{const K=d("Warning"),F=d("el-icon"),I=d("el-popover"),P=d("QuestionFilled"),M=d("el-button"),O=d("el-tag"),G=d("el-input"),Y=d("el-checkbox"),J=d("el-dialog");return r(),C(J,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=u=>x.value=u),draggable:"",title:"投稿烂梗",width:"82%"},{footer:n(()=>[o("div",Ee,[o("div",Le,[a(Y,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=u=>_.value=u),disabled:!v.value,class:"match-checkbox"},{default:n(()=>[t[13]||(t[13]=p(" 关联赛事库 ",-1)),a(F,{color:"#3db302ff",size:"16"},{default:n(()=>[a(P)]),_:1})]),_:1},8,["modelValue","disabled"]),v.value?(r(),f("div",Fe,[o("div",Ie,[o("img",{src:v.value.matchesImg,class:"match-image",alt:v.value.matchesName},null,8,Pe),o("span",je,y(v.value.matchesName),1)]),o("div",Ae,y(v.value.startTime)+" 至 "+y(v.value.endTime),1)])):(r(),f("div",Be," 当前无正在进行的大型赛事 "))]),o("div",Ne,[a(M,{plain:"",onClick:t[2]||(t[2]=u=>x.value=!1)},{default:n(()=>[...t[14]||(t[14]=[p("关闭",-1)])]),_:1}),a(M,{type:"primary",onClick:U},{default:n(()=>[...t[15]||(t[15]=[p("投稿",-1)])]),_:1})])])]),default:n(()=>[o("h4",null,[t[10]||(t[10]=p("可选标签",-1)),a(I,{width:300},{reference:n(()=>[a(F,{size:"16"},{default:n(()=>[a(K)]),_:1})]),default:n(()=>[t[4]||(t[4]=p(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[5]||(t[5]=o("br",null,null,-1)),t[6]||(t[6]=o("b",null,"点击标签即可添加",-1))]),_:1}),a(M,{link:"",type:"success",style:{"margin-left":"50%"}},{default:n(()=>[t[9]||(t[9]=p("投稿标签 ",-1)),a(I,{width:300},{reference:n(()=>[a(F,{size:"16"},{default:n(()=>[a(P)]),_:1})]),default:n(()=>[t[7]||(t[7]=o("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[8]||(t[8]=o("br",null,null,-1))]),_:1})]),_:1})]),o("div",$e,[o("div",Ue,[(r(!0),f(R,null,Q(T.value,(u,j)=>(r(),C(O,{round:"",key:j,closable:"",onClose:A=>L(u),onClick:A=>L(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:n(()=>[o("div",Me,[u.iconUrl?(r(),f("img",{key:0,src:u.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,ze)):S("",!0),o("span",De,y(u.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),o("h4",null,[t[12]||(t[12]=p("已选标签 ",-1)),a(I,{width:300},{reference:n(()=>[a(F,{size:"16"},{default:n(()=>[a(K)]),_:1})]),default:n(()=>[t[11]||(t[11]=o("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),o("div",Se,[(r(!0),f(R,null,Q(V.value,(u,j)=>(r(),C(O,{round:"",key:j,closable:"",onClick:A=>$(u),onClose:A=>$(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:n(()=>[p(y(u.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),a(G,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=u=>g.value=u),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Qe=ne(Re,[["__scopeId","data-v-0d9dea11"]]),We={class:"memes-view"},Ke={class:"card-table"},Oe={key:0,class:"card"},Ge={class:"preset-tags-container"},Je={class:"preset-tags"},qe={class:"tag-icon-wrapper"},He=["src"],Xe={style:{"vertical-align":"middle"}},Ye={class:"added-tags"},Ze={class:"tag-icon-wrapper"},et=["src"],tt={style:{"vertical-align":"middle"}},lt={class:"top"},ot=["onTouchstart","onTouchend"],nt={class:"barrage-text"},at={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},st={class:"tag-icon-wrapper"},it=["src"],rt={style:{"vertical-align":"middle"}},ut={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},dt={class:"pagination-wrapper"},X=50,ct=pe({__name:"memes-view",setup(ee){const g=be(),T=he(),V=me(()=>(_.value=[],ye.find(l=>l.path===g.path))),b=m(!0),E=m([]),v=m(0),k=m(1),$=m(!1),L=m([]),U=m([]),x=m([]),_=m([]);async function s(l){var z;const e=(z=V.value)==null?void 0:z.category;if(!e){T.push("/404");return}let c;_.value.length==0?c=await le(e,l,X):c=await le(e,l,X,_.value.join(",")),E.value=c.memeArr,v.value=c.total,b.value=!1}s(1);async function t(l){G(),W.get(ae.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:X,tags:`${_.value}`}}).then(e=>{$.value=!0,E.value=e.data.list.map(c=>({total:c.total,content:c.barrage,id:c.id,copyCount:+c.cnt,tags:c.tags}))}).catch(e=>{E.value=[]})}ve(()=>g.path,()=>{console.log("当前页面path:",g.path),$.value=!1,k.value=1,b.value=!0,s(1)});const K=()=>{window.scrollTo({top:0,behavior:"smooth"})},F=l=>{k.value=l,K(),$.value==!1?s(l):t(l)},I=we(Ce,xe,2e3);async function P(l){const e=l.content,c=I(e);if(!(!c||c==="limitedSuccess")){if(ke(),$.value==!0){if(await oe("allbarrage",l.id,k.value)){await t(k.value);return}}else if(await oe(l.category,l.id,k.value)){await s(k.value);return}Te()}}const M=m(!1),O=()=>{M.value=!0},G=()=>{W.get("/machine/dictList").then(l=>{l.code===200&&(L.value=l.data,U.value=l.data.map(e=>({iconUrl:e.iconUrl,label:e.dictLabel,value:e.dictValue})))}).catch(l=>{console.error("获取字典数据失败",l)})},Y=l=>{if(!l||l.trim()==="")return[];const e=Array.from(new Set(l.split(",").map(h=>h.trim())));if(!L.value)return e.map(()=>({label:"",iconUrl:""}));const c=new Map(L.value.map(h=>[String(h.dictValue).trim(),h]));return e.map(h=>{const B=c.get(h);return B?{label:B.dictLabel,iconUrl:B.iconUrl}:{label:"",iconUrl:""}})};G();const J=l=>{x.value=x.value.filter(e=>e.value!==l.value),_.value=_.value.filter(e=>e!==l.value),U.value.push(l),s(1)},u=l=>{x.value.some(e=>e.value===l.value)||(x.value.push(l),_.value.push(l.value),U.value=U.value.filter(e=>e.value!==l.value)),console.log(_.value),s(1)},j=l=>{l.touchStartTime=Date.now()},A=l=>{Date.now()-l.touchStartTime>100&&(l.popoverVisible=!0,setTimeout(()=>{l.popoverVisible=!1},1500))},se=l=>l?l.replace("T"," ").split(".")[0]:"";return(l,e)=>{const c=d("Warning"),z=d("el-icon"),h=d("el-popover"),B=d("QuestionFilled"),q=d("el-button"),H=d("el-tag"),Z=d("el-table-column"),ie=d("el-table"),re=d("el-pagination"),ue=d("el-backtop"),de=fe("loading");return r(),f("div",We,[o("div",Ke,[te(g).path==="/memes/AllBarrage"?(r(),f("div",Oe,[o("h4",null,[e[9]||(e[9]=p("按标签查看烂梗",-1)),a(h,{width:300},{reference:n(()=>[a(z,{size:"16"},{default:n(()=>[a(c)]),_:1})]),default:n(()=>[e[2]||(e[2]=p(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),e[3]||(e[3]=o("br",null,null,-1)),e[4]||(e[4]=o("b",null,"点击标签即可添加",-1))]),_:1}),a(q,{link:"",type:"success",style:{"margin-left":"50%"}},{default:n(()=>[e[8]||(e[8]=p("投稿标签 ",-1)),a(h,{width:300},{reference:n(()=>[a(z,{size:"16"},{default:n(()=>[a(B)]),_:1})]),default:n(()=>[e[5]||(e[5]=o("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=o("br",null,null,-1)),e[7]||(e[7]=o("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),o("div",Ge,[o("div",Je,[(r(!0),f(R,null,Q(U.value,(i,w)=>(r(),C(H,{round:"",key:w,closable:"",onClose:N=>u(i),onClick:N=>u(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:n(()=>[o("div",qe,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,He)):S("",!0),o("span",Xe,y(i.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),o("h4",null,[e[11]||(e[11]=p("包含标签 ",-1)),a(h,null,{reference:n(()=>[a(z,{size:"16"},{default:n(()=>[a(c)]),_:1})]),default:n(()=>[e[10]||(e[10]=o("b",null,"烂梗包含该标签",-1))]),_:1})]),o("div",Ye,[(r(!0),f(R,null,Q(x.value,(i,w)=>(r(),C(H,{round:"",key:w,closable:"",onClick:N=>J(i),onClose:N=>J(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:n(()=>[o("div",Ze,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,et)):S("",!0),o("span",tt,y(i.label),1)])]),_:2},1032,["onClick","onClose"]))),128))])])):S("",!0),o("div",lt,[e[14]||(e[14]=o("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),a(q,{type:"primary",onClick:O},{default:n(()=>[...e[12]||(e[12]=[p("烂梗投稿",-1)])]),_:1}),te(g).path==="/memes/AllBarrage"?(r(),C(q,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=i=>t(1))},{default:n(()=>[...e[13]||(e[13]=[p("按复制次数排序",-1)])]),_:1})):S("",!0)]),_e((r(),C(ie,{class:"main-table",data:E.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:P},{default:n(()=>[a(Z,{align:"center",width:"60"},{default:n(i=>[a(H,{round:"",effect:"plain"},{default:n(()=>[p(y(i.row.id),1)]),_:2},1024)]),_:1}),a(Z,{prop:"content"},{default:n(i=>[a(h,{placement:"top",width:"auto",trigger:"hover",visible:i.row.popoverVisible},{reference:n(()=>[o("div",{style:{cursor:"pointer"},onTouchstart:w=>j(i.row),onTouchend:w=>A(i.row)},[o("span",nt,y(i.row.content),1)],40,ot)]),default:n(()=>[o("div",at,[(r(!0),f(R,null,Q(Y(i.row.tags),(w,N)=>(r(),f("div",{key:N,style:{"margin-right":"8px"}},[a(H,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:n(()=>[o("div",st,[w.iconUrl?(r(),f("img",{key:0,src:w.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,it)):S("",!0),o("span",rt,y(w.label),1)])]),_:2},1024)]))),128)),o("span",ut,"投稿时间: "+y(se(i.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),a(Z,{align:"center",width:"100"},{default:n(i=>[a(q,{type:"primary",class:"copy-btn",onClick:ge(w=>P(i.row),["stop"])},{default:n(()=>[e[15]||(e[15]=p("复制 🌈",-1)),a(Ve,{num:i.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,b.value]]),o("div",dt,[b.value?S("",!0):(r(),C(re,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":k.value,total:v.value,"pager-count":5,"page-size":X,onCurrentChange:F},null,8,["current-page","total"]))])]),a(Qe,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=i=>M.value=i)},null,8,["modelValue"]),a(ue,{right:50,bottom:50},{default:n(()=>[...e[16]||(e[16]=[p("UP",-1)])]),_:1})])}}}),Lt=ne(ct,[["__scopeId","data-v-f549a4c3"]]);export{Lt as default};
