import{K as oe,f as se,g as ne,h as le,d as re,c as ie,v as ce,e as ue,a as y,n as de,A as me}from"./element-plus.nxJ_dmmw.js";import{d as pe,r as l,i as _e,c as h,o as u,a,Q as s,P as I,a6 as $,I as n,J as he,H as L,M as k,O as r,K as j,V as ge,u as E}from"./@vue.Ca5AQEsS.js";import{S as ve,n as A}from"./@element-plus.BuV21Ltw.js";import{h as M,_ as fe}from"./index.utDwpXjE.js";import{f as be,t as ye}from"./flip-num.CWYDkYJ0.js";import{c as we,l as Ce,a as Te}from"./clipboard.NKcdiyUV.js";import{c as xe,p as Se}from"./setMeme.BSJmRP6q.js";import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.DhOS9MZH.js";const ze={class:"match-library"},Le={class:"match-list"},ke={class:"card-content"},Ee={class:"image-container"},Me=["src"],Ve={class:"match-info"},Pe={class:"match-header"},Ue={class:"match-name"},Be={class:"match-details"},De={class:"match-location"},Ne={class:"match-time"},Ie={class:"time-item"},$e={class:"time-item"},je={class:"pagination-container"},Ae={class:"memes-view"},Ke={class:"card-table"},Fe=["onTouchstart","onTouchend"],He={class:"barrage-text"},Je={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Oe=["src"],Qe={style:{"vertical-align":"middle"}},Re={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},qe={class:"pagination-wrapper"},Ge=pe({__name:"matchLib",setup(We){const V=l([]),P=l(0),g=l(1),v=l(10),w=l(!1),f=l(null),U=l([]),b=l(!1),B=l(0),C=l(50),_=l(1),T=l([]),K=ye(Te,Ce,2e3),x=async()=>{try{const e=await M.get("/machine/getMatchList",{params:{pageNum:g.value,pageSize:v.value}});e.code===200?(V.value=e.data.list,P.value=e.data.total):y.error(e.msg||"获取赛事列表失败")}catch(e){y.error("获取赛事列表失败"),console.error("获取赛事列表失败:",e)}},F=e=>{v.value=e,x()},H=e=>{g.value=e,x()},J=e=>{f.value=e,w.value=!0,_.value=1,S(1)},S=async e=>{if(f.value){b.value=!0;try{const o=await M.get("/machine/matchPageList",{params:{pageNum:e,pageSize:C.value,matchId:f.value.id}});o.code===200?(U.value=o.data.list,B.value=o.data.total):y.error(o.msg||"获取烂梗列表失败")}catch(o){y.error("获取烂梗列表失败"),console.error("获取烂梗列表失败:",o)}finally{b.value=!1}}},D=async e=>{const o=e.barrage,i=K(o);if(!(!i||i==="limitedSuccess")){we();try{if(await xe("match",e.id,_.value,C.value)){await S(_.value);return}}catch(m){console.error("复制次数+1失败:",m)}Se()}},O=e=>{_.value=e,S(e)},Q=e=>{if(!e||e.trim()==="")return[];const o=Array.from(new Set(e.split(",").map(c=>c.trim())));if(!T.value)return o.map(()=>({label:"",iconUrl:""}));const i=new Map(T.value.map(c=>[String(c.dictValue).trim(),c]));return o.map(c=>{const p=i.get(c);return p?{label:p.dictLabel,iconUrl:p.iconUrl}:{label:"",iconUrl:""}})},R=()=>{M.get("/machine/dictList").then(e=>{e.code===200&&(T.value=e.data)}).catch(e=>{console.error("获取字典数据失败",e)})},q=e=>{e.touchStartTime=Date.now()},G=e=>{Date.now()-e.touchStartTime>100&&(e.popoverVisible=!0,setTimeout(()=>{e.popoverVisible=!1},1500))},W=e=>e?e.replace("T"," ").split(".")[0]:"";return _e(()=>{R(),x()}),(e,o)=>{var N;const i=le,m=de,c=me,p=oe,z=ne,X=re,Y=ie,Z=se,ee=ue,te=ce;return u(),h("div",ze,[o[4]||(o[4]=a("div",{class:"card"},[a("span",null,"投稿时勾选关联赛事库将加入某一赛事创作的烂梗，目前只收录大型赛事")],-1)),a("div",Le,[(u(!0),h(I,null,$(V.value,t=>(u(),L(c,{key:t.id,class:"match-card","body-style":{padding:"0px"},onClick:d=>J(t)},{default:n(()=>[a("div",ke,[a("div",Ee,[a("img",{src:t.matchesImg,class:"match-image"},null,8,Me)]),a("div",Ve,[a("div",Pe,[a("h3",Ue,r(t.matchesName),1),s(i,{size:"small",type:"success",class:"match-level"},{default:n(()=>[k(r(t.level),1)]),_:2},1024)]),a("div",Be,[a("div",De,[s(m,null,{default:n(()=>[s(E(ve))]),_:1}),a("span",null,r(t.matchesLocation),1)]),a("div",Ne,[a("div",Ie,[s(m,null,{default:n(()=>[s(E(A))]),_:1}),a("span",null,"开始："+r(t.startTime),1)]),a("div",$e,[s(m,null,{default:n(()=>[s(E(A))]),_:1}),a("span",null,"结束："+r(t.endTime),1)])])])])])]),_:2},1032,["onClick"]))),128))]),a("div",je,[s(p,{"current-page":g.value,"onUpdate:currentPage":o[0]||(o[0]=t=>g.value=t),"page-size":v.value,"onUpdate:pageSize":o[1]||(o[1]=t=>v.value=t),"page-sizes":[10,20,30,50],total:P.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:H},null,8,["current-page","page-size","total"])]),s(ee,{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=t=>w.value=t),title:(N=f.value)==null?void 0:N.matchesName,width:"80%",class:"match-dialog","destroy-on-close":""},{default:n(()=>[a("div",Ae,[a("div",Ke,[he((u(),L(Z,{data:U.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"暂无烂梗，快来投稿吧！",onRowClick:D},{default:n(()=>[s(z,{align:"center",width:"60"},{default:n(t=>[s(i,{round:"",effect:"plain"},{default:n(()=>[k(r(t.row.id),1)]),_:2},1024)]),_:1}),s(z,{prop:"barrage"},{default:n(t=>[s(X,{placement:"top",width:"auto",trigger:"hover",visible:t.row.popoverVisible},{reference:n(()=>[a("div",{style:{cursor:"pointer"},onTouchstart:d=>q(t.row),onTouchend:d=>G(t.row)},[a("span",He,r(t.row.barrage),1)],40,Fe)]),default:n(()=>[a("div",Je,[(u(!0),h(I,null,$(Q(t.row.tags),(d,ae)=>(u(),h("div",{key:ae,style:{"margin-right":"8px"}},[s(i,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:n(()=>[d.iconUrl?(u(),h("img",{key:0,src:d.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Oe)):j("",!0),a("span",Qe,r(d.label),1)]),_:2},1024)]))),128)),a("span",Re," 投稿时间: "+r(W(t.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),s(z,{align:"center",width:"100"},{default:n(t=>[s(Y,{type:"primary",class:"copy-btn",onClick:ge(d=>D(t.row),["stop"])},{default:n(()=>[o[3]||(o[3]=k(" 复制 🌈")),s(be,{num:t.row.cnt},null,8,["num"])]),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,b.value]]),a("div",qe,[b.value?j("",!0):(u(),L(p,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":_.value,total:B.value,"pager-count":4,"page-size":C.value,onCurrentChange:O},null,8,["current-page","total","page-size"]))])])])]),_:1},8,["modelValue","title"])])}}}),vt=fe(Ge,[["__scopeId","data-v-81d6bc22"]]);export{vt as default};
