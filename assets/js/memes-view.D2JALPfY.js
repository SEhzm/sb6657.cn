import{h as v,bK as de,al as u,I as x,o as r,J as o,a as l,R as a,O as c,c as f,Q as j,a6 as B,L as M,P as b,d as ce,i as pe,j as me,ar as ve,K as fe,u as J,W as _e}from"./@vue.BltuATdo.js";import{u as ge,b as be}from"./vue-router.BFvkXMb7.js";import{_ as le,h as Y,A as oe,M as he}from"./index.BBPI_FUE.js";import{u as se,g as ye,e as we,d as ee}from"./time.yw2YJldh.js";import{f as ke,t as xe}from"./flip-num.DuAjaOkv.js";import{c as Ce,a as te,p as Te,l as $e,b as Ve}from"./setMeme.CmUlZ5JG.js";import{b as V}from"./element-plus.BELI2msV.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./@element-plus.D0bpsst8.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.BO4JNAXw.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const Me={class:"preset-tags-container"},Ue={class:"preset-tags"},ze={class:"tag-icon-wrapper"},Se=["src"],De={style:{"vertical-align":"middle"}},Ee={class:"added-tags"},Fe={class:"footer-container"},Pe={class:"match-section"},Ie={key:0,class:"match-details-box"},Le={class:"match-info-row"},je=["src","alt"],Be={class:"match-name"},Ae={class:"match-time"},Ne={key:1,class:"no-match-info"},Re={class:"button-group"},Qe={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(Z){const U=se(),_=v(""),C=v([]),T=v([]),g=v([]);U.tagsLoaded.then(()=>{C.value=U.memeTags.map(n=>({iconUrl:n.iconUrl,label:n.dictLabel,value:n.dictValue}))});const p=v(null);function A(){Y.get("/machine/InProgressMatch").then(n=>{n.code===200&&n.data?p.value=n.data:p.value=null})}A();const h=n=>{T.value=T.value.filter(e=>e.value!==n.value),g.value=g.value.filter(e=>e!==n.value),C.value.push(n)},$=n=>{if(g.value.length>=5){V.info("最多5个标签");return}T.value.some(e=>e.value===n.value)||(T.value.push(n),g.value.push(n.value),C.value=C.value.filter(e=>e.value!==n.value))},N=()=>{if(g.value.length===0||_.value===""||_.value===null)V.error("请选择标签或输入弹幕");else{if(g.value.length>5){V.error("最少一个标签，最多五个标签。");return}const n={tags:g.value.join(","),barrage:_.value};y.value&&p.value&&(n.matchId=p.value.id),Y.post(oe.SUBMIT_MEME,n).then(e=>{_.value="",y.value=!1,e.code===200?V.success("投稿成功，待审核(一天内)"):e.code===500?V.error("烂梗已经有了，勿重复提交"):V.error("请求失败")}).catch(e=>{console.error("投稿失败",e),V.error("请求失败")})}},k=de(Z,"modelValue"),y=v(!1);return(n,e)=>{const z=u("Warning"),S=u("el-icon"),P=u("el-popover"),R=u("QuestionFilled"),D=u("el-button"),E=u("el-tag"),H=u("el-input"),Q=u("el-checkbox"),W=u("el-dialog");return r(),x(W,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=d=>k.value=d),draggable:"",title:"投稿烂梗",width:"82%"},{footer:o(()=>[l("div",Fe,[l("div",Pe,[a(Q,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=d=>y.value=d),disabled:!p.value,class:"match-checkbox"},{default:o(()=>[e[13]||(e[13]=c(" 关联赛事库 ",-1)),a(S,{color:"#3db302ff",size:"16"},{default:o(()=>[a(R)]),_:1})]),_:1},8,["modelValue","disabled"]),p.value?(r(),f("div",Ie,[l("div",Le,[l("img",{src:p.value.matchesImg,class:"match-image",alt:p.value.matchesName},null,8,je),l("span",Be,b(p.value.matchesName),1)]),l("div",Ae,b(p.value.startTime)+" 至 "+b(p.value.endTime),1)])):(r(),f("div",Ne," 当前无正在进行的大型赛事 "))]),l("div",Re,[a(D,{plain:"",onClick:e[2]||(e[2]=d=>k.value=!1)},{default:o(()=>[...e[14]||(e[14]=[c("关闭",-1)])]),_:1}),a(D,{type:"primary",onClick:N},{default:o(()=>[...e[15]||(e[15]=[c("投稿",-1)])]),_:1})])])]),default:o(()=>[l("h4",null,[e[10]||(e[10]=c("可选标签",-1)),a(P,{width:300},{reference:o(()=>[a(S,{size:"16"},{default:o(()=>[a(z)]),_:1})]),default:o(()=>[e[4]||(e[4]=c(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),e[5]||(e[5]=l("br",null,null,-1)),e[6]||(e[6]=l("b",null,"点击标签即可添加",-1))]),_:1}),a(D,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[e[9]||(e[9]=c("投稿标签 ",-1)),a(P,{width:300},{reference:o(()=>[a(S,{size:"16"},{default:o(()=>[a(R)]),_:1})]),default:o(()=>[e[7]||(e[7]=l("b",null,"请在上方(建议/提交)问卷投稿。",-1)),e[8]||(e[8]=l("br",null,null,-1))]),_:1})]),_:1})]),l("div",Me,[l("div",Ue,[(r(!0),f(j,null,B(C.value,(d,I)=>(r(),x(E,{round:"",key:I,closable:"",onClose:s=>$(d),onClick:s=>$(d),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[l("div",ze,[d.iconUrl?(r(),f("img",{key:0,src:d.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Se)):M("",!0),l("span",De,b(d.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),l("h4",null,[e[12]||(e[12]=c("已选标签 ",-1)),a(P,{width:300},{reference:o(()=>[a(S,{size:"16"},{default:o(()=>[a(z)]),_:1})]),default:o(()=>[e[11]||(e[11]=l("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),l("div",Ee,[(r(!0),f(j,null,B(T.value,(d,I)=>(r(),x(E,{round:"",key:I,closable:"",onClick:s=>h(d),onClose:s=>h(d),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[c(b(d.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),a(H,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=d=>_.value=d),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},We=le(Qe,[["__scopeId","data-v-6cb563de"]]),Ke={class:"memes-view"},Oe={class:"card-table"},Ge={key:0,class:"card"},Je={class:"preset-tags-container"},qe={class:"preset-tags"},He={class:"tag-icon-wrapper"},Xe=["src"],Ye={style:{"vertical-align":"middle"}},Ze={class:"added-tags"},et={class:"tag-icon-wrapper"},tt=["src"],lt={style:{"vertical-align":"middle"}},ot={class:"top"},st=["onTouchstart","onTouchend"],at={class:"barrage-text"},nt={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},it={class:"tag-icon-wrapper"},rt=["src"],ut={style:{"vertical-align":"middle"}},dt={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},ct={class:"pagination-wrapper"},q=50,pt=ce({__name:"memes-view",setup(Z){const U=se(),_=ge(),C=be(),T=pe(()=>(n.value=[],he.find(s=>s.path===_.path))),g=v(!0),p=v([]),A=v(0),h=v(1),$=v(!1),N=v([]),k=v([]),y=v([]),n=v([]);async function e(s){var F;const t=(F=T.value)==null?void 0:F.category;if(!t){C.push("/404");return}let m;n.value.length==0?m=await ee(t,s,q):m=await ee(t,s,q,n.value.join(",")),p.value=m.memeArr,A.value=m.total,g.value=!1}e(1);async function z(s){Y.get(oe.GET_SORTED_ALL_MEME,{params:{pageNum:s,pageSize:q,tags:`${n.value}`}}).then(t=>{$.value=!0,p.value=t.data.list.map(m=>({total:m.total,content:m.barrage,id:m.id,copyCount:+m.cnt,tags:m.tags}))}).catch(t=>{p.value=[]})}me(()=>_.path,()=>{console.log("当前页面path:",_.path),$.value=!1,h.value=1,g.value=!0,e(1)});const S=()=>{window.scrollTo({top:0,behavior:"smooth"})},P=s=>{h.value=s,S(),$.value==!1?e(s):z(s)},R=xe(Ve,$e,2e3);async function D(s){const t=s.content,m=R(t);if(!(!m||m==="limitedSuccess")){if(Ce(),$.value==!0){if(await te("allbarrage",s.id,h.value)){await z(h.value);return}}else if(await te(s.category,s.id,h.value)){await e(h.value);return}Te()}}const E=v(!1),H=()=>{E.value=!0};U.tagsLoaded.then(()=>{N.value=U.memeTags,k.value=U.memeTags.map(s=>({iconUrl:s.iconUrl,label:s.dictLabel,value:s.dictValue}))});const Q=s=>{y.value=y.value.filter(t=>t.value!==s.value),n.value=n.value.filter(t=>t!==s.value),k.value.push(s),e(1)},W=s=>{y.value.some(t=>t.value===s.value)||(y.value.push(s),n.value.push(s.value),k.value=k.value.filter(t=>t.value!==s.value)),console.log(n.value),e(1)},d=s=>{s.touchStartTime=Date.now()},I=s=>{Date.now()-s.touchStartTime>100&&(s.popoverVisible=!0,setTimeout(()=>{s.popoverVisible=!1},1500))};return(s,t)=>{const m=u("Warning"),F=u("el-icon"),K=u("el-popover"),ae=u("QuestionFilled"),O=u("el-button"),G=u("el-tag"),X=u("el-table-column"),ne=u("el-table"),ie=u("el-pagination"),re=u("el-backtop"),ue=ve("loading");return r(),f("div",Ke,[l("div",Oe,[J(_).path==="/memes/AllBarrage"?(r(),f("div",Ge,[l("h4",null,[t[9]||(t[9]=c("按标签查看烂梗",-1)),a(K,{width:300},{reference:o(()=>[a(F,{size:"16"},{default:o(()=>[a(m)]),_:1})]),default:o(()=>[t[2]||(t[2]=c(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[3]||(t[3]=l("br",null,null,-1)),t[4]||(t[4]=l("b",null,"点击标签即可添加",-1))]),_:1}),a(O,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[t[8]||(t[8]=c("投稿标签 ",-1)),a(K,{width:300},{reference:o(()=>[a(F,{size:"16"},{default:o(()=>[a(ae)]),_:1})]),default:o(()=>[t[5]||(t[5]=l("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),t[6]||(t[6]=l("br",null,null,-1)),t[7]||(t[7]=l("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),l("div",Je,[l("div",qe,[(r(!0),f(j,null,B(k.value,(i,w)=>(r(),x(G,{round:"",key:w,closable:"",onClose:L=>W(i),onClick:L=>W(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[l("div",He,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,Xe)):M("",!0),l("span",Ye,b(i.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),l("h4",null,[t[11]||(t[11]=c("包含标签 ",-1)),a(K,null,{reference:o(()=>[a(F,{size:"16"},{default:o(()=>[a(m)]),_:1})]),default:o(()=>[t[10]||(t[10]=l("b",null,"烂梗包含该标签",-1))]),_:1})]),l("div",Ze,[(r(!0),f(j,null,B(y.value,(i,w)=>(r(),x(G,{round:"",key:w,closable:"",onClick:L=>Q(i),onClose:L=>Q(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[l("div",et,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,tt)):M("",!0),l("span",lt,b(i.label),1)])]),_:2},1032,["onClick","onClose"]))),128))])])):M("",!0),l("div",ot,[t[14]||(t[14]=l("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),a(O,{type:"primary",onClick:H},{default:o(()=>[...t[12]||(t[12]=[c("烂梗投稿",-1)])]),_:1}),J(_).path==="/memes/AllBarrage"?(r(),x(O,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:t[0]||(t[0]=i=>z(1))},{default:o(()=>[...t[13]||(t[13]=[c("按复制次数排序",-1)])]),_:1})):M("",!0)]),fe((r(),x(ne,{class:"main-table",data:p.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:D},{default:o(()=>[a(X,{align:"center",width:"60"},{default:o(i=>[a(G,{round:"",effect:"plain"},{default:o(()=>[c(b(i.row.id),1)]),_:2},1024)]),_:1}),a(X,{prop:"content"},{default:o(i=>[a(K,{placement:"top",width:"auto",trigger:"hover",visible:i.row.popoverVisible},{reference:o(()=>[l("div",{style:{cursor:"pointer"},onTouchstart:w=>d(i.row),onTouchend:w=>I(i.row)},[l("span",at,b(i.row.content),1)],40,st)]),default:o(()=>[l("div",nt,[(r(!0),f(j,null,B(J(ye)(i.row.tags,N.value),(w,L)=>(r(),f("div",{key:L,style:{"margin-right":"8px"}},[a(G,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:o(()=>[l("div",it,[w.iconUrl?(r(),f("img",{key:0,src:w.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,rt)):M("",!0),l("span",ut,b(w.label),1)])]),_:2},1024)]))),128)),l("span",dt,"投稿时间: "+b(J(we)(i.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),a(X,{align:"center",width:"100"},{default:o(i=>[a(O,{type:"primary",class:"copy-btn",onClick:_e(w=>D(i.row),["stop"])},{default:o(()=>[t[15]||(t[15]=c("复制 🌈",-1)),a(ke,{num:i.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,g.value]]),l("div",ct,[g.value?M("",!0):(r(),x(ie,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":h.value,total:A.value,"pager-count":5,"page-size":q,onCurrentChange:P},null,8,["current-page","total"]))])]),a(We,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=i=>E.value=i)},null,8,["modelValue"]),a(re,{right:50,bottom:50},{default:o(()=>[...t[16]||(t[16]=[c("UP",-1)])]),_:1})])}}}),Et=le(pt,[["__scopeId","data-v-19f2be40"]]);export{Et as default};
