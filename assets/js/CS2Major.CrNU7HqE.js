import{a as x,c as ne,v as ce,M as me,n as ue,L as ve}from"./element-plus.BdlBqtfi.js";import{d as F,b as u,e as J,c,a as s,P as k,H as g,u as q,M as f,n as he,o as m,C as I,V as M,O as ee,a4 as se,k as de,i as re,I as ge,L as H,K as w,S as pe}from"./@vue.Dx4vSINt.js";import{d as L}from"./vuedraggable.BDINTPbw.js";import{_ as Q,h as Z,u as fe}from"./index.ygwy8ISN.js";import{u as _e}from"./vue-router.Cp0X7YIN.js";import{R as be}from"./@element-plus.DM5O92_U.js";import{h as Te}from"./html2canvas.BfYXEYrK.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.BhPyfUAB.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.hUPcw3xl.js";import"./vue.BdDluSGr.js";import"./pinia.CgDIJrih.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";const ke={class:"major-predict-root"},ye={class:"team-pool"},$e=["src","alt"],Ce={class:"team-name"},we={class:"predict-area"},Ve={class:"predict-row"},Ie={class:"predict-block"},Pe={class:"predict-label"},qe=["src","alt"],Se={class:"team-name"},Le=["onClick","disabled"],De={class:"predict-block"},Me={class:"predict-label"},je=["src","alt"],Ee={class:"team-name"},Ae=["onClick","disabled"],Be={class:"predict-row advance-row"},Re={class:"advance-label"},Ue=["src","alt"],Ne={class:"team-name"},We=["onClick","disabled"],Oe=F({name:"MatchPredictionBase"}),xe=F({...Oe,props:{teams:{},firstLabel:{},secondLabel:{},advanceLabel:{},maxAdvance:{},isTimeValid:{type:Boolean}},setup(U,{expose:z}){const p=U,R={name:"teams"},v=u([]),b=u([]),_=u([]),T=u([]);J(()=>p.teams,t=>{v.value=[...t]},{immediate:!0});function D(t){const o=t.draggedContext.element;return t.from&&!t.from.classList.contains("team-list")&&t.to.classList.contains("predict-slot")?!0:!(S(o.id)||b.value.length>=2)}function P(t){const o=t.draggedContext.element;return t.from&&!t.from.classList.contains("team-list")&&t.to.classList.contains("predict-slot")?!0:!(S(o.id)||_.value.length>=2)}function V(t){const o=t.draggedContext.element;return!E(t.from)&&t.to.classList.contains("predict-slot")?!0:!S(o.id)}function E(t){return t&&t.classList&&t.classList.contains("team-list")}function S(t){return b.value.some(o=>o.id===t)||_.value.some(o=>o.id===t)||T.value.some(o=>o.id===t)}function j(t){if(t.added){const o=t.added.element,l=t.added.newIndex??0;if(t.from&&!t.from.classList.contains("team-list")){const d=b.value[l];d&&(b.value.splice(l,1,o),v.value.push(d))}else if(b.value.length>=2){const d=b.value[l];d&&(b.value.splice(l,1,o),v.value.push(d))}else b.value.splice(l,0,o);if(b.value.length>2){const d=b.value.splice(2);v.value.push(...d)}_.value=_.value.filter(d=>d.id!==o.id),T.value=T.value.filter(d=>d.id!==o.id)}h()}function N(t){if(t.added){const o=t.added.element,l=t.added.newIndex??0;if(t.from&&!t.from.classList.contains("team-list")){const d=_.value[l];d&&(_.value.splice(l,1,o),v.value.push(d))}else if(_.value.length>=2){const d=_.value[l];d&&(_.value.splice(l,1,o),v.value.push(d))}else _.value.splice(l,0,o);if(_.value.length>2){const d=_.value.splice(2);v.value.push(...d)}b.value=b.value.filter(d=>d.id!==o.id),T.value=T.value.filter(d=>d.id!==o.id)}h()}function A(t){if(t.added){const o=t.added.element;if(!t.from.classList.contains("team-list")&&t.added.newIndex!==void 0){const l=T.value[t.added.newIndex];l&&(T.value.splice(t.added.newIndex,1,o),v.value.push(l))}else if(T.value.length>p.maxAdvance){const l=t.added.newIndex??0,d=T.value[l];d&&(T.value.splice(l,1,o),v.value.push(d))}b.value=b.value.filter(l=>l.id!==o.id),_.value=_.value.filter(l=>l.id!==o.id)}h()}function B(t,o){let l;t==="first"?l=b.value.splice(o,1):l=_.value.splice(o,1),v.value.push(...l),h()}function W(t){const o=T.value.splice(t,1);v.value.push(...o),h()}function h(){he(()=>{const t=[...b.value.map(o=>o.id),..._.value.map(o=>o.id),...T.value.map(o=>o.id)];v.value=v.value.filter(o=>!t.includes(o.id))})}return z({firstTeam:b,secondTeam:_,advanceTeams:T}),(t,o)=>(m(),c("div",ke,[s("div",ye,[k(q(L),{list:v.value,group:R,sort:!1,"item-key":"id",class:"team-list","ghost-class":"ghost",disabled:!t.isTimeValid},{item:g(({element:l})=>[(m(),c("div",{class:I(["team-card",{disabled:!t.isTimeValid}]),key:l.id},[s("img",{src:l.logo,alt:l.name,class:"team-logo"},null,8,$e),s("div",Ce,f(l.name),1)],2))]),_:1},8,["list","disabled"])]),s("div",we,[s("div",Ve,[s("div",Ie,[s("div",Pe,f(t.firstLabel),1),k(q(L),{list:b.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:D,onChange:j,disabled:!t.isTimeValid},{item:g(({element:l,index:d})=>[(m(),c("div",{class:I(["team-card selected big",{disabled:!t.isTimeValid}]),key:l.id},[s("img",{src:l.logo,alt:l.name,class:"team-logo big"},null,8,qe),s("div",Se,f(l.name),1),s("button",{class:"remove-btn",onClick:M(y=>B("first",d),["stop"]),disabled:!t.isTimeValid},"×",8,Le)],2))]),footer:g(()=>[(m(!0),c(ee,null,se(Math.max(0,2-b.value.length),l=>(m(),c("div",{key:l,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])]),s("div",De,[s("div",Me,f(t.secondLabel),1),k(q(L),{list:_.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:P,onChange:N,disabled:!t.isTimeValid},{item:g(({element:l,index:d})=>[(m(),c("div",{class:I(["team-card selected big",{disabled:!t.isTimeValid}]),key:l.id},[s("img",{src:l.logo,alt:l.name,class:"team-logo big"},null,8,je),s("div",Ee,f(l.name),1),s("button",{class:"remove-btn",onClick:M(y=>B("second",d),["stop"]),disabled:!t.isTimeValid},"×",8,Ae)],2))]),footer:g(()=>[(m(!0),c(ee,null,se(Math.max(0,2-_.value.length),l=>(m(),c("div",{key:l,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])])]),s("div",Be,[s("div",Re,f(t.advanceLabel),1),k(q(L),{list:T.value,group:R,sort:!0,"item-key":"id",class:"predict-slot multi big","ghost-class":"ghost",move:V,onChange:A,disabled:!t.isTimeValid},{item:g(({element:l,index:d})=>[(m(),c("div",{class:I(["team-card selected big",{disabled:!t.isTimeValid}]),key:l.id},[s("img",{src:l.logo,alt:l.name,class:"team-logo big"},null,8,Ue),s("div",Ne,f(l.name),1),s("button",{class:"remove-btn",onClick:M(y=>W(d),["stop"]),disabled:!t.isTimeValid},"×",8,We)],2))]),footer:g(()=>[(m(!0),c(ee,null,se(Math.max(0,t.maxAdvance-T.value.length),l=>(m(),c("div",{key:l,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])])])]))}}),ze=Q(xe,[["__scopeId","data-v-bdb02c33"]]),te={getMatchTeams(U,z){return Z.get(`/machine/matches/${U}/teams`,{params:{phase:z}})},submitPrediction(U){return Z.post("/machine/prediction/submit",U)},getUserPredictions(U){return Z.get("/machine/prediction/records",{params:{matchId:U.matchId,phase:U.phase}})}},Fe={class:"major-phase","element-loading-text":"加载队伍数据中..."},Ge={class:"title"},He={class:"save-button"},Ke=F({name:"MajorPhase"}),Ze=F({...Ke,props:{isTimeValid:{type:Boolean},matchId:{},phase:{}},setup(U,{expose:z}){const p=U,R=de(()=>({onePhase:"第一阶段",twoPhase:"第二阶段",threePhase:"第三阶段"})[p.phase]),v=fe(),b=u(),_=u([]),T=u([]),D=u([]),P=u([]),V=u(!1),E=u(!1),j=((h,t)=>{let o=null;return function(...l){o&&clearTimeout(o),o=setTimeout(()=>{h.apply(this,l),o=null},t)}})(()=>{p.isTimeValid&&(console.log("触发防抖保存..."),W())},300);J(b,h=>{h&&J([()=>h.firstTeam,()=>h.secondTeam,()=>h.advanceTeams],([t,o,l])=>{_.value=[...t],T.value=[...o],D.value=[...l],!V.value&&!E.value&&p.isTimeValid&&j()},{deep:!0})},{immediate:!0});const N=async()=>{try{V.value=!0,console.log(`获取${R.value}队伍数据，matchId:`,p.matchId);const h=await te.getMatchTeams(p.matchId,p.phase);console.log("获取到的原始数据:",h.data),P.value=h.data.map(t=>({id:t.id,name:t.teamName,logo:t.teamImgUrl})),console.log("处理后的队伍数据:",P.value)}catch(h){console.error("获取队伍数据失败:",h),x.error("获取队伍数据失败")}finally{V.value=!1}},A=async()=>{var h;if(!p.matchId){console.warn("matchId未设置，跳过获取预测数据");return}try{E.value=!0,V.value=!0,P.value.length===0&&await N();const t=await te.getUserPredictions({matchId:p.matchId,phase:p.phase,userId:v.userId});if(t.data){let o=Array.isArray(t.data)?t.data[0]:t.data;const l=new Set;if(o.sl){const d=o.sl.split(","),y=P.value.filter($=>d.includes($.id.toString()));_.value=y,y.forEach($=>l.add($.id.toString()))}if(o.ls){const d=o.ls.split(","),y=P.value.filter($=>d.includes($.id.toString()));T.value=y,y.forEach($=>l.add($.id.toString()))}if(o.advance){const d=o.advance.split(","),y=P.value.filter($=>d.includes($.id.toString()));D.value=y,y.forEach($=>l.add($.id.toString()))}P.value=P.value.filter(d=>!l.has(d.id.toString())),b.value&&(b.value.firstTeam=[..._.value],b.value.secondTeam=[...T.value],b.value.advanceTeams=[...D.value])}else console.log("未找到用户之前的预测数据")}catch(t){if(((h=t.response)==null?void 0:h.status)===401){console.log("用户未登录，跳过获取预测数据");return}console.error("获取预测数据失败:",t),x.error("获取预测数据失败")}finally{V.value=!1,setTimeout(()=>{E.value=!1},100)}},B=()=>{const h=[];return _.value.length!==2&&h.push("请选择2支3-0队伍"),T.value.length!==2&&h.push("请选择2支0-3队伍"),D.value.length!==6&&h.push("请选择6支晋级队伍"),h},W=async()=>{var t;const h=B();h.length>0&&x.warning(h.join(`
`));try{const o={matchId:p.matchId,phase:p.phase,s_l:_.value.map(d=>d.id.toString()).join(","),l_s:T.value.map(d=>d.id.toString()).join(","),advance:D.value.map(d=>d.id)},l=await te.submitPrediction(o);x.success("预测数据保存成功")}catch(o){if(((t=o.response)==null?void 0:t.status)===401){x.warning("请先登录后再进行预测");return}console.error("保存预测数据失败:",o),x.error("保存预测数据失败")}};return re(async()=>{p.matchId&&(await N(),await A())}),z({getPredictData(){return{firstTeam:_.value,secondTeam:T.value,advanceTeams:D.value}},fetchTeams:N,fetchUserPrediction:A,validateAndSavePrediction:W}),(h,t)=>{const o=ne,l=ce;return ge((m(),c("div",Fe,[s("h2",Ge,f(R.value)+"竞猜作业",1),k(ze,{ref_key:"predictRef",ref:b,teams:P.value,"first-label":"3-0","second-label":"0-3","advance-label":"3-2或3-1晋级的6支队伍","max-advance":6,isTimeValid:h.isTimeValid,"onUpdate:firstTeam":t[0]||(t[0]=d=>_.value=d),"onUpdate:secondTeam":t[1]||(t[1]=d=>T.value=d),"onUpdate:advanceTeams":t[2]||(t[2]=d=>D.value=d)},null,8,["teams","isTimeValid"]),s("div",He,[k(o,{onClick:W,disabled:!h.isTimeValid},{default:g(()=>t[3]||(t[3]=[H("保存预测")])),_:1},8,["disabled"])])])),[[l,V.value]])}}}),ae=Q(Ze,[["__scopeId","data-v-7353871b"]]),Ye={class:"major-champion"},Je={class:"bracket-container"},Qe={class:"bracket-stage"},Xe={class:"matches"},es={class:"match"},ss=["src","alt"],ts={class:"team-name"},as=["onClick","disabled"],is={key:0,class:"empty-slot"},os=["src","alt"],ls={class:"team-name"},ns=["onClick","disabled"],ds={key:0,class:"empty-slot"},rs={class:"match"},cs=["src","alt"],ms={class:"team-name"},us=["onClick","disabled"],vs={key:0,class:"empty-slot"},hs=["src","alt"],gs={class:"team-name"},ps=["onClick","disabled"],fs={key:0,class:"empty-slot"},_s={class:"match"},bs=["src","alt"],Ts={class:"team-name"},ks=["onClick","disabled"],ys={key:0,class:"empty-slot"},$s=["src","alt"],Cs={class:"team-name"},ws=["onClick","disabled"],Vs={key:0,class:"empty-slot"},Is={class:"match"},Ps=["src","alt"],qs={class:"team-name"},Ss=["onClick","disabled"],Ls={key:0,class:"empty-slot"},Ds=["src","alt"],Ms={class:"team-name"},js=["onClick","disabled"],Es={key:0,class:"empty-slot"},As={class:"bracket-stage"},Bs={class:"matches"},Rs={class:"match"},Us=["src","alt"],Ns={class:"team-name"},Ws=["onClick","disabled"],Os={key:0,class:"empty-slot"},xs=["src","alt"],zs={class:"team-name"},Fs=["onClick","disabled"],Gs={key:0,class:"empty-slot"},Hs={class:"match"},Ks=["src","alt"],Zs={class:"team-name"},Ys=["onClick","disabled"],Js={key:0,class:"empty-slot"},Qs=["src","alt"],Xs={class:"team-name"},et=["onClick","disabled"],st={key:0,class:"empty-slot"},tt={class:"bracket-stage"},at={class:"matches"},it={class:"match"},ot=["src","alt"],lt={class:"team-name"},nt=["onClick","disabled"],dt={key:0,class:"empty-slot"},rt=["src","alt"],ct={class:"team-name"},mt=["onClick","disabled"],ut={key:0,class:"empty-slot"},vt={class:"bracket-stage champion-stage"},ht={class:"matches"},gt=["src","alt"],pt={class:"team-name"},ft=["onClick","disabled"],_t={key:0,class:"empty-slot champion-empty"},bt=F({name:"MajorChampion"}),Tt=F({...bt,props:{isTimeValid:{type:Boolean}},setup(U,{expose:z}){const p={name:"teams"},R=u(),v=u([]),b=u([]),_=u([]),T=u([]),D=u([]),P=u([]),V=u([]),E=u([]),S=u([]),j=u([]),N=u([]),A=u([]),B=u([]),W=u([]),h=u([]),t=u([]),o=u([]),l=u([]),d=a=>{switch(a){case"quarters1":return T;case"quarters2":return D;case"quarters3":return P;case"quarters4":return V;case"quarters5":return E;case"quarters6":return S;case"quarters7":return j;case"quarters8":return N;case"semis1":return A;case"semis2":return B;case"semis3":return W;case"semis4":return h;case"finals1":return t;case"finals2":return o;case"champion":return l;default:return u([])}},y=a=>{const i=a.from.parentElement.id,e=a.to.parentElement.id;if(!i||!e)return!1;if(i===e)return!0;if(i.startsWith("quarters")&&e.startsWith("semis")){const C=parseInt(i.replace("quarters","")),O=parseInt(e.replace("semis",""));if(Math.ceil(C/2)===O)return!0}if(i.startsWith("semis")&&e.startsWith("finals")){const C=parseInt(i.replace("semis","")),O=parseInt(e.replace("finals",""));if(Math.ceil(C/2)===O)return!0}return!!(i.startsWith("finals")&&e==="champion"||e.startsWith("quarters"))},$=(a,i)=>{const e=d(i);if(a.added){const C=a.added.element;[T,D,P,V,E,S,j,N,A,B,W,h,t,o,l].forEach(G=>{if(G!==e){const K=G.value.findIndex(Y=>Y.id===C.id);K!==-1&&G.value.splice(K,1)}})}};function r(a,i){const e=d(a),C=e.value.findIndex(O=>O.id===i);C!==-1&&e.value.splice(C,1)}const n=()=>{const a=R.value;a&&(v.value=[...a.firstTeam],b.value=[...a.secondTeam],_.value=[...a.advanceTeams])};return z({getPredictData(){return n(),{firstTeam:v.value,secondTeam:b.value,advanceTeams:_.value}}}),(a,i)=>(m(),c("div",Ye,[i[22]||(i[22]=s("h2",{class:"title"},"冠军竞猜",-1)),s("div",Je,[s("div",Qe,[i[15]||(i[15]=s("div",{class:"stage-title"},"四分之一决赛",-1)),s("div",Xe,[s("div",es,[k(q(L),{id:"quarters1",list:T.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[0]||(i[0]=e=>$(e,"quarters1")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,ss),s("div",ts,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters1",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,as)],2)]),footer:g(()=>[T.value.length===0?(m(),c("div",is,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"quarters2",list:D.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[1]||(i[1]=e=>$(e,"quarters2")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,os),s("div",ls,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters2",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,ns)],2)]),footer:g(()=>[D.value.length===0?(m(),c("div",ds,"待定")):w("",!0)]),_:1},8,["list","disabled"])]),s("div",rs,[k(q(L),{id:"quarters3",list:P.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[2]||(i[2]=e=>$(e,"quarters3")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,cs),s("div",ms,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters3",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,us)],2)]),footer:g(()=>[P.value.length===0?(m(),c("div",vs,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"quarters4",list:V.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[3]||(i[3]=e=>$(e,"quarters4")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,hs),s("div",gs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters4",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,ps)],2)]),footer:g(()=>[V.value.length===0?(m(),c("div",fs,"待定")):w("",!0)]),_:1},8,["list","disabled"])]),s("div",_s,[k(q(L),{id:"quarters5",list:E.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[4]||(i[4]=e=>$(e,"quarters5")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,bs),s("div",Ts,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters5",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,ks)],2)]),footer:g(()=>[E.value.length===0?(m(),c("div",ys,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"quarters6",list:S.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[5]||(i[5]=e=>$(e,"quarters6")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,$s),s("div",Cs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters6",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,ws)],2)]),footer:g(()=>[S.value.length===0?(m(),c("div",Vs,"待定")):w("",!0)]),_:1},8,["list","disabled"])]),s("div",Is,[k(q(L),{id:"quarters7",list:j.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[6]||(i[6]=e=>$(e,"quarters7")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,Ps),s("div",qs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters7",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,Ss)],2)]),footer:g(()=>[j.value.length===0?(m(),c("div",Ls,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"quarters8",list:N.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[7]||(i[7]=e=>$(e,"quarters8")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,Ds),s("div",Ms,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("quarters8",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,js)],2)]),footer:g(()=>[N.value.length===0?(m(),c("div",Es,"待定")):w("",!0)]),_:1},8,["list","disabled"])])])]),i[19]||(i[19]=s("div",{class:"connector-column"},[s("div",{class:"connector-gap"})],-1)),s("div",As,[i[16]||(i[16]=s("div",{class:"stage-title"},"半决赛",-1)),s("div",Bs,[s("div",Rs,[k(q(L),{id:"semis1",list:A.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[8]||(i[8]=e=>$(e,"semis1")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,Us),s("div",Ns,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("semis1",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,Ws)],2)]),footer:g(()=>[A.value.length===0?(m(),c("div",Os,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"semis2",list:B.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[9]||(i[9]=e=>$(e,"semis2")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,xs),s("div",zs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("semis2",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,Fs)],2)]),footer:g(()=>[B.value.length===0?(m(),c("div",Gs,"待定")):w("",!0)]),_:1},8,["list","disabled"])]),s("div",Hs,[k(q(L),{id:"semis3",list:W.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[10]||(i[10]=e=>$(e,"semis3")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,Ks),s("div",Zs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("semis3",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,Ys)],2)]),footer:g(()=>[W.value.length===0?(m(),c("div",Js,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"semis4",list:h.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[11]||(i[11]=e=>$(e,"semis4")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,Qs),s("div",Xs,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("semis4",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,et)],2)]),footer:g(()=>[h.value.length===0?(m(),c("div",st,"待定")):w("",!0)]),_:1},8,["list","disabled"])])])]),i[20]||(i[20]=s("div",{class:"connector-column"},[s("div")],-1)),s("div",tt,[i[17]||(i[17]=s("div",{class:"stage-title"},"总决赛",-1)),s("div",at,[s("div",it,[k(q(L),{id:"finals1",list:t.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[12]||(i[12]=e=>$(e,"finals1")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,ot),s("div",lt,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("finals1",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,nt)],2)]),footer:g(()=>[t.value.length===0?(m(),c("div",dt,"待定")):w("",!0)]),_:1},8,["list","disabled"]),k(q(L),{id:"finals2",list:o.value,group:p,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:i[13]||(i[13]=e=>$(e,"finals2")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,rt),s("div",ct,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("finals2",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,mt)],2)]),footer:g(()=>[o.value.length===0?(m(),c("div",ut,"待定")):w("",!0)]),_:1},8,["list","disabled"])])])]),i[21]||(i[21]=s("div",{class:"connector-column third"},null,-1)),s("div",vt,[i[18]||(i[18]=s("div",{class:"stage-title"},"冠军",-1)),s("div",ht,[k(q(L),{id:"champion",list:l.value,group:p,"item-key":"id",class:"slot champion-slot","ghost-class":"ghost",onChange:i[14]||(i[14]=e=>$(e,"champion")),move:y,max:1,disabled:!a.isTimeValid},{item:g(({element:e})=>[s("div",{class:I(["team-card selected",{disabled:!a.isTimeValid}])},[s("img",{src:e.logo,alt:e.name,class:"team-logo"},null,8,gt),s("div",pt,f(e.name),1),s("button",{class:"remove-btn",onClick:M(C=>r("champion",e.id),["stop"]),disabled:!a.isTimeValid},"×",8,ft)],2)]),footer:g(()=>[l.value.length===0?(m(),c("div",_t,"待定")):w("",!0)]),_:1},8,["list","disabled"])])])])]))}}),kt=Q(Tt,[["__scopeId","data-v-526dd3fb"]]),yt={class:"major-container"},$t={key:0,class:"loading-container"},Ct={key:1,class:"prediction-content"},wt={class:"tab-buttons"},Vt={key:0,class:"countdown"},It={key:0,class:"countdown"},Pt={key:0,class:"countdown"},qt={key:0,class:"countdown"},St={class:"major-content"},Lt={class:"match-info-panel"},Dt={class:"match-header"},Mt=["src","alt"],jt={class:"match-name"},Et={class:"match-details"},At={class:"info-item"},Bt={class:"value"},Rt={class:"info-item"},Ut={class:"value"},Nt={class:"info-item"},Wt={class:"value"},Ot={class:"match-footer"},xt={key:0,class:"major-section"},zt={class:"time-info"},Ft={key:1,class:"major-section"},Gt={class:"time-info"},Ht={key:2,class:"major-section"},Kt={class:"time-info"},Zt={key:3,class:"major-section"},Yt={class:"time-info"},Jt={key:2,class:"no-match"},Qt=F({__name:"CS2Major",setup(U,{expose:z}){_e();const p=u(0),R=u(!0),v=u("onePhase"),b=u(),_=u(),T=u(),D=u(),P=u(null),V=u(null),E=u(!1),S=u({}),j=u({onePhase:{start:new Date,end:new Date},twoPhase:{start:new Date,end:new Date},threePhase:{start:new Date,end:new Date},champion:{start:new Date,end:new Date}}),N=de(()=>Object.keys(S.value).length>0),A=r=>new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"Asia/Shanghai"}).replace(/\//g,"年").replace(",","日"),B=r=>{const{start:n,end:a}=j.value[r];return`${A(n.toISOString())}日 ${n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})} - ${A(a.toISOString())}日 ${a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})}`},W=async()=>{try{R.value=!0;const r=await Z.get("/machine/matches");if(r.data&&r.data.length>0){const n=r.data;n.length>0?(n.forEach(a=>{S.value[a.phase]=a}),S.value[v.value]||(v.value=Object.keys(S.value)[0]),h(v.value),n.forEach(a=>{const i=a.phase;i in j.value&&(j.value[i]={start:new Date(a.predictStartTime),end:new Date(a.predictEndTime)})}),console.log("比赛信息:",n),console.log("时间限制设置:",j.value)):x.error("未找到可用赛事")}else x.error("未找到可用赛事")}catch(r){console.error("获取赛事ID失败:",r),x.error("获取赛事ID失败")}finally{R.value=!1}},h=r=>{const n=S.value[r];n?(p.value=n.id||0,V.value=n):(p.value=0,V.value=null)},t=r=>{const n=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Shanghai"})),{start:a,end:i}=j.value[r];return n>=a&&n<=i},o=r=>{const n=new Date,{start:a,end:i}=j.value[r];if(n<a){const e=a.getTime()-n.getTime();return`距离开始还有 ${l(e)}`}else{if(n>i)return"竞猜已结束";{const e=i.getTime()-n.getTime();return`距离结束还有 ${l(e)}`}}},l=r=>{const n=Math.floor(r/864e5),a=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),i=Math.floor(r%(1e3*60*60)/(1e3*60)),e=Math.floor(r%(1e3*60)/1e3);return`${n}天${a}小时${i}分${e}秒`},d=()=>{v.value=v.value};J(v,r=>{var n,a,i,e;if(h(r),p.value)switch(r){case"onePhase":(n=b.value)==null||n.fetchTeams();break;case"twoPhase":(a=_.value)==null||a.fetchTeams();break;case"threePhase":(i=T.value)==null||i.fetchTeams();break;case"champion":(e=D.value)==null||e.fetchTeams();break}}),re(async()=>{await W(),P.value=window.setInterval(d,1e3)}),pe(()=>{P.value&&clearInterval(P.value)}),z({getPredictData(){var r,n,a,i;return{onePhase:(r=b.value)==null?void 0:r.getPredictData(),twoPhase:(n=_.value)==null?void 0:n.getPredictData(),threePhase:(a=T.value)==null?void 0:a.getPredictData(),champion:(i=D.value)==null?void 0:i.getPredictData()}}});const y=r=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height+60;const a=n.getContext("2d");if(!a)return r;a.drawImage(r,0,0),a.font="bold 36px Microsoft YaHei",a.textAlign="center",a.textBaseline="bottom";const i="竞猜作业来源：sb6657.cn",e=n.width/2,C=n.height-20,O=a.measureText(i).width;return a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(e-O/2-10,C-40,O+20,40),a.fillStyle="#ffffff",a.fillText(i,e,C),n},$=async()=>{const r="玩机器烂梗库官方比赛作业，地址sb6657.cn";try{await navigator.clipboard.writeText(r)}catch(n){console.error("复制失败:",n)}try{E.value=!0;const n=document.querySelector(".major-section");if(!n)throw new Error("未找到要截图的元素");const a=await Te(n,{backgroundColor:"#ffffff",scale:1.5,logging:!1,useCORS:!0,allowTaint:!0}),i=y(a),e=document.createElement("a");e.download=`sb6657.cn_CS2Major预测_${new Date().toLocaleDateString()}.jpg`,e.href=i.toDataURL("image/jpeg",1),e.click(),x.success("截图已保存"),Z.get("/machine/shareMatch")}catch(n){console.error("截图失败:",n),x.error("截图失败，请重试")}finally{E.value=!1}};return(r,n)=>{var O,G,K,Y,ie,oe,le;const a=me,i=ue,e=ne,C=ve;return m(),c("div",yt,[R.value?(m(),c("div",$t,[k(a,{rows:3,animated:""})])):N.value?(m(),c("div",Ct,[s("div",wt,[S.value.onePhase?(m(),c("button",{key:0,class:I({active:v.value==="onePhase"}),onClick:n[0]||(n[0]=X=>v.value="onePhase")},[n[4]||(n[4]=H(" 第一阶段 ")),v.value==="onePhase"?(m(),c("div",Vt,f(o("onePhase")),1)):w("",!0)],2)):w("",!0),S.value.twoPhase?(m(),c("button",{key:1,class:I({active:v.value==="twoPhase"}),onClick:n[1]||(n[1]=X=>v.value="twoPhase")},[n[5]||(n[5]=H(" 第二阶段 ")),v.value==="twoPhase"?(m(),c("div",It,f(o("twoPhase")),1)):w("",!0)],2)):w("",!0),S.value.threePhase?(m(),c("button",{key:2,class:I({active:v.value==="threePhase"}),onClick:n[2]||(n[2]=X=>v.value="threePhase")},[n[6]||(n[6]=H(" 第三阶段 ")),v.value==="threePhase"?(m(),c("div",Pt,f(o("threePhase")),1)):w("",!0)],2)):w("",!0),S.value.champion?(m(),c("button",{key:3,class:I({active:v.value==="champion"}),onClick:n[3]||(n[3]=X=>v.value="champion")},[n[7]||(n[7]=H(" 冠军组 ")),v.value==="champion"?(m(),c("div",qt,f(o("champion")),1)):w("",!0)],2)):w("",!0)]),s("div",St,[s("div",Lt,[s("div",Dt,[s("img",{src:(O=V.value)==null?void 0:O.matchesImg,alt:(G=V.value)==null?void 0:G.matchesName,class:"match-logo"},null,8,Mt),s("h2",jt,f((K=V.value)==null?void 0:K.matchesName),1)]),s("div",Et,[s("div",At,[n[8]||(n[8]=s("span",{class:"label"},"赛事等级：",-1)),s("span",Bt,f((Y=V.value)==null?void 0:Y.level),1)]),s("div",Rt,[n[9]||(n[9]=s("span",{class:"label"},"比赛地点：",-1)),s("span",Ut,f((ie=V.value)==null?void 0:ie.matchesLocation),1)]),s("div",Nt,[n[10]||(n[10]=s("span",{class:"label"},"比赛时间：",-1)),s("span",Wt,f(A((oe=V.value)==null?void 0:oe.startTime))+"日 - "+f(A((le=V.value)==null?void 0:le.endTime))+"日",1)])]),s("div",Ot,[n[12]||(n[12]=s("div",{class:"reward-info"},"竞猜会获得平台虚拟奖章，目前正在做",-1)),k(e,{type:"primary",onClick:$,loading:E.value},{default:g(()=>[k(i,null,{default:g(()=>[k(q(be))]),_:1}),n[11]||(n[11]=H(" 截图分享预测 "))]),_:1},8,["loading"])])]),v.value==="onePhase"?(m(),c("div",xt,[s("div",zt,[s("p",null,"竞猜时间："+f(B("onePhase")),1)]),k(ae,{ref_key:"onePhaseRef",ref:b,isTimeValid:t("onePhase"),matchId:p.value,phase:"onePhase"},null,8,["isTimeValid","matchId"])])):w("",!0),v.value==="twoPhase"?(m(),c("div",Ft,[s("div",Gt,[s("p",null,"竞猜时间："+f(B("twoPhase")),1)]),k(ae,{ref_key:"twoPhaseRef",ref:_,isTimeValid:t("twoPhase"),matchId:p.value,phase:"twoPhase"},null,8,["isTimeValid","matchId"])])):w("",!0),v.value==="threePhase"?(m(),c("div",Ht,[s("div",Kt,[s("p",null,"竞猜时间："+f(B("threePhase")),1)]),k(ae,{ref_key:"threePhaseRef",ref:T,isTimeValid:t("threePhase"),matchId:p.value,phase:"threePhase"},null,8,["isTimeValid","matchId"])])):w("",!0),v.value==="champion"?(m(),c("div",Zt,[s("div",Yt,[s("p",null,"竞猜时间："+f(B("champion")),1)]),k(kt,{ref_key:"championRef",ref:D,isTimeValid:t("champion"),matchId:p.value},null,8,["isTimeValid","matchId"])])):w("",!0)])])):(m(),c("div",Jt,[k(C,{description:"暂无可用赛事"})]))])}}}),ba=Q(Qt,[["__scopeId","data-v-aa063e26"]]);export{ba as default};
