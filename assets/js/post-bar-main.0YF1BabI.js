import{a as S,j as O,n as j,l as q,c as X,J as W,K as Y,H as Z,e as ee,f as te,d as ae,L as ne}from"./element-plus.DX6Kv4BD.js";import{_ as se,a as oe,b as re,c as le,C as ie}from"./sendPost.vue_vue_type_style_index_0_scoped_86d80eb7_lang.BA5AYkK0.js";import{h,A as ue,_ as z}from"./index.BvqoVUkk.js";import{a as de}from"./setMeme.C2UiqhFj.js";import{C as ce}from"./CommunityNorms.B1CUO8-P.js";import{d as J,b as u,X as me,k as H,o as l,c as d,a,P as i,H as c,L as g,K as N,D as pe,G as Q,u as fe,O as P,ag as be,f as ge,I as _e,a4 as U,M as b}from"./@vue.BqJqC78G.js";import{a as ye}from"./clipboard.Spfv_EY9.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.C-35htfh.js";import"./@element-plus.Du5FBV_q.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.D6RD0Zoz.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.PTNpl1pN.js";const ve={class:"post-form"},he={class:"form-header"},ke={key:0},Ce={key:0,style:{display:"flex",gap:"10px"}},we={class:"form-footer"},Se=["innerHTML"],Ne=J({__name:"sendPost",setup(G){const k=u(!1),_=u(!1),y=u("");u(0);const v=u(!1),f=u(""),C=u(null),w=me({filteredItems:[]}),x=()=>{h.post(ue.SEARCH_MEME,{barrage:f.value}).then(m=>{w.filteredItems=m.data||[]}).catch(m=>{console.error("搜索失败",m)})},L=H(()=>f.value===""?"width: 80%;":"width: 20%;"),B=H(()=>w.filteredItems.map(m=>({id:m.id,barrage:m.barrage}))),V=async()=>{if(!y.value.trim()){S.warning("内容不能为空");return}try{const m=await h.post("/machine/Post/ReviewPost/submit",{barrageId:C.value,content:y.value.trim()});m.code===200?(S.success("发帖成功！等待审核中～"),y.value=""):S.error(m.msg||"发帖失败")}catch{S.error("网络错误，发帖失败")}};return(m,t)=>{const M=O,E=be("InfoFilled"),F=j,I=q,$=X,T=W,A=Y,e=Z,s=ee;return l(),d(P,null,[a("div",ve,[i(e,null,{default:c(()=>[a("div",he,[t[10]||(t[10]=a("h3",null,"发帖",-1)),i(M,{type:"textarea",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),placeholder:"发布帖子...   使用AI辅助人工自动审核，请注意发言规范。",maxlength:"299","show-word-limit":""},null,8,["modelValue"]),i(I,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=o=>v.value=o),size:"large"},{default:c(()=>[t[8]||(t[8]=g(" 关联烂梗 ")),v.value?(l(),d("span",ke,[i(F,null,{default:c(()=>[i(E)]),_:1}),t[7]||(t[7]=g(" 先在左边搜索然后右边选择一条关联⬇️"))])):N("",!0)]),_:1},8,["modelValue"]),v.value?(l(),d("span",Ce,[i(M,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=o=>f.value=o),placeholder:"查找烂梗,点击搜索后右边选择关联",style:pe(L.value)},null,8,["modelValue","style"]),i($,{style:{width:"70px"},type:"primary",onClick:x},{default:c(()=>t[9]||(t[9]=[g("搜索")])),_:1}),w.filteredItems.length?(l(),Q(T,{key:0,options:B.value,props:{checkStrictly:!0,emitPath:!1,label:"barrage",value:"id"},clearable:"",teleported:"true","popper-class":"barrage-cascader-popper",placeholder:"选择关联的烂梗",modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=o=>C.value=o),style:{width:"100%","word-wrap":"break-word","word-break":"break-all"}},null,8,["options","modelValue"])):N("",!0)])):N("",!0)]),a("div",we,[i(I,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=o=>k.value=o),size:"large"},{default:c(()=>[t[12]||(t[12]=g(" 已同意 ")),i(A,{type:"primary",onClick:t[4]||(t[4]=o=>_.value=!0)},{default:c(()=>t[11]||(t[11]=[g("《社区规范》")])),_:1}),t[13]||(t[13]=g(" ，不发布违反规范内容 "))]),_:1},8,["modelValue"]),i($,{type:"primary",onClick:V,disabled:k.value===!1},{default:c(()=>t[14]||(t[14]=[g("发布")])),_:1},8,["disabled"])])]),_:1})]),i(s,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=o=>_.value=o),title:"社区规范与隐私政策",width:"800"},{default:c(()=>[a("div",{innerHTML:fe(ce)},null,8,Se)]),_:1},8,["modelValue"])],64)}}}),xe=z(Ne,[["__scopeId","data-v-86d80eb7"]]),Ve={class:"main-post"},Me={class:"post-card-header"},Ee=["src"],Ie={class:"post-user-name"},$e={class:"post-meta"},Pe={class:"post-createTime"},Le={style:{color:"black"}},Be=["onClick"],Fe={class:"post-content"},Te={key:0,class:"post-statements"},Ae=["src"],Ue={class:"post-footer"},De={class:"post-footer-meta"},He={style:{display:"flex"}},Re=["onClick"],ze=["src"],Je={style:{cursor:"pointer"}},Qe=["onClick"],Ge=["onClick"],Ke=["onClick"],Oe={key:0},R=5,je=J({__name:"post-bar-main",setup(G){const k=u(new Map),_=u(new Map),y=u([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),v=u([]),f=u(new Map);u({});const C=u(1),w=u(!0),x=u(!1),L=async e=>{const s=await h.get(`/machine/Post/Comment/getComment/${e}`);k.value.set(e,s.data)},B=async e=>{_.value.get(e)||await L(e),_.value.set(e,!_.value.get(e))},V=async()=>{if(!(x.value||!w.value)){x.value=!0,console.log("Loading more posts...");try{const e=await h.get("/machine/Post/list",{params:{pageNum:C.value,pageSize:R}});e.data.list.length<R&&(w.value=!1),v.value.push(...e.data.list),C.value++}catch{}finally{x.value=!1}}},m=e=>new Date(e).toLocaleString(),t=e=>`/src/assets/imgs/user-img-${Math.floor(Math.random()*5)}.png`,M=async e=>{if(f.value.has(e))return f.value.get(e);const o=(await h.get(`/machine/getBarrageInfo/${e}`)).data;return f.value.set(e,o),o};function E(e){e.likeFlag||h.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const F=(e,s)=>{const p={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[s];return!!p&&e[p]>0},I=(e,s)=>{const p={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[s];return p?e[p]:0},$=e=>e?y.value.filter(s=>F(e,s.statementNum)):[];function T(e,s,o){const p=v.value.find(r=>r.id===o);if(!p||!p.postStatement)return;const n={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[s];n&&h.post("/machine/Post/Statement",{portId:e,postId:o,statementNum:s}).then(()=>{p.postStatement[n]++,S.success("表态成功")})}function A(e){e&&(ye(e.barrage),de(e.id.toString()).then(()=>{S.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return ge(()=>{V()}),(e,s)=>{const o=te,p=ae,D=ne;return _e((l(),d("div",Ve,[i(xe),(l(!0),d(P,null,U(v.value,n=>(l(),d("div",{key:n.id,class:"card post-card-main"},[a("div",null,[a("div",Me,[a("img",{class:"user-img",src:t(n.userName),alt:""},null,8,Ee),a("span",Ie,b(n.userName),1)]),a("div",$e,[a("span",Pe,b(m(n.createTime)),1),i(p,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:r=>M(n.barrageId)},{reference:c(()=>[n.barrage?(l(),Q(o,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:c(()=>[a("span",Le,"#烂梗："+b(n.barrage),1)]),_:2},1024)):N("",!0)]),default:c(()=>{var r;return[a("div",{style:{cursor:"pointer"},onClick:K=>A(f.value.get(n.barrageId))},b((r=f.value.get(n.barrageId))==null?void 0:r.barrage),9,Be)]}),_:2},1032,["onBeforeEnter"])])]),a("span",Fe,b(n.content),1),n.postStatement?(l(),d("div",Te,[(l(!0),d(P,null,U($(n.postStatement),r=>(l(),d("span",{key:r.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[i(o,{round:""},{default:c(()=>[a("img",{src:r.url},null,8,Ae),a("span",null,b(I(n.postStatement,r.statementNum)),1)]),_:2},1024)]))),128))])):N("",!0),a("div",Ue,[a("div",De,[i(p,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:c(()=>[a("div",He,[(l(!0),d(P,null,U(y.value,r=>(l(),d("div",{key:r.statementNum,style:{"margin-right":"10px"}},[a("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:K=>T(n.id,r.statementNum,n.id)},[a("img",{style:{width:"30px",cursor:"pointer"},src:r.url},null,8,ze),a("span",Je,b(r.name),1)],8,Re)]))),128))])]),reference:c(()=>s[0]||(s[0]=[a("span",null,[a("img",{src:se}),g(" 表态")],-1)])),_:2},1024),a("span",{style:{cursor:"pointer"},onClick:r=>B(n.id)},[s[1]||(s[1]=a("img",{src:oe},null,-1)),a("span",null," "+b(n.commentCount),1)],8,Qe),n.likeFlag?(l(),d("span",{key:0,style:{cursor:"not-allowed"},onClick:r=>E(n)},[s[2]||(s[2]=a("img",{src:re},null,-1)),a("span",null," "+b(n.postLike),1)],8,Ge)):(l(),d("span",{key:1,style:{cursor:"pointer"},onClick:r=>E(n)},s[3]||(s[3]=[a("img",{src:le},null,-1),g(" 赞 ")]),8,Ke))]),_.value.get(n.id)?(l(),d("div",Oe,[i(ie,{comments:k.value.get(n.id)||[],"post-id":n.id},null,8,["comments","post-id"])])):N("",!0)])]))),128))])),[[D,V]])}}}),bt=z(je,[["__scopeId","data-v-0ff760e3"]]);export{bt as default};
