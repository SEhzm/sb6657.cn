import{_ as U,a as j,b as q,c as H,C as W}from"./sendPost.vue_vue_type_style_index_0_scoped_3951dd6e_lang.ByPH35bD.js";import{h as p,_ as X}from"./index.Dp4FT_CZ.js";import{b as Y,a as Z}from"./setMeme.DMqCpiH5.js";import{b as ee}from"./vue-router.BFvkXMb7.js";import{a as P}from"./element-plus.C4Wz9kMa.js";import{d as te,h as l,f as ae,al as v,ar as ne,K as se,o as r,c,R as f,Q as k,a6 as C,a,L as N,P as u,J as d,I as oe,O as $}from"./@vue.BltuATdo.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./@element-plus.D0bpsst8.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const re={class:"main-post"},ce={class:"post-card-header"},ie=["src"],le={class:"post-user-name"},ue={class:"post-meta"},de={class:"post-createTime"},me={style:{color:"black"}},pe=["onClick"],fe={class:"post-content"},ge={key:0,class:"post-statements"},be=["src"],_e={class:"post-footer"},ye={class:"post-footer-meta"},he={style:{display:"flex"}},ve=["onClick"],ke=["src"],Ce={style:{cursor:"pointer"}},Ne=["onClick"],Se=["onClick"],we=["onClick"],xe={key:0},F=5,Me=te({__name:"Me-Post",setup(Be){const D=ee(),R=()=>{D.back()},S=l(new Map),g=l(new Map),w=l([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),_=l([]),m=l(new Map);l({});const x=l(1),M=l(!0),y=l(!1),T=async e=>{const n=await p.get(`/machine/Post/Comment/getComment/${e}`);S.value.set(e,n.data)},V=async e=>{g.value.get(e)||await T(e),g.value.set(e,!g.value.get(e))},B=async()=>{if(!(y.value||!M.value)){y.value=!0,console.log("Loading more posts...");try{const e=await p.get("/machine/Post/selectIsMePageList",{params:{pageNum:x.value,pageSize:F}});e.data.list.length<F&&(M.value=!1),_.value.push(...e.data.list),x.value++}catch{}finally{y.value=!1}}},E=e=>new Date(e).toLocaleString(),I=e=>`/src/assets/imgs/user-img-${Math.floor(Math.random()*5)}.png`,J=async e=>{if(m.value.has(e))return m.value.get(e);const i=(await p.get(`/machine/getBarrageInfo/${e}`)).data;return m.value.set(e,i),i};function L(e){e.likeFlag||p.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const Q=(e,n)=>{const o={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];return!!o&&e[o]>0},A=(e,n)=>{const o={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];return o?e[o]:0},z=e=>e?w.value.filter(n=>Q(e,n.statementNum)):[];function G(e,n,i){const o=_.value.find(t=>t.id===i);if(!o||!o.postStatement)return;const b={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[n];b&&p.post("/machine/Post/Statement",{portId:e,postId:i,statementNum:n}).then(()=>{o.postStatement[b]++,P.success("表态成功")})}function K(e){e&&(Y(e.barrage),Z(e.id.toString()).then(()=>{P.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return ae(()=>{B()}),(e,n)=>{const i=v("el-page-header"),o=v("el-tag"),h=v("el-popover"),b=ne("infinite-scroll");return se((r(),c("div",re,[f(i,{onBack:R,class:"card",content:"我的帖子"}),(r(!0),c(k,null,C(_.value,t=>(r(),c("div",{key:t.id,class:"card post-card-main"},[a("div",null,[a("div",ce,[a("img",{class:"user-img",src:I(t.userName),alt:""},null,8,ie),a("span",le,u(t.userName),1)]),a("div",ue,[a("span",de,u(E(t.createTime)),1),f(h,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:s=>J(t.barrageId)},{reference:d(()=>[t.barrage?(r(),oe(o,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:d(()=>[a("span",me,"#烂梗："+u(t.barrage),1)]),_:2},1024)):N("",!0)]),default:d(()=>{var s;return[a("div",{style:{cursor:"pointer"},onClick:O=>K(m.value.get(t.barrageId))},u((s=m.value.get(t.barrageId))==null?void 0:s.barrage),9,pe)]}),_:2},1032,["onBeforeEnter"])])]),a("span",fe,u(t.content),1),t.postStatement?(r(),c("div",ge,[(r(!0),c(k,null,C(z(t.postStatement),s=>(r(),c("span",{key:s.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[f(o,{round:""},{default:d(()=>[a("img",{src:s.url},null,8,be),a("span",null,u(A(t.postStatement,s.statementNum)),1)]),_:2},1024)]))),128))])):N("",!0),a("div",_e,[a("div",ye,[f(h,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:d(()=>[a("div",he,[(r(!0),c(k,null,C(w.value,s=>(r(),c("div",{key:s.statementNum,style:{"margin-right":"10px"}},[a("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:O=>G(t.id,s.statementNum,t.id)},[a("img",{style:{width:"30px",cursor:"pointer"},src:s.url},null,8,ke),a("span",Ce,u(s.name),1)],8,ve)]))),128))])]),reference:d(()=>[...n[0]||(n[0]=[a("span",null,[a("img",{src:U}),$(" 表态")],-1)])]),_:2},1024),a("span",{style:{cursor:"pointer"},onClick:s=>V(t.id)},[n[1]||(n[1]=a("img",{src:j},null,-1)),a("span",null," "+u(t.commentCount),1)],8,Ne),t.likeFlag?(r(),c("span",{key:0,style:{cursor:"not-allowed"},onClick:s=>L(t)},[n[2]||(n[2]=a("img",{src:q},null,-1)),a("span",null," "+u(t.postLike),1)],8,Se)):(r(),c("span",{key:1,style:{cursor:"pointer"},onClick:s=>L(t)},[...n[3]||(n[3]=[a("img",{src:H},null,-1),$(" 赞 ",-1)])],8,we))]),g.value.get(t.id)?(r(),c("div",xe,[f(W,{comments:S.value.get(t.id)||[],"post-id":t.id},null,8,["comments","post-id"])])):N("",!0)])]))),128))])),[[b,B]])}}}),qe=X(Me,[["__scopeId","data-v-1b89b199"]]);export{qe as default};
