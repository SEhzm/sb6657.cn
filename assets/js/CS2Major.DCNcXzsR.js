import{a as z,c as ie,v as le,M as ne,n as de,L as re}from"./element-plus.BdlBqtfi.js";import{d as G,b as c,e as J,c as g,a as e,P as T,H as h,u as q,M as f,n as ce,o as p,C,V as L,O as ee,a4 as se,k as me,i as oe,I as ue,L as K,K as V,S as ve}from"./@vue.Dx4vSINt.js";import{d as D}from"./vuedraggable.BDINTPbw.js";import{_ as X,h as Y,u as he}from"./index.C76xW52-.js";import{u as ge}from"./vue-router.Cp0X7YIN.js";import{R as pe}from"./@element-plus.DM5O92_U.js";import{h as fe}from"./html2canvas.BfYXEYrK.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.BhPyfUAB.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.hUPcw3xl.js";import"./vue.BdDluSGr.js";import"./pinia.CgDIJrih.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";const _e={class:"major-predict-root"},be={class:"team-pool"},Te=["src","alt"],ke={class:"team-name"},ye={class:"predict-area"},$e={class:"predict-row"},Ce={class:"predict-block"},Ve={class:"predict-label"},we=["src","alt"],Pe={class:"team-name"},Ie=["onClick","disabled"],qe={class:"predict-block"},Se={class:"predict-label"},De=["src","alt"],Le={class:"team-name"},Me=["onClick","disabled"],je={class:"predict-row advance-row"},Ee={class:"advance-label"},Ae=["src","alt"],Be={class:"team-name"},Re=["onClick","disabled"],Ne=G({name:"MatchPredictionBase"}),Ue=G({...Ne,props:{teams:{},firstLabel:{},secondLabel:{},advanceLabel:{},maxAdvance:{},isTimeValid:{type:Boolean}},setup(U,{expose:O}){const u=U,R={name:"teams"},_=c([]),y=c([]),k=c([]),b=c([]);J(()=>u.teams,a=>{_.value=[...a]},{immediate:!0});function S(a){const d=a.draggedContext.element;return!(M(a.from)&&j(d.id))}function I(a){const d=a.draggedContext.element;return!(M(a.from)&&j(d.id))}function w(a){const d=a.draggedContext.element;return!(M(a.from)&&j(d.id))}function M(a){return a&&a.classList&&a.classList.contains("team-list")}function j(a){return y.value.some(d=>d.id===a)||k.value.some(d=>d.id===a)||b.value.some(d=>d.id===a)}function N(a){if(a.added){const d=a.added.element;if(y.value.length>2){const o=y.value.splice(0,1);_.value.push(...o)}k.value=k.value.filter(o=>o.id!==d.id),b.value=b.value.filter(o=>o.id!==d.id)}v()}function E(a){if(a.added){const d=a.added.element;if(k.value.length>2){const o=k.value.splice(0,1);_.value.push(...o)}y.value=y.value.filter(o=>o.id!==d.id),b.value=b.value.filter(o=>o.id!==d.id)}v()}function W(a){if(a.added){const d=a.added.element;if(b.value.length>u.maxAdvance){const o=b.value.splice(0,1);_.value.push(...o)}y.value=y.value.filter(o=>o.id!==d.id),k.value=k.value.filter(o=>o.id!==d.id)}v()}function B(a,d){let o;a==="first"?o=y.value.splice(d,1):o=k.value.splice(d,1),_.value.push(...o),v()}function A(a){const d=b.value.splice(a,1);_.value.push(...d),v()}function v(){ce(()=>{const a=[...y.value.map(d=>d.id),...k.value.map(d=>d.id),...b.value.map(d=>d.id)];_.value=_.value.filter(d=>!a.includes(d.id))})}return O({firstTeam:y,secondTeam:k,advanceTeams:b}),(a,d)=>(p(),g("div",_e,[e("div",be,[T(q(D),{list:_.value,group:R,sort:!1,"item-key":"id",class:"team-list","ghost-class":"ghost",disabled:!a.isTimeValid},{item:h(({element:o})=>[(p(),g("div",{class:C(["team-card",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo"},null,8,Te),e("div",ke,f(o.name),1)],2))]),_:1},8,["list","disabled"])]),e("div",ye,[e("div",$e,[e("div",Ce,[e("div",Ve,f(a.firstLabel),1),T(q(D),{list:y.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:S,onChange:N,disabled:!a.isTimeValid},{item:h(({element:o,index:r})=>[(p(),g("div",{class:C(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,we),e("div",Pe,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>B("first",r),["stop"]),disabled:!a.isTimeValid},"×",8,Ie)],2))]),footer:h(()=>[(p(!0),g(ee,null,se(2-y.value.length,o=>(p(),g("div",{key:o,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])]),e("div",qe,[e("div",Se,f(a.secondLabel),1),T(q(D),{list:k.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:I,onChange:E,disabled:!a.isTimeValid},{item:h(({element:o,index:r})=>[(p(),g("div",{class:C(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,De),e("div",Le,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>B("second",r),["stop"]),disabled:!a.isTimeValid},"×",8,Me)],2))]),footer:h(()=>[(p(!0),g(ee,null,se(2-k.value.length,o=>(p(),g("div",{key:o,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])])]),e("div",je,[e("div",Ee,f(a.advanceLabel),1),T(q(D),{list:b.value,group:R,sort:!0,"item-key":"id",class:"predict-slot multi big","ghost-class":"ghost",move:w,onChange:W,disabled:!a.isTimeValid},{item:h(({element:o,index:r})=>[(p(),g("div",{class:C(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,Ae),e("div",Be,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>A(r),["stop"]),disabled:!a.isTimeValid},"×",8,Re)],2))]),footer:h(()=>[(p(!0),g(ee,null,se(a.maxAdvance-b.value.length,o=>(p(),g("div",{key:o,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])])])]))}}),We=X(Ue,[["__scopeId","data-v-b19dfeec"]]),te={getMatchTeams(U,O){return Y.get(`/machine/matches/${U}/teams`,{params:{phase:O}})},submitPrediction(U){return Y.post("/machine/prediction/submit",U)},getUserPredictions(U){return Y.get("/machine/prediction/records",{params:{matchId:U.matchId,phase:U.phase}})}},ze={class:"major-phase","element-loading-text":"加载队伍数据中..."},Oe={class:"title"},Fe={class:"save-button"},Ge=G({name:"MajorPhase"}),He=G({...Ge,props:{isTimeValid:{type:Boolean},matchId:{},phase:{}},setup(U,{expose:O}){const u=U,R=me(()=>({onePhase:"第一阶段",twoPhase:"第二阶段",threePhase:"第三阶段"})[u.phase]),_=he(),y=c(),k=c([]),b=c([]),S=c([]),I=c([]),w=c(!1),M=c(!1),N=((v,a)=>{let d=null;return function(...o){d&&clearTimeout(d),d=setTimeout(()=>{v.apply(this,o),d=null},a)}})(()=>{u.isTimeValid&&(console.log("触发防抖保存..."),A())},300);J(y,v=>{v&&J([()=>v.firstTeam,()=>v.secondTeam,()=>v.advanceTeams],([a,d,o])=>{k.value=[...a],b.value=[...d],S.value=[...o],!w.value&&!M.value&&u.isTimeValid&&N()},{deep:!0})},{immediate:!0});const E=async()=>{try{w.value=!0,console.log(`获取${R.value}队伍数据，matchId:`,u.matchId);const v=await te.getMatchTeams(u.matchId,u.phase);console.log("获取到的原始数据:",v.data),I.value=v.data.map(a=>({id:a.id,name:a.teamName,logo:a.teamImgUrl})),console.log("处理后的队伍数据:",I.value)}catch(v){console.error("获取队伍数据失败:",v),z.error("获取队伍数据失败")}finally{w.value=!1}},W=async()=>{var v;if(!u.matchId){console.warn("matchId未设置，跳过获取预测数据");return}try{M.value=!0,w.value=!0,I.value.length===0&&await E();const a=await te.getUserPredictions({matchId:u.matchId,phase:u.phase,userId:_.userId});if(a.data){let d=Array.isArray(a.data)?a.data[0]:a.data;const o=new Set;if(d.sl){const r=d.sl.split(","),t=I.value.filter(i=>r.includes(i.id.toString()));k.value=t,t.forEach(i=>o.add(i.id.toString()))}if(d.ls){const r=d.ls.split(","),t=I.value.filter(i=>r.includes(i.id.toString()));b.value=t,t.forEach(i=>o.add(i.id.toString()))}if(d.advance){const r=d.advance.split(","),t=I.value.filter(i=>r.includes(i.id.toString()));S.value=t,t.forEach(i=>o.add(i.id.toString()))}I.value=I.value.filter(r=>!o.has(r.id.toString())),y.value&&(y.value.firstTeam=[...k.value],y.value.secondTeam=[...b.value],y.value.advanceTeams=[...S.value])}else console.log("未找到用户之前的预测数据")}catch(a){if(((v=a.response)==null?void 0:v.status)===401){console.log("用户未登录，跳过获取预测数据");return}console.error("获取预测数据失败:",a),z.error("获取预测数据失败")}finally{w.value=!1,setTimeout(()=>{M.value=!1},100)}},B=()=>{const v=[];return k.value.length!==2&&v.push("请选择2支3-0队伍"),b.value.length!==2&&v.push("请选择2支0-3队伍"),S.value.length!==6&&v.push("请选择6支晋级队伍"),v},A=async()=>{var a;const v=B();v.length>0&&z.warning(v.join(`
`));try{const d={matchId:u.matchId,phase:u.phase,s_l:k.value.map(r=>r.id.toString()).join(","),l_s:b.value.map(r=>r.id.toString()).join(","),advance:S.value.map(r=>r.id)},o=await te.submitPrediction(d);z.success("预测数据保存成功")}catch(d){if(((a=d.response)==null?void 0:a.status)===401){z.warning("请先登录后再进行预测");return}console.error("保存预测数据失败:",d),z.error("保存预测数据失败")}};return oe(async()=>{u.matchId&&(await E(),await W())}),O({getPredictData(){return{firstTeam:k.value,secondTeam:b.value,advanceTeams:S.value}},fetchTeams:E,fetchUserPrediction:W,validateAndSavePrediction:A}),(v,a)=>{const d=ie,o=le;return ue((p(),g("div",ze,[e("h2",Oe,f(R.value)+"竞猜作业",1),T(We,{ref_key:"predictRef",ref:y,teams:I.value,"first-label":"3-0（选择2支）","second-label":"0-3（选择2支）","advance-label":"3-2或3-1晋级的6支队伍","max-advance":6,isTimeValid:v.isTimeValid,"onUpdate:firstTeam":a[0]||(a[0]=r=>k.value=r),"onUpdate:secondTeam":a[1]||(a[1]=r=>b.value=r),"onUpdate:advanceTeams":a[2]||(a[2]=r=>S.value=r)},null,8,["teams","isTimeValid"]),e("div",Fe,[T(d,{onClick:A,disabled:!v.isTimeValid},{default:h(()=>a[3]||(a[3]=[K("保存预测")])),_:1},8,["disabled"])])])),[[o,w.value]])}}}),ae=X(He,[["__scopeId","data-v-b5f1833d"]]),Ke={class:"major-champion"},Ze={class:"bracket-container"},Ye={class:"bracket-stage"},Je={class:"matches"},Qe={class:"match"},Xe=["src","alt"],xe={class:"team-name"},es=["onClick","disabled"],ss={key:0,class:"empty-slot"},ts=["src","alt"],as={class:"team-name"},is=["onClick","disabled"],os={key:0,class:"empty-slot"},ls={class:"match"},ns=["src","alt"],ds={class:"team-name"},rs=["onClick","disabled"],cs={key:0,class:"empty-slot"},ms=["src","alt"],us={class:"team-name"},vs=["onClick","disabled"],hs={key:0,class:"empty-slot"},gs={class:"match"},ps=["src","alt"],fs={class:"team-name"},_s=["onClick","disabled"],bs={key:0,class:"empty-slot"},Ts=["src","alt"],ks={class:"team-name"},ys=["onClick","disabled"],$s={key:0,class:"empty-slot"},Cs={class:"match"},Vs=["src","alt"],ws={class:"team-name"},Ps=["onClick","disabled"],Is={key:0,class:"empty-slot"},qs=["src","alt"],Ss={class:"team-name"},Ds=["onClick","disabled"],Ls={key:0,class:"empty-slot"},Ms={class:"bracket-stage"},js={class:"matches"},Es={class:"match"},As=["src","alt"],Bs={class:"team-name"},Rs=["onClick","disabled"],Ns={key:0,class:"empty-slot"},Us=["src","alt"],Ws={class:"team-name"},zs=["onClick","disabled"],Os={key:0,class:"empty-slot"},Fs={class:"match"},Gs=["src","alt"],Hs={class:"team-name"},Ks=["onClick","disabled"],Zs={key:0,class:"empty-slot"},Ys=["src","alt"],Js={class:"team-name"},Qs=["onClick","disabled"],Xs={key:0,class:"empty-slot"},xs={class:"bracket-stage"},et={class:"matches"},st={class:"match"},tt=["src","alt"],at={class:"team-name"},it=["onClick","disabled"],ot={key:0,class:"empty-slot"},lt=["src","alt"],nt={class:"team-name"},dt=["onClick","disabled"],rt={key:0,class:"empty-slot"},ct={class:"bracket-stage champion-stage"},mt={class:"matches"},ut=["src","alt"],vt={class:"team-name"},ht=["onClick","disabled"],gt={key:0,class:"empty-slot champion-empty"},pt=G({name:"MajorChampion"}),ft=G({...pt,props:{isTimeValid:{type:Boolean}},setup(U,{expose:O}){const u={name:"teams"},R=c(),_=c([]),y=c([]),k=c([]),b=c([]),S=c([]),I=c([]),w=c([]),M=c([]),j=c([]),N=c([]),E=c([]),W=c([]),B=c([]),A=c([]),v=c([]),a=c([]),d=c([]),o=c([]),r=l=>{switch(l){case"quarters1":return b;case"quarters2":return S;case"quarters3":return I;case"quarters4":return w;case"quarters5":return M;case"quarters6":return j;case"quarters7":return N;case"quarters8":return E;case"semis1":return W;case"semis2":return B;case"semis3":return A;case"semis4":return v;case"finals1":return a;case"finals2":return d;case"champion":return o;default:return c([])}},t=l=>{const n=l.from.parentElement.id,s=l.to.parentElement.id;if(!n||!s)return!1;if(n===s)return!0;if(n.startsWith("quarters")&&s.startsWith("semis")){const $=parseInt(n.replace("quarters","")),F=parseInt(s.replace("semis",""));if(Math.ceil($/2)===F)return!0}if(n.startsWith("semis")&&s.startsWith("finals")){const $=parseInt(n.replace("semis","")),F=parseInt(s.replace("finals",""));if(Math.ceil($/2)===F)return!0}return!!(n.startsWith("finals")&&s==="champion"||s.startsWith("quarters"))},i=(l,n)=>{const s=r(n);if(l.added){const $=l.added.element;[b,S,I,w,M,j,N,E,W,B,A,v,a,d,o].forEach(H=>{if(H!==s){const Z=H.value.findIndex(Q=>Q.id===$.id);Z!==-1&&H.value.splice(Z,1)}})}};function m(l,n){const s=r(l),$=s.value.findIndex(F=>F.id===n);$!==-1&&s.value.splice($,1)}const P=()=>{const l=R.value;l&&(_.value=[...l.firstTeam],y.value=[...l.secondTeam],k.value=[...l.advanceTeams])};return O({getPredictData(){return P(),{firstTeam:_.value,secondTeam:y.value,advanceTeams:k.value}}}),(l,n)=>(p(),g("div",Ke,[n[22]||(n[22]=e("h2",{class:"title"},"冠军竞猜",-1)),e("div",Ze,[e("div",Ye,[n[15]||(n[15]=e("div",{class:"stage-title"},"四分之一决赛",-1)),e("div",Je,[e("div",Qe,[T(q(D),{id:"quarters1",list:b.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[0]||(n[0]=s=>i(s,"quarters1")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Xe),e("div",xe,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters1",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,es)],2)]),footer:h(()=>[b.value.length===0?(p(),g("div",ss,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters2",list:S.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[1]||(n[1]=s=>i(s,"quarters2")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ts),e("div",as,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters2",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,is)],2)]),footer:h(()=>[S.value.length===0?(p(),g("div",os,"待定")):V("",!0)]),_:1},8,["list","disabled"])]),e("div",ls,[T(q(D),{id:"quarters3",list:I.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[2]||(n[2]=s=>i(s,"quarters3")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ns),e("div",ds,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters3",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,rs)],2)]),footer:h(()=>[I.value.length===0?(p(),g("div",cs,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters4",list:w.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[3]||(n[3]=s=>i(s,"quarters4")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ms),e("div",us,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters4",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,vs)],2)]),footer:h(()=>[w.value.length===0?(p(),g("div",hs,"待定")):V("",!0)]),_:1},8,["list","disabled"])]),e("div",gs,[T(q(D),{id:"quarters5",list:M.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[4]||(n[4]=s=>i(s,"quarters5")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ps),e("div",fs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters5",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,_s)],2)]),footer:h(()=>[M.value.length===0?(p(),g("div",bs,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters6",list:j.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[5]||(n[5]=s=>i(s,"quarters6")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Ts),e("div",ks,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters6",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,ys)],2)]),footer:h(()=>[j.value.length===0?(p(),g("div",$s,"待定")):V("",!0)]),_:1},8,["list","disabled"])]),e("div",Cs,[T(q(D),{id:"quarters7",list:N.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[6]||(n[6]=s=>i(s,"quarters7")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Vs),e("div",ws,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters7",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,Ps)],2)]),footer:h(()=>[N.value.length===0?(p(),g("div",Is,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters8",list:E.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[7]||(n[7]=s=>i(s,"quarters8")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,qs),e("div",Ss,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("quarters8",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,Ds)],2)]),footer:h(()=>[E.value.length===0?(p(),g("div",Ls,"待定")):V("",!0)]),_:1},8,["list","disabled"])])])]),n[19]||(n[19]=e("div",{class:"connector-column"},[e("div",{class:"connector-gap"})],-1)),e("div",Ms,[n[16]||(n[16]=e("div",{class:"stage-title"},"半决赛",-1)),e("div",js,[e("div",Es,[T(q(D),{id:"semis1",list:W.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[8]||(n[8]=s=>i(s,"semis1")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,As),e("div",Bs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("semis1",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,Rs)],2)]),footer:h(()=>[W.value.length===0?(p(),g("div",Ns,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"semis2",list:B.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[9]||(n[9]=s=>i(s,"semis2")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Us),e("div",Ws,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("semis2",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,zs)],2)]),footer:h(()=>[B.value.length===0?(p(),g("div",Os,"待定")):V("",!0)]),_:1},8,["list","disabled"])]),e("div",Fs,[T(q(D),{id:"semis3",list:A.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[10]||(n[10]=s=>i(s,"semis3")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Gs),e("div",Hs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("semis3",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,Ks)],2)]),footer:h(()=>[A.value.length===0?(p(),g("div",Zs,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"semis4",list:v.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[11]||(n[11]=s=>i(s,"semis4")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Ys),e("div",Js,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("semis4",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,Qs)],2)]),footer:h(()=>[v.value.length===0?(p(),g("div",Xs,"待定")):V("",!0)]),_:1},8,["list","disabled"])])])]),n[20]||(n[20]=e("div",{class:"connector-column"},[e("div")],-1)),e("div",xs,[n[17]||(n[17]=e("div",{class:"stage-title"},"总决赛",-1)),e("div",et,[e("div",st,[T(q(D),{id:"finals1",list:a.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[12]||(n[12]=s=>i(s,"finals1")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,tt),e("div",at,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("finals1",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,it)],2)]),footer:h(()=>[a.value.length===0?(p(),g("div",ot,"待定")):V("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"finals2",list:d.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[13]||(n[13]=s=>i(s,"finals2")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,lt),e("div",nt,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("finals2",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,dt)],2)]),footer:h(()=>[d.value.length===0?(p(),g("div",rt,"待定")):V("",!0)]),_:1},8,["list","disabled"])])])]),n[21]||(n[21]=e("div",{class:"connector-column third"},null,-1)),e("div",ct,[n[18]||(n[18]=e("div",{class:"stage-title"},"冠军",-1)),e("div",mt,[T(q(D),{id:"champion",list:o.value,group:u,"item-key":"id",class:"slot champion-slot","ghost-class":"ghost",onChange:n[14]||(n[14]=s=>i(s,"champion")),move:t,max:1,disabled:!l.isTimeValid},{item:h(({element:s})=>[e("div",{class:C(["team-card selected",{disabled:!l.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ut),e("div",vt,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>m("champion",s.id),["stop"]),disabled:!l.isTimeValid},"×",8,ht)],2)]),footer:h(()=>[o.value.length===0?(p(),g("div",gt,"待定")):V("",!0)]),_:1},8,["list","disabled"])])])])]))}}),_t=X(ft,[["__scopeId","data-v-526dd3fb"]]),bt={class:"major-container"},Tt={key:0,class:"loading-container"},kt={key:1,class:"prediction-content"},yt={class:"tab-buttons"},$t={key:0,class:"countdown"},Ct={key:0,class:"countdown"},Vt={key:0,class:"countdown"},wt={key:0,class:"countdown"},Pt={class:"major-content"},It={class:"match-info-panel"},qt={class:"match-header"},St=["src","alt"],Dt={class:"match-name"},Lt={class:"match-details"},Mt={class:"info-item"},jt={class:"value"},Et={class:"info-item"},At={class:"value"},Bt={class:"info-item"},Rt={class:"value"},Nt={class:"match-footer"},Ut={key:0,class:"major-section"},Wt={class:"time-info"},zt={key:1,class:"major-section"},Ot={class:"time-info"},Ft={key:2,class:"major-section"},Gt={class:"time-info"},Ht={key:3,class:"major-section"},Kt={class:"time-info"},Zt={key:2,class:"no-match"},Yt=G({__name:"CS2Major",setup(U,{expose:O}){ge();const u=c(null),R=c(!0),_=c("onePhase"),y=c(),k=c(),b=c(),S=c(),I=c(null),w=c(null),M=c(!1),j=c({onePhase:{start:new Date,end:new Date},twoPhase:{start:new Date,end:new Date},threePhase:{start:new Date,end:new Date},champion:{start:new Date,end:new Date}}),N=r=>new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"Asia/Shanghai"}).replace(/\//g,"年").replace(",","日"),E=r=>{const{start:t,end:i}=j.value[r];return`${N(t.toISOString())}日 ${t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})} - ${N(i.toISOString())}日 ${i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})}`},W=async()=>{try{R.value=!0;const r=await Y.get("/machine/matches");if(r.data&&r.data.length>0){const t=r.data.filter(i=>i.matchesName==="cs2 奥斯汀major");t.length>0?(u.value=t[0].id,w.value=t[0],t.forEach(i=>{const m=i.phase;m in j.value&&(j.value[m]={start:new Date(i.predictStartTime),end:new Date(i.predictEndTime)})}),console.log("比赛信息:",t),console.log("时间限制设置:",j.value)):z.error("未找到可用赛事")}else z.error("未找到可用赛事")}catch(r){console.error("获取赛事ID失败:",r),z.error("获取赛事ID失败")}finally{R.value=!1}},B=r=>{const t=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Shanghai"})),{start:i,end:m}=j.value[r];return t>=i&&t<=m},A=r=>{const t=new Date,{start:i,end:m}=j.value[r];if(t<i){const P=i.getTime()-t.getTime();return`距离开始还有 ${v(P)}`}else{if(t>m)return"竞猜已结束";{const P=m.getTime()-t.getTime();return`距离结束还有 ${v(P)}`}}},v=r=>{const t=Math.floor(r/864e5),i=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),m=Math.floor(r%(1e3*60*60)/(1e3*60)),P=Math.floor(r%(1e3*60)/1e3);return`${t}天${i}小时${m}分${P}秒`},a=()=>{_.value=_.value};J(u,r=>{var t,i,m,P;if(r)switch(_.value){case"onePhase":(t=y.value)==null||t.fetchTeams();break;case"twoPhase":(i=k.value)==null||i.fetchTeams();break;case"threePhase":(m=b.value)==null||m.fetchTeams();break;case"champion":(P=S.value)==null||P.fetchTeams();break}}),J(_,r=>{var t,i,m,P;if(u.value)switch(r){case"onePhase":(t=y.value)==null||t.fetchTeams();break;case"twoPhase":(i=k.value)==null||i.fetchTeams();break;case"threePhase":(m=b.value)==null||m.fetchTeams();break;case"champion":(P=S.value)==null||P.fetchTeams();break}}),oe(async()=>{await W(),I.value=window.setInterval(a,1e3)}),ve(()=>{I.value&&clearInterval(I.value)}),O({getPredictData(){var r,t,i,m;return{onePhase:(r=y.value)==null?void 0:r.getPredictData(),twoPhase:(t=k.value)==null?void 0:t.getPredictData(),threePhase:(i=b.value)==null?void 0:i.getPredictData(),champion:(m=S.value)==null?void 0:m.getPredictData()}}});const d=r=>{const t=document.createElement("canvas");t.width=r.width,t.height=r.height+60;const i=t.getContext("2d");if(!i)return r;i.drawImage(r,0,0),i.font="bold 36px Microsoft YaHei",i.textAlign="center",i.textBaseline="bottom";const m="竞猜作业来源：sb6657.cn",P=t.width/2,l=t.height-20,n=i.measureText(m).width;return i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(P-n/2-10,l-40,n+20,40),i.fillStyle="#ffffff",i.fillText(m,P,l),t},o=async()=>{const r="玩机器烂梗库官方比赛作业，地址sb6657.cn";try{await navigator.clipboard.writeText(r)}catch(t){console.error("复制失败:",t)}try{M.value=!0;const t=document.querySelector(".major-section");if(!t)throw new Error("未找到要截图的元素");const i=await fe(t,{backgroundColor:"#ffffff",scale:1.5,logging:!1,useCORS:!0,allowTaint:!0}),m=d(i),P=document.createElement("a");P.download=`sb6657.cn_CS2Major预测_${new Date().toLocaleDateString()}.jpg`,P.href=m.toDataURL("image/jpeg",1),P.click(),z.success("截图已保存"),Y.get("/machine/shareMatch")}catch(t){console.error("截图失败:",t),z.error("截图失败，请重试")}finally{M.value=!1}};return(r,t)=>{var n,s,$,F,H,Z,Q;const i=ne,m=de,P=ie,l=re;return p(),g("div",bt,[R.value?(p(),g("div",Tt,[T(i,{rows:3,animated:""})])):u.value?(p(),g("div",kt,[e("div",yt,[e("button",{class:C({active:_.value==="onePhase"}),onClick:t[0]||(t[0]=x=>_.value="onePhase")},[t[4]||(t[4]=K(" 第一阶段 ")),_.value==="onePhase"?(p(),g("div",$t,f(A("onePhase")),1)):V("",!0)],2),e("button",{class:C({active:_.value==="twoPhase"}),onClick:t[1]||(t[1]=x=>_.value="twoPhase")},[t[5]||(t[5]=K(" 第二阶段 ")),_.value==="twoPhase"?(p(),g("div",Ct,f(A("twoPhase")),1)):V("",!0)],2),e("button",{class:C({active:_.value==="threePhase"}),onClick:t[2]||(t[2]=x=>_.value="threePhase")},[t[6]||(t[6]=K(" 第三阶段 ")),_.value==="threePhase"?(p(),g("div",Vt,f(A("threePhase")),1)):V("",!0)],2),e("button",{class:C({active:_.value==="champion"}),onClick:t[3]||(t[3]=x=>_.value="champion")},[t[7]||(t[7]=K(" 冠军组 ")),_.value==="champion"?(p(),g("div",wt,f(A("champion")),1)):V("",!0)],2)]),e("div",Pt,[e("div",It,[e("div",qt,[e("img",{src:(n=w.value)==null?void 0:n.matchesImg,alt:(s=w.value)==null?void 0:s.matchesName,class:"match-logo"},null,8,St),e("h2",Dt,f(($=w.value)==null?void 0:$.matchesName),1)]),e("div",Lt,[e("div",Mt,[t[8]||(t[8]=e("span",{class:"label"},"赛事等级：",-1)),e("span",jt,f((F=w.value)==null?void 0:F.level),1)]),e("div",Et,[t[9]||(t[9]=e("span",{class:"label"},"比赛地点：",-1)),e("span",At,f((H=w.value)==null?void 0:H.matchesLocation),1)]),e("div",Bt,[t[10]||(t[10]=e("span",{class:"label"},"比赛时间：",-1)),e("span",Rt,f(N((Z=w.value)==null?void 0:Z.startTime))+"日 - "+f(N((Q=w.value)==null?void 0:Q.endTime))+"日",1)])]),e("div",Nt,[t[12]||(t[12]=e("div",{class:"reward-info"},"竞猜会获得平台虚拟奖章，目前正在做",-1)),T(P,{type:"primary",onClick:o,loading:M.value},{default:h(()=>[T(m,null,{default:h(()=>[T(q(pe))]),_:1}),t[11]||(t[11]=K(" 截图分享预测 "))]),_:1},8,["loading"])])]),_.value==="onePhase"?(p(),g("div",Ut,[e("div",Wt,[e("p",null,"竞猜时间："+f(E("onePhase")),1)]),T(ae,{ref_key:"onePhaseRef",ref:y,isTimeValid:B("onePhase"),matchId:u.value,phase:"onePhase"},null,8,["isTimeValid","matchId"])])):V("",!0),_.value==="twoPhase"?(p(),g("div",zt,[e("div",Ot,[e("p",null,"竞猜时间："+f(E("twoPhase")),1)]),T(ae,{ref_key:"twoPhaseRef",ref:k,isTimeValid:B("twoPhase"),matchId:u.value,phase:"twoPhase"},null,8,["isTimeValid","matchId"])])):V("",!0),_.value==="threePhase"?(p(),g("div",Ft,[e("div",Gt,[e("p",null,"竞猜时间："+f(E("threePhase")),1)]),T(ae,{ref_key:"threePhaseRef",ref:b,isTimeValid:B("threePhase"),matchId:u.value,phase:"threePhase"},null,8,["isTimeValid","matchId"])])):V("",!0),_.value==="champion"?(p(),g("div",Ht,[e("div",Kt,[e("p",null,"竞猜时间："+f(E("champion")),1)]),T(_t,{ref_key:"championRef",ref:S,isTimeValid:B("champion"),matchId:u.value},null,8,["isTimeValid","matchId"])])):V("",!0)])])):(p(),g("div",Zt,[T(l,{description:"暂无可用赛事"})]))])}}}),pa=X(Yt,[["__scopeId","data-v-f3981e47"]]);export{pa as default};
