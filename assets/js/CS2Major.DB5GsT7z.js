import{a as z,c as te,v as ie,M as oe,n as le,L as ne}from"./element-plus.BdlBqtfi.js";import{d as G,b as m,e as J,c as g,a as e,P as T,H as h,u as q,M as f,n as de,o as p,C as w,V as L,K as C,O as ce,a4 as re,k as me,i as ae,I as ue,L as K,S as ve}from"./@vue.Dx4vSINt.js";import{d as D}from"./vuedraggable.BDINTPbw.js";import{_ as X,h as Y,u as he}from"./index.9-pveQSM.js";import{u as ge}from"./vue-router.Cp0X7YIN.js";import{R as pe}from"./@element-plus.DM5O92_U.js";import{h as fe}from"./html2canvas.BfYXEYrK.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.BhPyfUAB.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.hUPcw3xl.js";import"./vue.BdDluSGr.js";import"./pinia.CgDIJrih.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";const _e={class:"major-predict-root"},be={class:"team-pool"},Te=["src","alt"],ke={class:"team-name"},ye={class:"predict-area"},$e={class:"predict-row"},Ce={class:"predict-block"},Ve={class:"predict-label"},we=["src","alt"],Pe={class:"team-name"},Ie=["onClick","disabled"],qe={key:0,class:"empty-slot big"},Se={class:"predict-block"},De={class:"predict-label"},Le=["src","alt"],Me={class:"team-name"},je=["onClick","disabled"],Ee={key:0,class:"empty-slot big"},Ae={class:"predict-row advance-row"},Be={class:"advance-label"},Re=["src","alt"],Ne={class:"team-name"},Ue=["onClick","disabled"],We=G({name:"MatchPredictionBase"}),ze=G({...We,props:{teams:{},firstLabel:{},secondLabel:{},advanceLabel:{},maxAdvance:{},isTimeValid:{type:Boolean}},setup(U,{expose:O}){const u=U,R={name:"teams"},_=m([]),y=m([]),k=m([]),b=m([]);J(()=>u.teams,a=>{_.value=[...a]},{immediate:!0});function S(a){const c=a.draggedContext.element;return!(M(a.from)&&j(c.id))}function I(a){const c=a.draggedContext.element;return!(M(a.from)&&j(c.id))}function P(a){const c=a.draggedContext.element;return!(M(a.from)&&j(c.id))}function M(a){return a&&a.classList&&a.classList.contains("team-list")}function j(a){return y.value.some(c=>c.id===a)||k.value.some(c=>c.id===a)||b.value.some(c=>c.id===a)}function N(a){if(a.added){const c=a.added.element;if(y.value.length>1){const o=y.value.splice(0,1);_.value.push(...o)}k.value=k.value.filter(o=>o.id!==c.id),b.value=b.value.filter(o=>o.id!==c.id)}v()}function E(a){if(a.added){const c=a.added.element;if(k.value.length>1){const o=k.value.splice(0,1);_.value.push(...o)}y.value=y.value.filter(o=>o.id!==c.id),b.value=b.value.filter(o=>o.id!==c.id)}v()}function W(a){if(a.added){const c=a.added.element;if(b.value.length>u.maxAdvance){const o=b.value.splice(0,1);_.value.push(...o)}y.value=y.value.filter(o=>o.id!==c.id),k.value=k.value.filter(o=>o.id!==c.id)}v()}function B(a,c){let o;a==="first"?o=y.value.splice(c,1):o=k.value.splice(c,1),_.value.push(...o),v()}function A(a){const c=b.value.splice(a,1);_.value.push(...c),v()}function v(){de(()=>{const a=[...y.value.map(c=>c.id),...k.value.map(c=>c.id),...b.value.map(c=>c.id)];_.value=_.value.filter(c=>!a.includes(c.id))})}return O({firstTeam:y,secondTeam:k,advanceTeams:b}),(a,c)=>(p(),g("div",_e,[e("div",be,[T(q(D),{list:_.value,group:R,sort:!1,"item-key":"id",class:"team-list","ghost-class":"ghost",disabled:!a.isTimeValid},{item:h(({element:o})=>[(p(),g("div",{class:w(["team-card",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo"},null,8,Te),e("div",ke,f(o.name),1)],2))]),_:1},8,["list","disabled"])]),e("div",ye,[e("div",$e,[e("div",Ce,[e("div",Ve,f(a.firstLabel),1),T(q(D),{list:y.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:S,onChange:N,disabled:!a.isTimeValid},{item:h(({element:o,index:d})=>[(p(),g("div",{class:w(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,we),e("div",Pe,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>B("first",d),["stop"]),disabled:!a.isTimeValid},"×",8,Ie)],2))]),footer:h(()=>[y.value.length===0?(p(),g("div",qe,"?")):C("",!0)]),_:1},8,["list","disabled"])]),e("div",Se,[e("div",De,f(a.secondLabel),1),T(q(D),{list:k.value,group:R,sort:!1,"item-key":"id",class:"predict-slot big","ghost-class":"ghost",move:I,onChange:E,disabled:!a.isTimeValid},{item:h(({element:o,index:d})=>[(p(),g("div",{class:w(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,Le),e("div",Me,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>B("second",d),["stop"]),disabled:!a.isTimeValid},"×",8,je)],2))]),footer:h(()=>[k.value.length===0?(p(),g("div",Ee,"?")):C("",!0)]),_:1},8,["list","disabled"])])]),e("div",Ae,[e("div",Be,f(a.advanceLabel),1),T(q(D),{list:b.value,group:R,sort:!0,"item-key":"id",class:"predict-slot multi big","ghost-class":"ghost",move:P,onChange:W,disabled:!a.isTimeValid},{item:h(({element:o,index:d})=>[(p(),g("div",{class:w(["team-card selected big",{disabled:!a.isTimeValid}]),key:o.id},[e("img",{src:o.logo,alt:o.name,class:"team-logo big"},null,8,Re),e("div",Ne,f(o.name),1),e("button",{class:"remove-btn",onClick:L(t=>A(d),["stop"]),disabled:!a.isTimeValid},"×",8,Ue)],2))]),footer:h(()=>[(p(!0),g(ce,null,re(a.maxAdvance-b.value.length,o=>(p(),g("div",{key:o,class:"empty-slot big"},"?"))),128))]),_:1},8,["list","disabled"])])])]))}}),Oe=X(ze,[["__scopeId","data-v-256d7c5c"]]),ee={getMatchTeams(U,O){return Y.get(`/machine/matches/${U}/teams`,{params:{phase:O}})},submitPrediction(U){return Y.post("/machine/prediction/submit",U)},getUserPredictions(U){return Y.get("/machine/prediction/records",{params:{matchId:U.matchId,phase:U.phase}})}},Fe={class:"major-phase","element-loading-text":"加载队伍数据中..."},Ge={class:"title"},He={class:"save-button"},Ke=G({name:"MajorPhase"}),Ze=G({...Ke,props:{isTimeValid:{type:Boolean},matchId:{},phase:{}},setup(U,{expose:O}){const u=U,R=me(()=>({onePhase:"第一阶段",twoPhase:"第二阶段",threePhase:"第三阶段"})[u.phase]),_=he(),y=m(),k=m([]),b=m([]),S=m([]),I=m([]),P=m(!1),M=m(!1),N=((v,a)=>{let c=null;return function(...o){c&&clearTimeout(c),c=setTimeout(()=>{v.apply(this,o),c=null},a)}})(()=>{u.isTimeValid&&(console.log("触发防抖保存..."),A())},300);J(y,v=>{v&&J([()=>v.firstTeam,()=>v.secondTeam,()=>v.advanceTeams],([a,c,o])=>{k.value=[...a],b.value=[...c],S.value=[...o],!P.value&&!M.value&&u.isTimeValid&&N()},{deep:!0})},{immediate:!0});const E=async()=>{try{P.value=!0,console.log(`获取${R.value}队伍数据，matchId:`,u.matchId);const v=await ee.getMatchTeams(u.matchId,u.phase);console.log("获取到的原始数据:",v.data),I.value=v.data.map(a=>({id:a.id,name:a.teamName,logo:a.teamImgUrl})),console.log("处理后的队伍数据:",I.value)}catch(v){console.error("获取队伍数据失败:",v),z.error("获取队伍数据失败")}finally{P.value=!1}},W=async()=>{var v;if(!u.matchId){console.warn("matchId未设置，跳过获取预测数据");return}try{M.value=!0,P.value=!0,I.value.length===0&&await E();const a=await ee.getUserPredictions({matchId:u.matchId,phase:u.phase,userId:_.userId});if(a.data){let c=Array.isArray(a.data)?a.data[0]:a.data;const o=new Set;if(c.sl){const d=I.value.find(t=>t.id.toString()===c.sl);d&&(k.value=[d],o.add(d.id.toString()))}if(c.ls){const d=I.value.find(t=>t.id.toString()===c.ls);d&&(b.value=[d],o.add(d.id.toString()))}if(c.advance){const d=c.advance.split(","),t=I.value.filter(l=>d.includes(l.id.toString()));S.value=t,t.forEach(l=>o.add(l.id.toString()))}I.value=I.value.filter(d=>!o.has(d.id.toString())),y.value&&(y.value.firstTeam=[...k.value],y.value.secondTeam=[...b.value],y.value.advanceTeams=[...S.value])}else console.log("未找到用户之前的预测数据")}catch(a){if(((v=a.response)==null?void 0:v.status)===401){console.log("用户未登录，跳过获取预测数据");return}console.error("获取预测数据失败:",a),z.error("获取预测数据失败")}finally{P.value=!1,setTimeout(()=>{M.value=!1},100)}},B=()=>{const v=[];return k.value.length||v.push("请选择3-0队伍"),b.value.length||v.push("请选择0-3队伍"),S.value.length!==7&&v.push("请选择7支晋级队伍"),v},A=async()=>{var a,c,o,d,t;const v=B();v.length>0&&z.warning(v.join(`
`));try{const l={matchId:u.matchId,phase:u.phase,s_l:((c=(a=k.value[0])==null?void 0:a.id)==null?void 0:c.toString())||"",l_s:((d=(o=b.value[0])==null?void 0:o.id)==null?void 0:d.toString())||"",advance:S.value.map(V=>V.id)},r=await ee.submitPrediction(l);z.success("预测数据保存成功")}catch(l){if(((t=l.response)==null?void 0:t.status)===401){z.warning("请先登录后再进行预测");return}console.error("保存预测数据失败:",l),z.error("保存预测数据失败")}};return ae(async()=>{u.matchId&&(await E(),await W())}),O({getPredictData(){return{firstTeam:k.value,secondTeam:b.value,advanceTeams:S.value}},fetchTeams:E,fetchUserPrediction:W,validateAndSavePrediction:A}),(v,a)=>{const c=te,o=ie;return ue((p(),g("div",Fe,[e("h2",Ge,f(R.value)+"竞猜作业",1),T(Oe,{ref_key:"predictRef",ref:y,teams:I.value,"first-label":"3-0","second-label":"0-3","advance-label":"3-2或3-1晋级的7支队伍","max-advance":7,isTimeValid:v.isTimeValid,"onUpdate:firstTeam":a[0]||(a[0]=d=>k.value=d),"onUpdate:secondTeam":a[1]||(a[1]=d=>b.value=d),"onUpdate:advanceTeams":a[2]||(a[2]=d=>S.value=d)},null,8,["teams","isTimeValid"]),e("div",He,[T(c,{onClick:A,disabled:!v.isTimeValid},{default:h(()=>a[3]||(a[3]=[K("保存预测")])),_:1},8,["disabled"])])])),[[o,P.value]])}}}),se=X(Ze,[["__scopeId","data-v-b969b510"]]),Ye={class:"major-champion"},Je={class:"bracket-container"},Qe={class:"bracket-stage"},Xe={class:"matches"},xe={class:"match"},es=["src","alt"],ss={class:"team-name"},ts=["onClick","disabled"],as={key:0,class:"empty-slot"},is=["src","alt"],os={class:"team-name"},ls=["onClick","disabled"],ns={key:0,class:"empty-slot"},ds={class:"match"},cs=["src","alt"],rs={class:"team-name"},ms=["onClick","disabled"],us={key:0,class:"empty-slot"},vs=["src","alt"],hs={class:"team-name"},gs=["onClick","disabled"],ps={key:0,class:"empty-slot"},fs={class:"match"},_s=["src","alt"],bs={class:"team-name"},Ts=["onClick","disabled"],ks={key:0,class:"empty-slot"},ys=["src","alt"],$s={class:"team-name"},Cs=["onClick","disabled"],Vs={key:0,class:"empty-slot"},ws={class:"match"},Ps=["src","alt"],Is={class:"team-name"},qs=["onClick","disabled"],Ss={key:0,class:"empty-slot"},Ds=["src","alt"],Ls={class:"team-name"},Ms=["onClick","disabled"],js={key:0,class:"empty-slot"},Es={class:"bracket-stage"},As={class:"matches"},Bs={class:"match"},Rs=["src","alt"],Ns={class:"team-name"},Us=["onClick","disabled"],Ws={key:0,class:"empty-slot"},zs=["src","alt"],Os={class:"team-name"},Fs=["onClick","disabled"],Gs={key:0,class:"empty-slot"},Hs={class:"match"},Ks=["src","alt"],Zs={class:"team-name"},Ys=["onClick","disabled"],Js={key:0,class:"empty-slot"},Qs=["src","alt"],Xs={class:"team-name"},xs=["onClick","disabled"],et={key:0,class:"empty-slot"},st={class:"bracket-stage"},tt={class:"matches"},at={class:"match"},it=["src","alt"],ot={class:"team-name"},lt=["onClick","disabled"],nt={key:0,class:"empty-slot"},dt=["src","alt"],ct={class:"team-name"},rt=["onClick","disabled"],mt={key:0,class:"empty-slot"},ut={class:"bracket-stage champion-stage"},vt={class:"matches"},ht=["src","alt"],gt={class:"team-name"},pt=["onClick","disabled"],ft={key:0,class:"empty-slot champion-empty"},_t=G({name:"MajorChampion"}),bt=G({..._t,props:{isTimeValid:{type:Boolean}},setup(U,{expose:O}){const u={name:"teams"},R=m(),_=m([]),y=m([]),k=m([]),b=m([]),S=m([]),I=m([]),P=m([]),M=m([]),j=m([]),N=m([]),E=m([]),W=m([]),B=m([]),A=m([]),v=m([]),a=m([]),c=m([]),o=m([]),d=i=>{switch(i){case"quarters1":return b;case"quarters2":return S;case"quarters3":return I;case"quarters4":return P;case"quarters5":return M;case"quarters6":return j;case"quarters7":return N;case"quarters8":return E;case"semis1":return W;case"semis2":return B;case"semis3":return A;case"semis4":return v;case"finals1":return a;case"finals2":return c;case"champion":return o;default:return m([])}},t=i=>{const n=i.from.parentElement.id,s=i.to.parentElement.id;if(!n||!s)return!1;if(n===s)return!0;if(n.startsWith("quarters")&&s.startsWith("semis")){const $=parseInt(n.replace("quarters","")),F=parseInt(s.replace("semis",""));if(Math.ceil($/2)===F)return!0}if(n.startsWith("semis")&&s.startsWith("finals")){const $=parseInt(n.replace("semis","")),F=parseInt(s.replace("finals",""));if(Math.ceil($/2)===F)return!0}return!!(n.startsWith("finals")&&s==="champion"||s.startsWith("quarters"))},l=(i,n)=>{const s=d(n);if(i.added){const $=i.added.element;[b,S,I,P,M,j,N,E,W,B,A,v,a,c,o].forEach(H=>{if(H!==s){const Z=H.value.findIndex(Q=>Q.id===$.id);Z!==-1&&H.value.splice(Z,1)}})}};function r(i,n){const s=d(i),$=s.value.findIndex(F=>F.id===n);$!==-1&&s.value.splice($,1)}const V=()=>{const i=R.value;i&&(_.value=[...i.firstTeam],y.value=[...i.secondTeam],k.value=[...i.advanceTeams])};return O({getPredictData(){return V(),{firstTeam:_.value,secondTeam:y.value,advanceTeams:k.value}}}),(i,n)=>(p(),g("div",Ye,[n[22]||(n[22]=e("h2",{class:"title"},"冠军竞猜",-1)),e("div",Je,[e("div",Qe,[n[15]||(n[15]=e("div",{class:"stage-title"},"四分之一决赛",-1)),e("div",Xe,[e("div",xe,[T(q(D),{id:"quarters1",list:b.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[0]||(n[0]=s=>l(s,"quarters1")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,es),e("div",ss,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters1",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,ts)],2)]),footer:h(()=>[b.value.length===0?(p(),g("div",as,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters2",list:S.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[1]||(n[1]=s=>l(s,"quarters2")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,is),e("div",os,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters2",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,ls)],2)]),footer:h(()=>[S.value.length===0?(p(),g("div",ns,"待定")):C("",!0)]),_:1},8,["list","disabled"])]),e("div",ds,[T(q(D),{id:"quarters3",list:I.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[2]||(n[2]=s=>l(s,"quarters3")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,cs),e("div",rs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters3",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,ms)],2)]),footer:h(()=>[I.value.length===0?(p(),g("div",us,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters4",list:P.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[3]||(n[3]=s=>l(s,"quarters4")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,vs),e("div",hs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters4",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,gs)],2)]),footer:h(()=>[P.value.length===0?(p(),g("div",ps,"待定")):C("",!0)]),_:1},8,["list","disabled"])]),e("div",fs,[T(q(D),{id:"quarters5",list:M.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[4]||(n[4]=s=>l(s,"quarters5")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,_s),e("div",bs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters5",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Ts)],2)]),footer:h(()=>[M.value.length===0?(p(),g("div",ks,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters6",list:j.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[5]||(n[5]=s=>l(s,"quarters6")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ys),e("div",$s,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters6",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Cs)],2)]),footer:h(()=>[j.value.length===0?(p(),g("div",Vs,"待定")):C("",!0)]),_:1},8,["list","disabled"])]),e("div",ws,[T(q(D),{id:"quarters7",list:N.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[6]||(n[6]=s=>l(s,"quarters7")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Ps),e("div",Is,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters7",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,qs)],2)]),footer:h(()=>[N.value.length===0?(p(),g("div",Ss,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"quarters8",list:E.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[7]||(n[7]=s=>l(s,"quarters8")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Ds),e("div",Ls,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("quarters8",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Ms)],2)]),footer:h(()=>[E.value.length===0?(p(),g("div",js,"待定")):C("",!0)]),_:1},8,["list","disabled"])])])]),n[19]||(n[19]=e("div",{class:"connector-column"},[e("div",{class:"connector-gap"})],-1)),e("div",Es,[n[16]||(n[16]=e("div",{class:"stage-title"},"半决赛",-1)),e("div",As,[e("div",Bs,[T(q(D),{id:"semis1",list:W.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[8]||(n[8]=s=>l(s,"semis1")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Rs),e("div",Ns,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("semis1",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Us)],2)]),footer:h(()=>[W.value.length===0?(p(),g("div",Ws,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"semis2",list:B.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[9]||(n[9]=s=>l(s,"semis2")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,zs),e("div",Os,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("semis2",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Fs)],2)]),footer:h(()=>[B.value.length===0?(p(),g("div",Gs,"待定")):C("",!0)]),_:1},8,["list","disabled"])]),e("div",Hs,[T(q(D),{id:"semis3",list:A.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[10]||(n[10]=s=>l(s,"semis3")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Ks),e("div",Zs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("semis3",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,Ys)],2)]),footer:h(()=>[A.value.length===0?(p(),g("div",Js,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"semis4",list:v.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[11]||(n[11]=s=>l(s,"semis4")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,Qs),e("div",Xs,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("semis4",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,xs)],2)]),footer:h(()=>[v.value.length===0?(p(),g("div",et,"待定")):C("",!0)]),_:1},8,["list","disabled"])])])]),n[20]||(n[20]=e("div",{class:"connector-column"},[e("div")],-1)),e("div",st,[n[17]||(n[17]=e("div",{class:"stage-title"},"总决赛",-1)),e("div",tt,[e("div",at,[T(q(D),{id:"finals1",list:a.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[12]||(n[12]=s=>l(s,"finals1")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,it),e("div",ot,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("finals1",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,lt)],2)]),footer:h(()=>[a.value.length===0?(p(),g("div",nt,"待定")):C("",!0)]),_:1},8,["list","disabled"]),T(q(D),{id:"finals2",list:c.value,group:u,"item-key":"id",class:"slot","ghost-class":"ghost",onChange:n[13]||(n[13]=s=>l(s,"finals2")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,dt),e("div",ct,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("finals2",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,rt)],2)]),footer:h(()=>[c.value.length===0?(p(),g("div",mt,"待定")):C("",!0)]),_:1},8,["list","disabled"])])])]),n[21]||(n[21]=e("div",{class:"connector-column third"},null,-1)),e("div",ut,[n[18]||(n[18]=e("div",{class:"stage-title"},"冠军",-1)),e("div",vt,[T(q(D),{id:"champion",list:o.value,group:u,"item-key":"id",class:"slot champion-slot","ghost-class":"ghost",onChange:n[14]||(n[14]=s=>l(s,"champion")),move:t,max:1,disabled:!i.isTimeValid},{item:h(({element:s})=>[e("div",{class:w(["team-card selected",{disabled:!i.isTimeValid}])},[e("img",{src:s.logo,alt:s.name,class:"team-logo"},null,8,ht),e("div",gt,f(s.name),1),e("button",{class:"remove-btn",onClick:L($=>r("champion",s.id),["stop"]),disabled:!i.isTimeValid},"×",8,pt)],2)]),footer:h(()=>[o.value.length===0?(p(),g("div",ft,"待定")):C("",!0)]),_:1},8,["list","disabled"])])])])]))}}),Tt=X(bt,[["__scopeId","data-v-526dd3fb"]]),kt={class:"major-container"},yt={key:0,class:"loading-container"},$t={key:1,class:"major-content"},Ct={class:"match-info-panel"},Vt={class:"match-header"},wt=["src","alt"],Pt={class:"match-name"},It={class:"match-details"},qt={class:"info-item"},St={class:"value"},Dt={class:"info-item"},Lt={class:"value"},Mt={class:"info-item"},jt={class:"value"},Et={class:"match-footer"},At={class:"prediction-content"},Bt={class:"tab-buttons"},Rt={key:0,class:"countdown"},Nt={key:0,class:"countdown"},Ut={key:0,class:"countdown"},Wt={key:0,class:"countdown"},zt={key:0,class:"major-section"},Ot={class:"time-info"},Ft={key:1,class:"major-section"},Gt={class:"time-info"},Ht={key:2,class:"major-section"},Kt={class:"time-info"},Zt={key:3,class:"major-section"},Yt={class:"time-info"},Jt={key:2,class:"no-match"},Qt=G({__name:"CS2Major",setup(U,{expose:O}){ge();const u=m(null),R=m(!0),_=m("onePhase"),y=m(),k=m(),b=m(),S=m(),I=m(null),P=m(null),M=m(!1),j=m({onePhase:{start:new Date,end:new Date},twoPhase:{start:new Date,end:new Date},threePhase:{start:new Date,end:new Date},champion:{start:new Date,end:new Date}}),N=d=>new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"Asia/Shanghai"}).replace(/\//g,"年").replace(",","日"),E=d=>{const{start:t,end:l}=j.value[d];return`${N(t.toISOString())}日 ${t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})} - ${N(l.toISOString())}日 ${l.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1})}`},W=async()=>{try{R.value=!0;const d=await Y.get("/machine/matches");if(d.data&&d.data.length>0){const t=d.data.filter(l=>l.matchesName==="cs2 奥斯汀major");t.length>0?(u.value=t[0].id,P.value=t[0],t.forEach(l=>{const r=l.phase;r in j.value&&(j.value[r]={start:new Date(l.predictStartTime),end:new Date(l.predictEndTime)})}),console.log("比赛信息:",t),console.log("时间限制设置:",j.value)):z.error("未找到可用赛事")}else z.error("未找到可用赛事")}catch(d){console.error("获取赛事ID失败:",d),z.error("获取赛事ID失败")}finally{R.value=!1}},B=d=>{const t=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Shanghai"})),{start:l,end:r}=j.value[d];return t>=l&&t<=r},A=d=>{const t=new Date,{start:l,end:r}=j.value[d];if(t<l){const V=l.getTime()-t.getTime();return`距离开始还有 ${v(V)}`}else{if(t>r)return"竞猜已结束";{const V=r.getTime()-t.getTime();return`距离结束还有 ${v(V)}`}}},v=d=>{const t=Math.floor(d/864e5),l=Math.floor(d%(1e3*60*60*24)/(1e3*60*60)),r=Math.floor(d%(1e3*60*60)/(1e3*60)),V=Math.floor(d%(1e3*60)/1e3);return`${t}天${l}小时${r}分${V}秒`},a=()=>{_.value=_.value};J(u,d=>{var t,l,r,V;if(d)switch(_.value){case"onePhase":(t=y.value)==null||t.fetchTeams();break;case"twoPhase":(l=k.value)==null||l.fetchTeams();break;case"threePhase":(r=b.value)==null||r.fetchTeams();break;case"champion":(V=S.value)==null||V.fetchTeams();break}}),J(_,d=>{var t,l,r,V;if(u.value)switch(d){case"onePhase":(t=y.value)==null||t.fetchTeams();break;case"twoPhase":(l=k.value)==null||l.fetchTeams();break;case"threePhase":(r=b.value)==null||r.fetchTeams();break;case"champion":(V=S.value)==null||V.fetchTeams();break}}),ae(async()=>{await W(),I.value=window.setInterval(a,1e3)}),ve(()=>{I.value&&clearInterval(I.value)}),O({getPredictData(){var d,t,l,r;return{onePhase:(d=y.value)==null?void 0:d.getPredictData(),twoPhase:(t=k.value)==null?void 0:t.getPredictData(),threePhase:(l=b.value)==null?void 0:l.getPredictData(),champion:(r=S.value)==null?void 0:r.getPredictData()}}});const c=d=>{const t=document.createElement("canvas");t.width=d.width,t.height=d.height+60;const l=t.getContext("2d");if(!l)return d;l.drawImage(d,0,0),l.font="bold 36px Microsoft YaHei",l.textAlign="center",l.textBaseline="bottom";const r="竞猜作业来源：sb6657.cn",V=t.width/2,i=t.height-20,n=l.measureText(r).width;return l.fillStyle="rgba(0, 0, 0, 0.5)",l.fillRect(V-n/2-10,i-40,n+20,40),l.fillStyle="#ffffff",l.fillText(r,V,i),t},o=async()=>{const d="玩机器烂梗库官方比赛作业，地址sb6657.cn";try{await navigator.clipboard.writeText(d)}catch(t){console.error("复制失败:",t)}try{M.value=!0;const t=document.querySelector(".major-section");if(!t)throw new Error("未找到要截图的元素");const l=await fe(t,{backgroundColor:"#ffffff",scale:1.5,logging:!1,useCORS:!0,allowTaint:!0}),r=c(l),V=document.createElement("a");V.download=`sb6657.cn_CS2Major预测_${new Date().toLocaleDateString()}.jpg`,V.href=r.toDataURL("image/jpeg",1),V.click(),z.success("截图已保存"),Y.get("/machine/shareMatch")}catch(t){console.error("截图失败:",t),z.error("截图失败，请重试")}finally{M.value=!1}};return(d,t)=>{var n,s,$,F,H,Z,Q;const l=oe,r=le,V=te,i=ne;return p(),g("div",kt,[R.value?(p(),g("div",yt,[T(l,{rows:3,animated:""})])):u.value?(p(),g("div",$t,[e("div",Ct,[e("div",Vt,[e("img",{src:(n=P.value)==null?void 0:n.matchesImg,alt:(s=P.value)==null?void 0:s.matchesName,class:"match-logo"},null,8,wt),e("h2",Pt,f(($=P.value)==null?void 0:$.matchesName),1)]),e("div",It,[e("div",qt,[t[4]||(t[4]=e("span",{class:"label"},"赛事等级：",-1)),e("span",St,f((F=P.value)==null?void 0:F.level),1)]),e("div",Dt,[t[5]||(t[5]=e("span",{class:"label"},"比赛地点：",-1)),e("span",Lt,f((H=P.value)==null?void 0:H.matchesLocation),1)]),e("div",Mt,[t[6]||(t[6]=e("span",{class:"label"},"比赛时间：",-1)),e("span",jt,f(N((Z=P.value)==null?void 0:Z.startTime))+"日 - "+f(N((Q=P.value)==null?void 0:Q.endTime))+"日",1)])]),e("div",Et,[t[8]||(t[8]=e("div",{class:"reward-info"},"竞猜会获得平台虚拟奖章，目前正在做",-1)),T(V,{type:"primary",onClick:o,loading:M.value},{default:h(()=>[T(r,null,{default:h(()=>[T(q(pe))]),_:1}),t[7]||(t[7]=K(" 截图分享预测 "))]),_:1},8,["loading"])])]),e("div",At,[e("div",Bt,[e("button",{class:w({active:_.value==="onePhase"}),onClick:t[0]||(t[0]=x=>_.value="onePhase")},[t[9]||(t[9]=K(" 第一阶段 ")),_.value==="onePhase"?(p(),g("div",Rt,f(A("onePhase")),1)):C("",!0)],2),e("button",{class:w({active:_.value==="twoPhase"}),onClick:t[1]||(t[1]=x=>_.value="twoPhase")},[t[10]||(t[10]=K(" 第二阶段 ")),_.value==="twoPhase"?(p(),g("div",Nt,f(A("twoPhase")),1)):C("",!0)],2),e("button",{class:w({active:_.value==="threePhase"}),onClick:t[2]||(t[2]=x=>_.value="threePhase")},[t[11]||(t[11]=K(" 第三阶段 ")),_.value==="threePhase"?(p(),g("div",Ut,f(A("threePhase")),1)):C("",!0)],2),e("button",{class:w({active:_.value==="champion"}),onClick:t[3]||(t[3]=x=>_.value="champion")},[t[12]||(t[12]=K(" 冠军组 ")),_.value==="champion"?(p(),g("div",Wt,f(A("champion")),1)):C("",!0)],2)]),_.value==="onePhase"?(p(),g("div",zt,[e("div",Ot,[e("p",null,"竞猜时间："+f(E("onePhase")),1)]),T(se,{ref_key:"onePhaseRef",ref:y,isTimeValid:B("onePhase"),matchId:u.value,phase:"onePhase"},null,8,["isTimeValid","matchId"])])):C("",!0),_.value==="twoPhase"?(p(),g("div",Ft,[e("div",Gt,[e("p",null,"竞猜时间："+f(E("twoPhase")),1)]),T(se,{ref_key:"twoPhaseRef",ref:k,isTimeValid:B("twoPhase"),matchId:u.value,phase:"twoPhase"},null,8,["isTimeValid","matchId"])])):C("",!0),_.value==="threePhase"?(p(),g("div",Ht,[e("div",Kt,[e("p",null,"竞猜时间："+f(E("threePhase")),1)]),T(se,{ref_key:"threePhaseRef",ref:b,isTimeValid:B("threePhase"),matchId:u.value,phase:"threePhase"},null,8,["isTimeValid","matchId"])])):C("",!0),_.value==="champion"?(p(),g("div",Zt,[e("div",Yt,[e("p",null,"竞猜时间："+f(E("champion")),1)]),T(Tt,{ref_key:"championRef",ref:S,isTimeValid:B("champion"),matchId:u.value},null,8,["isTimeValid","matchId"])])):C("",!0)])])):(p(),g("div",Jt,[T(i,{description:"暂无可用赛事"})]))])}}}),_a=X(Qt,[["__scopeId","data-v-1506bf1e"]]);export{_a as default};
