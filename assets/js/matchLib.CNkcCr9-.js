import{d as se,h as l,f as ne,U as le,al as r,ar as re,c as v,o as u,a as t,R as s,Q as R,a6 as W,J as n,K as ie,I as S,O as M,P as i,L as j,u as y,W as ce}from"./@vue.BltuATdo.js";import{V as de,n as F}from"./@element-plus.D0bpsst8.js";import{h as A,_ as ue}from"./index.DgJ3o_AM.js";import{f as me,t as pe}from"./flip-num.Bu65-HLq.js";import{c as _e,a as he,p as ve,l as ge,b as fe}from"./setMeme.--xdfDs-.js";import{u as be,e as ye}from"./time.C7v2r0It.js";import{a as w}from"./element-plus.C4Wz9kMa.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.BFvkXMb7.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const we={class:"match-library"},Te={class:"match-list"},Ce={class:"card-content"},xe={class:"image-container"},Le=["src"],ke={class:"match-info"},Se={class:"match-header"},Me={class:"match-name"},Ve={class:"match-details"},ze={class:"match-location"},Ue={class:"match-time"},Pe={class:"time-item"},Ee={class:"time-item"},Ne={class:"pagination-container"},Be={class:"memes-view"},De={class:"card-table"},Ie=["onTouchstart","onTouchend"],$e={class:"barrage-text"},Re={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},We=["src"],je={style:{"vertical-align":"middle"}},Fe={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},Ae={class:"pagination-wrapper"},Je=se({__name:"matchLib",setup(Ke){const V=be(),z=l([]),U=l(0),g=l(1),J=l(20),T=l(!1),f=l(null),P=l([]),b=l(!1),E=l(0),C=l(50),h=l(1),x=l([]),K=pe(fe,ge,2e3),N=l(window.innerWidth<=768),B=()=>{N.value=window.innerWidth<=768},D=async()=>{try{const e=await A.get("/machine/getMatchList",{params:{pageNum:g.value,pageSize:J.value}});e.code===200?(z.value=e.data.list,U.value=e.data.total):w.error(e.msg||"Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•")}catch(e){w.error("Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•"),console.error("Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•:",e)}},O=e=>{g.value=e,D()},Q=e=>{f.value=e,T.value=!0,h.value=1,L(1)},L=async e=>{if(f.value){b.value=!0;try{const o=await A.get("/machine/matchPageList",{params:{pageNum:e,pageSize:C.value,matchId:f.value.id}});o.code===200?(P.value=o.data.list,E.value=o.data.total):w.error(o.msg||"Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•")}catch(o){w.error("Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•"),console.error("Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•:",o)}finally{b.value=!1}}},I=async e=>{const o=e.barrage,c=K(o);if(!(!c||c==="limitedSuccess")){_e();try{if(await he("match",e.id,h.value,C.value)){await L(h.value);return}}catch(p){console.error("Â§çÂà∂Ê¨°Êï∞+1Â§±Ë¥•:",p)}ve()}},q=e=>{h.value=e,L(e)},G=e=>{if(!e||e.trim()==="")return[];const o=Array.from(new Set(e.split(",").map(d=>d.trim())));if(!x.value)return o.map(()=>({label:"",iconUrl:""}));const c=new Map(x.value.map(d=>[String(d.dictValue).trim(),d]));return o.map(d=>{const _=c.get(d);return _?{label:_.dictLabel,iconUrl:_.iconUrl}:{label:"",iconUrl:""}})};V.tagsLoaded.then(()=>{x.value=V.memeTags});const H=e=>{e.touchStartTime=Date.now()},X=e=>{Date.now()-e.touchStartTime>100&&(e.popoverVisible=!0,setTimeout(()=>{e.popoverVisible=!1},1500))};return ne(()=>{D(),window.addEventListener("resize",B)}),le(()=>{window.removeEventListener("resize",B)}),(e,o)=>{var $;const c=r("el-tag"),p=r("el-icon"),d=r("el-card"),_=r("el-pagination"),k=r("el-table-column"),Y=r("el-popover"),Z=r("el-button"),ee=r("el-table"),te=r("el-dialog"),ae=re("loading");return u(),v("div",we,[o[3]||(o[3]=t("div",{class:"card"},[t("span",null,"ÊäïÁ®øÊó∂ÂãæÈÄâÂÖ≥ËÅîËµõ‰∫ãÂ∫ìÂ∞ÜÂä†ÂÖ•Êüê‰∏ÄËµõ‰∫ãÂàõ‰ΩúÁöÑÁÉÇÊ¢óÔºåÁõÆÂâçÂè™Êî∂ÂΩïÂ§ßÂûãËµõ‰∫ã"),t("p",null,"È°µÈù¢‰ªÖÂ±ïÁ§∫Êî∂ÂΩï‰∫éËµõ‰∫ãÊúüÈó¥Âàõ‰ΩúÁöÑÁÉÇÊ¢ó")],-1)),t("div",Te,[(u(!0),v(R,null,W(z.value,a=>(u(),S(d,{key:a.id,class:"match-card","body-style":{padding:"0px"},onClick:m=>Q(a)},{default:n(()=>[t("div",Ce,[t("div",xe,[t("img",{src:a.matchesImg,class:"match-image"},null,8,Le)]),t("div",ke,[t("div",Se,[t("h3",Me,i(a.matchesName),1),s(c,{size:"small",type:"success",class:"match-level"},{default:n(()=>[M(i(a.level),1)]),_:2},1024)]),t("div",Ve,[t("div",ze,[s(p,null,{default:n(()=>[s(y(de))]),_:1}),t("span",null,i(a.matchesLocation),1)]),t("div",Ue,[t("div",Pe,[s(p,null,{default:n(()=>[s(y(F))]),_:1}),t("span",null,"ÂºÄÂßãÔºö"+i(a.startTime),1)]),t("div",Ee,[s(p,null,{default:n(()=>[s(y(F))]),_:1}),t("span",null,"ÁªìÊùüÔºö"+i(a.endTime),1)])])])])])]),_:2},1032,["onClick"]))),128))]),t("div",Ne,[s(_,{"current-page":g.value,"onUpdate:currentPage":o[0]||(o[0]=a=>g.value=a),total:U.value,layout:"total,prev, pager, next",onCurrentChange:O},null,8,["current-page","total"])]),s(te,{modelValue:T.value,"onUpdate:modelValue":o[1]||(o[1]=a=>T.value=a),title:($=f.value)==null?void 0:$.matchesName,width:N.value?"100%":"75%",class:"match-dialog","destroy-on-close":""},{default:n(()=>[t("div",Be,[t("div",De,[ie((u(),S(ee,{data:P.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"ÊöÇÊó†ÁÉÇÊ¢óÔºåÂø´Êù•ÊäïÁ®øÂêßÔºÅ",onRowClick:I},{default:n(()=>[s(k,{align:"center",width:"60"},{default:n(a=>[s(c,{round:"",effect:"plain"},{default:n(()=>[M(i(a.row.id),1)]),_:2},1024)]),_:1}),s(k,{prop:"barrage"},{default:n(a=>[s(Y,{placement:"top",width:"auto",trigger:"hover",visible:a.row.popoverVisible},{reference:n(()=>[t("div",{style:{cursor:"pointer"},onTouchstart:m=>H(a.row),onTouchend:m=>X(a.row)},[t("span",$e,i(a.row.barrage),1)],40,Ie)]),default:n(()=>[t("div",Re,[(u(!0),v(R,null,W(G(a.row.tags),(m,oe)=>(u(),v("div",{key:oe,style:{"margin-right":"8px"}},[s(c,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:n(()=>[m.iconUrl?(u(),v("img",{key:0,src:m.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,We)):j("",!0),t("span",je,i(m.label),1)]),_:2},1024)]))),128)),t("span",Fe," ÊäïÁ®øÊó∂Èó¥: "+i(y(ye)(a.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),s(k,{align:"center",width:"100"},{default:n(a=>[s(Z,{type:"primary",class:"copy-btn",onClick:ce(m=>I(a.row),["stop"])},{default:n(()=>[o[2]||(o[2]=M(" Â§çÂà∂ üåà",-1)),s(me,{num:a.row.cnt},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,b.value]]),t("div",Ae,[b.value?j("",!0):(u(),S(_,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":h.value,total:E.value,"pager-count":3,"page-size":C.value,onCurrentChange:q},null,8,["current-page","total","page-size"]))])])])]),_:1},8,["modelValue","title","width"])])}}}),mt=ue(Je,[["__scopeId","data-v-1a8cf0ee"]]);export{mt as default};
