import{d as ne,h as l,f as le,U as re,al as r,ar as ie,c as v,o as u,a as t,R as s,Q as R,a6 as W,J as n,K as ce,I as k,O as S,P as i,L as j,W as de,u as M}from"./@vue.BltuATdo.js";import{V as ue,n as A}from"./@element-plus.BgPfl9pw.js";import{h as F,_ as me}from"./index.BBfoH8pv.js";import{f as pe,t as _e}from"./flip-num.CU8-DjBm.js";import{c as he,a as ve,p as ge,l as fe,b as be}from"./setMeme.BQIukcnw.js";import{u as we}from"./memeTags.Dg3Agatx.js";import{a as w}from"./element-plus.DQRrSmQa.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.oDprkwHL.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const ye={class:"match-library"},Te={class:"match-list"},Ce={class:"card-content"},xe={class:"image-container"},Le=["src"],ke={class:"match-info"},Se={class:"match-header"},Me={class:"match-name"},Ve={class:"match-details"},ze={class:"match-location"},Ue={class:"match-time"},Pe={class:"time-item"},Ee={class:"time-item"},Ne={class:"pagination-container"},Be={class:"memes-view"},De={class:"card-table"},Ie=["onTouchstart","onTouchend"],$e={class:"barrage-text"},Re={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},We=["src"],je={style:{"vertical-align":"middle"}},Ae={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},Fe={class:"pagination-wrapper"},Je=ne({__name:"matchLib",setup(Ke){const V=we(),z=l([]),U=l(0),g=l(1),J=l(20),y=l(!1),f=l(null),P=l([]),b=l(!1),E=l(0),T=l(50),h=l(1),C=l([]),K=_e(be,fe,2e3),N=l(window.innerWidth<=768),B=()=>{N.value=window.innerWidth<=768},D=async()=>{try{const e=await F.get("/machine/getMatchList",{params:{pageNum:g.value,pageSize:J.value}});e.code===200?(z.value=e.data.list,U.value=e.data.total):w.error(e.msg||"Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•")}catch(e){w.error("Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•"),console.error("Ëé∑ÂèñËµõ‰∫ãÂàóË°®Â§±Ë¥•:",e)}},O=e=>{g.value=e,D()},Q=e=>{f.value=e,y.value=!0,h.value=1,x(1)},x=async e=>{if(f.value){b.value=!0;try{const o=await F.get("/machine/matchPageList",{params:{pageNum:e,pageSize:T.value,matchId:f.value.id}});o.code===200?(P.value=o.data.list,E.value=o.data.total):w.error(o.msg||"Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•")}catch(o){w.error("Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•"),console.error("Ëé∑ÂèñÁÉÇÊ¢óÂàóË°®Â§±Ë¥•:",o)}finally{b.value=!1}}},I=async e=>{const o=e.barrage,c=K(o);if(!(!c||c==="limitedSuccess")){he();try{if(await ve("match",e.id,h.value,T.value)){await x(h.value);return}}catch(p){console.error("Â§çÂà∂Ê¨°Êï∞+1Â§±Ë¥•:",p)}ge()}},q=e=>{h.value=e,x(e)},G=e=>{if(!e||e.trim()==="")return[];const o=Array.from(new Set(e.split(",").map(d=>d.trim())));if(!C.value)return o.map(()=>({label:"",iconUrl:""}));const c=new Map(C.value.map(d=>[String(d.dictValue).trim(),d]));return o.map(d=>{const _=c.get(d);return _?{label:_.dictLabel,iconUrl:_.iconUrl}:{label:"",iconUrl:""}})};V.tagsLoaded.then(()=>{C.value=V.memeTags});const H=e=>{e.touchStartTime=Date.now()},X=e=>{Date.now()-e.touchStartTime>100&&(e.popoverVisible=!0,setTimeout(()=>{e.popoverVisible=!1},1500))},Y=e=>e?e.replace("T"," ").split(".")[0]:"";return le(()=>{D(),window.addEventListener("resize",B)}),re(()=>{window.removeEventListener("resize",B)}),(e,o)=>{var $;const c=r("el-tag"),p=r("el-icon"),d=r("el-card"),_=r("el-pagination"),L=r("el-table-column"),Z=r("el-popover"),ee=r("el-button"),te=r("el-table"),ae=r("el-dialog"),oe=ie("loading");return u(),v("div",ye,[o[3]||(o[3]=t("div",{class:"card"},[t("span",null,"ÊäïÁ®øÊó∂ÂãæÈÄâÂÖ≥ËÅîËµõ‰∫ãÂ∫ìÂ∞ÜÂä†ÂÖ•Êüê‰∏ÄËµõ‰∫ãÂàõ‰ΩúÁöÑÁÉÇÊ¢óÔºåÁõÆÂâçÂè™Êî∂ÂΩïÂ§ßÂûãËµõ‰∫ã"),t("p",null,"È°µÈù¢‰ªÖÂ±ïÁ§∫Êî∂ÂΩï‰∫éËµõ‰∫ãÊúüÈó¥Âàõ‰ΩúÁöÑÁÉÇÊ¢ó")],-1)),t("div",Te,[(u(!0),v(R,null,W(z.value,a=>(u(),k(d,{key:a.id,class:"match-card","body-style":{padding:"0px"},onClick:m=>Q(a)},{default:n(()=>[t("div",Ce,[t("div",xe,[t("img",{src:a.matchesImg,class:"match-image"},null,8,Le)]),t("div",ke,[t("div",Se,[t("h3",Me,i(a.matchesName),1),s(c,{size:"small",type:"success",class:"match-level"},{default:n(()=>[S(i(a.level),1)]),_:2},1024)]),t("div",Ve,[t("div",ze,[s(p,null,{default:n(()=>[s(M(ue))]),_:1}),t("span",null,i(a.matchesLocation),1)]),t("div",Ue,[t("div",Pe,[s(p,null,{default:n(()=>[s(M(A))]),_:1}),t("span",null,"ÂºÄÂßãÔºö"+i(a.startTime),1)]),t("div",Ee,[s(p,null,{default:n(()=>[s(M(A))]),_:1}),t("span",null,"ÁªìÊùüÔºö"+i(a.endTime),1)])])])])])]),_:2},1032,["onClick"]))),128))]),t("div",Ne,[s(_,{"current-page":g.value,"onUpdate:currentPage":o[0]||(o[0]=a=>g.value=a),total:U.value,layout:"total,prev, pager, next",onCurrentChange:O},null,8,["current-page","total"])]),s(ae,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=a=>y.value=a),title:($=f.value)==null?void 0:$.matchesName,width:N.value?"100%":"75%",class:"match-dialog","destroy-on-close":""},{default:n(()=>[t("div",Be,[t("div",De,[ce((u(),k(te,{data:P.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"ÊöÇÊó†ÁÉÇÊ¢óÔºåÂø´Êù•ÊäïÁ®øÂêßÔºÅ",onRowClick:I},{default:n(()=>[s(L,{align:"center",width:"60"},{default:n(a=>[s(c,{round:"",effect:"plain"},{default:n(()=>[S(i(a.row.id),1)]),_:2},1024)]),_:1}),s(L,{prop:"barrage"},{default:n(a=>[s(Z,{placement:"top",width:"auto",trigger:"hover",visible:a.row.popoverVisible},{reference:n(()=>[t("div",{style:{cursor:"pointer"},onTouchstart:m=>H(a.row),onTouchend:m=>X(a.row)},[t("span",$e,i(a.row.barrage),1)],40,Ie)]),default:n(()=>[t("div",Re,[(u(!0),v(R,null,W(G(a.row.tags),(m,se)=>(u(),v("div",{key:se,style:{"margin-right":"8px"}},[s(c,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:n(()=>[m.iconUrl?(u(),v("img",{key:0,src:m.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,We)):j("",!0),t("span",je,i(m.label),1)]),_:2},1024)]))),128)),t("span",Ae," ÊäïÁ®øÊó∂Èó¥: "+i(Y(a.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),s(L,{align:"center",width:"100"},{default:n(a=>[s(ee,{type:"primary",class:"copy-btn",onClick:de(m=>I(a.row),["stop"])},{default:n(()=>[o[2]||(o[2]=S(" Â§çÂà∂ üåà",-1)),s(pe,{num:a.row.cnt},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,b.value]]),t("div",Fe,[b.value?j("",!0):(u(),k(_,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":h.value,total:E.value,"pager-count":3,"page-size":T.value,onCurrentChange:q},null,8,["current-page","total","page-size"]))])])])]),_:1},8,["modelValue","title","width"])])}}}),mt=me(Je,[["__scopeId","data-v-571ab0b5"]]);export{mt as default};
