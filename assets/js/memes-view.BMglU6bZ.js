import{n as z,o as F,p as $,b as q,l as D,a as T,e as I,k as V,c as L,d as j,r as A,q as O,v as W}from"./element-plus.C3kSHAgf.js";import{d as S,az as Z,Z as H,o as C,M as U,O as a,a as _,U as e,S as m,k as J,r as v,w as G,c as K,P as X,T as E,a2 as Y,R as ee}from"./@vue.kwc71ESp.js";import{u as te,b as oe}from"./vue-router.DkBAQHKx.js";import{M as ae,_ as le}from"./index.D2Wq063l.js";import{e as ne,f as se,c as re,a as ie,p as ue,t as ce,l as me,b as pe}from"./setMeme.BL9mD9N9.js";import"./lodash-es.CiJSjksT.js";import"./@vueuse.Bmvu7DnR.js";import"./@element-plus.CQ2moJ0T.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.CdCgAjqw.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const de={class:"dialog-footer"},_e=S({__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(P){const i=Z(P,"modelValue"),k={category:[{required:!0,message:"请选择分栏",trigger:"blur"}],content:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},l=H({category:"",content:""});async function c(){return l.content===""?(V.error("烂梗内容不能为空"),!1):l.category===""?(V.error("分类不能为空"),!1):await ne(l.category,l.content)?(V.success("投稿成功，审核完成后展示(一天内)"),!0):(V.error("投稿失败，必要时请及时反馈bug"),!1)}async function b(){await c()&&(i.value=!1,l.content="",l.category="")}async function y(){await c()&&(l.content="")}return(p,o)=>{const s=z,M=F,w=$,h=q,f=D,g=T,n=I;return C(),U(n,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value=t),draggable:"",title:"投稿弹幕",width:"82%"},{footer:a(()=>[_("div",de,[e(g,{onClick:o[2]||(o[2]=t=>i.value=!1)},{default:a(()=>o[4]||(o[4]=[m("关闭")])),_:1}),e(g,{type:"primary",onClick:b},{default:a(()=>o[5]||(o[5]=[m("投稿并关闭")])),_:1}),e(g,{type:"primary",onClick:y},{default:a(()=>o[6]||(o[6]=[m("连续投稿")])),_:1})])]),default:a(()=>[e(f,{model:l,"label-width":"100px",rules:k,"label-position":"right"},{default:a(()=>[e(w,{label:"分栏","label-width":100,prop:"category"},{default:a(()=>[e(M,{modelValue:l.category,"onUpdate:modelValue":o[0]||(o[0]=t=>l.category=t),placeholder:"选择上传的分栏"},{default:a(()=>[e(s,{label:"喷玩机器篇",value:"machine_penWJQ"}),e(s,{label:"木柜子篇",value:"machine_mygo"}),e(s,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),e(s,{label:"喷选手篇",value:"machine_penPlayer"}),e(s,{label:"+1",value:"machine_p1"}),e(s,{label:"群魔乱舞篇",value:"machine_QMLW"}),e(s,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"弹幕内容",prop:"content"},{default:a(()=>[e(h,{maxlength:"255",modelValue:l.content,"onUpdate:modelValue":o[1]||(o[1]=t=>l.content=t),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),fe={class:"memes-view"},ge={class:"card-table"},ve={class:"top"},be={class:"index"},ye={class:"pagination-wrapper"},x=50,we=S({__name:"memes-view",setup(P){const i=te(),k=oe(),l=J(()=>ae.find(n=>n.path===i.path)),c=v(!0),b=v([]),y=v(0),p=v(1);async function o(n){var d;const t=(d=l.value)==null?void 0:d.category;if(!t){k.push("/404");return}const r=await se(t,n,x);r&&(b.value=r.memeArr,y.value=r.total,c.value=!1)}o(1),G(()=>i.path,()=>{console.log("当前页面path:",i.path),p.value=1,c.value=!0,o(1)});const s=()=>{window.scrollTo({top:0,behavior:"smooth"})},M=n=>{p.value=n,s(),o(n)},w=ce(pe,me,2e3);async function h(n){const t=n.content,r=w(t);if(!(!r||r==="limitedSuccess")){if(re(),await ie(n.category,n.id,p.value,x)){await o(p.value);return}ue()}}const f=v(!1),g=()=>{f.value=!0};return(n,t)=>{const r=T,d=L,B=j,Q=A,R=O,N=W;return C(),K("div",fe,[_("div",ge,[_("div",ve,[t[2]||(t[2]=_("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿！→→",-1)),e(r,{type:"primary",onClick:g},{default:a(()=>t[1]||(t[1]=[m("烂梗投稿")])),_:1})]),X((C(),U(B,{data:b.value,stripe:"","cell-class-name":"hover-pointer",onRowClick:h},{default:a(()=>[e(d,{align:"center",width:"60"},{default:a(u=>[_("span",be,E(u.row.id),1)]),_:1}),e(d,{prop:"content"},{default:a(u=>[m(E(u.row.content),1)]),_:1}),e(d,{align:"center",width:"100"},{default:a(u=>[e(r,{type:"primary",class:"copy-btn",onClick:Y(he=>h(u.row),["stop"])},{default:a(()=>[m("复制 ("+E(u.row.copyCount)+")",1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,c.value]]),_("div",ye,[c.value?ee("",!0):(C(),U(Q,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":p.value,total:y.value,"pager-count":4,"page-size":x,onCurrentChange:M},null,8,["current-page","total"]))])]),e(_e,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=u=>f.value=u)},null,8,["modelValue"]),e(R,{right:50,bottom:50},{default:a(()=>t[3]||(t[3]=[m("UP")])),_:1})])}}}),$e=le(we,[["__scopeId","data-v-9e3f9e3e"]]);export{$e as default};
