import{a as S,j as Y,n as Q,l as Z,c as ee,F as te,G as ae,C as ne,e as se,f as oe,d as re,H as le}from"./element-plus.BdlBqtfi.js";import{_ as ie,a as ce,b as de,c as me,C as ue}from"./sendPost.vue_vue_type_style_index_0_scoped_86d80eb7_lang.ChTBQg6v.js";import{h,A as pe,_ as j}from"./index.C76xW52-.js";import{a as be}from"./setMeme.DzYBJlGu.js";import{C as ge}from"./CommunityNorms.B1CUO8-P.js";import{d as O,b as l,X as fe,k as G,o as r,c as d,a as n,P as o,H as c,L as f,K as N,D as _e,G as q,u as ye,O as L,ag as K,i as ve,I as he,a4 as R,M as g}from"./@vue.Dx4vSINt.js";import{a as ke}from"./clipboard.BVAo7oTf.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.BhPyfUAB.js";import"./@element-plus.DM5O92_U.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.hUPcw3xl.js";import"./pinia.CgDIJrih.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.Cp0X7YIN.js";const Ce={class:"post-form"},we={class:"form-header"},Se={key:0},Ne={key:0,style:{display:"flex",gap:"10px"}},xe={class:"form-footer"},Ve=["innerHTML"],Me=O({__name:"sendPost",setup(X){const k=l(!1),_=l(!1),y=l("");l(0);const v=l(!1),p=l(""),C=l(null),w=fe({filteredItems:[]}),x=()=>{h.post(pe.SEARCH_MEME,{barrage:p.value}).then(m=>{w.filteredItems=m.data||[]}).catch(m=>{console.error("搜索失败",m)})},B=G(()=>p.value===""?"width: 80%;":"width: 20%;"),F=G(()=>w.filteredItems.map(m=>({id:m.id,barrage:m.barrage}))),V=async()=>{if(!y.value.trim()){S.warning("内容不能为空");return}try{const m=await h.post("/machine/Post/ReviewPost/submit",{barrageId:C.value,content:y.value.trim()});m.code===200?(S.success("发帖成功！等待审核中～"),y.value=""):S.error(m.msg||"发帖失败")}catch{S.error("网络错误，发帖失败")}};return(m,a)=>{const M=Y,A=K("InfoFilled"),I=Q,E=Z,$=ee,D=te,T=ae,U=ne,e=se;return r(),d(L,null,[n("div",Ce,[o(U,null,{default:c(()=>[n("div",we,[a[10]||(a[10]=n("h3",null,"发帖",-1)),o(M,{type:"textarea",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),placeholder:"发布帖子...   使用AI辅助人工自动审核，请注意发言规范。",maxlength:"299","show-word-limit":""},null,8,["modelValue"]),o(E,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),size:"large"},{default:c(()=>[a[8]||(a[8]=f(" 关联烂梗 ")),v.value?(r(),d("span",Se,[o(I,null,{default:c(()=>[o(A)]),_:1}),a[7]||(a[7]=f(" 先在左边搜索然后右边选择一条关联⬇️"))])):N("",!0)]),_:1},8,["modelValue"]),v.value?(r(),d("span",Ne,[o(M,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=t=>p.value=t),placeholder:"查找烂梗,点击搜索后右边选择关联",style:_e(B.value)},null,8,["modelValue","style"]),o($,{style:{width:"70px"},type:"primary",onClick:x},{default:c(()=>a[9]||(a[9]=[f("搜索")])),_:1}),w.filteredItems.length?(r(),q(D,{key:0,options:F.value,props:{checkStrictly:!0,emitPath:!1,label:"barrage",value:"id"},clearable:"",teleported:"true","popper-class":"barrage-cascader-popper",placeholder:"选择关联的烂梗",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=t=>C.value=t),style:{width:"100%","word-wrap":"break-word","word-break":"break-all"}},null,8,["options","modelValue"])):N("",!0)])):N("",!0)]),n("div",xe,[o(E,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=t=>k.value=t),size:"large"},{default:c(()=>[a[12]||(a[12]=f(" 已同意 ")),o(T,{type:"primary",onClick:a[4]||(a[4]=t=>_.value=!0)},{default:c(()=>a[11]||(a[11]=[f("《社区规范》")])),_:1}),a[13]||(a[13]=f(" ，不发布违反规范内容 "))]),_:1},8,["modelValue"]),o($,{type:"primary",onClick:V,disabled:k.value===!1},{default:c(()=>a[14]||(a[14]=[f("发布")])),_:1},8,["disabled"])])]),_:1})]),o(e,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=t=>_.value=t),title:"社区规范与隐私政策",width:"800"},{default:c(()=>[n("div",{innerHTML:ye(ge)},null,8,Ve)]),_:1},8,["modelValue"])],64)}}}),Ie=j(Me,[["__scopeId","data-v-86d80eb7"]]),Ee={class:"main-post"},$e={class:"post-card-header"},Pe=["src"],Le={class:"post-user-name"},Be={class:"post-meta"},Fe={class:"post-createTime"},Ae={style:{color:"black"}},De=["onClick"],Te={class:"post-content"},Ue={key:0,class:"post-statements"},He=["src"],Re={class:"post-footer"},ze={class:"post-footer-meta"},Ge={style:{display:"flex"}},Je=["onClick"],Qe=["src"],je={style:{cursor:"pointer"}},Oe=["onClick"],qe=["onClick"],Ke=["onClick"],Xe={key:0},J=5,We=O({__name:"post-bar-main",setup(X){const k=l(new Map),_=l(new Map),y=l([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),v=l([]),p=l(new Map);l({});const C=l(1),w=l(!0),x=l(!1),B=async e=>{const t=await h.get(`/machine/Post/Comment/getComment/${e}`);k.value.set(e,t.data)},F=async e=>{_.value.get(e)||await B(e),_.value.set(e,!_.value.get(e))},V=async()=>{if(!(x.value||!w.value)){x.value=!0,console.log("Loading more posts...");try{const e=await h.get("/machine/Post/list",{params:{pageNum:C.value,pageSize:J}});e.data.list.length<J&&(w.value=!1),v.value.push(...e.data.list),C.value++}catch{}finally{x.value=!1}}},m=e=>new Date(e).toLocaleString(),a=["https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab62.jpg","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab65.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab64.png","https://pic1.imgdb.cn/item/6807007258cb8da5c8bdbbbc.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce4.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce7.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce3.png","https://pic1.imgdb.cn/item/680700aa58cb8da5c8bdbce1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd7.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd6.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd5.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd3.png","https://pic1.imgdb.cn/item/680700f858cb8da5c8bdbe94.png","https://pic1.imgdb.cn/item/6807011a58cb8da5c8bdbf61.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf64.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf62.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf63.png"],M=e=>{const t=Math.floor(Math.random()*20);return a[t]},A=async e=>{if(p.value.has(e))return p.value.get(e);const b=(await h.get(`/machine/getBarrageInfo/${e}`)).data;return p.value.set(e,b),b};function I(e){e.likeFlag||h.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const E=(e,t)=>{const u={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return!!u&&e[u]>0},$=(e,t)=>{const u={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return u?e[u]:0},D=e=>e?y.value.filter(t=>E(e,t.statementNum)):[];function T(e,t,b){const u=v.value.find(H=>H.id===b);if(!u||!u.postStatement)return;const P={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];P&&h.post("/machine/Post/Statement",{portId:e,postId:b,statementNum:t}).then(()=>{u.postStatement[P]++,S.success("表态成功")})}function U(e){e&&(ke(e.barrage),be(e.id.toString()).then(()=>{S.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return ve(()=>{V()}),(e,t)=>{const b=oe,u=re,z=K("ArrowDownBold"),P=Q,H=le;return he((r(),d("div",Ee,[o(Ie),(r(!0),d(L,null,R(v.value,s=>(r(),d("div",{key:s.id,class:"card post-card-main"},[n("div",null,[n("div",$e,[n("img",{class:"user-img",src:M(s.userName),alt:""},null,8,Pe),n("span",Le,g(s.userName),1)]),n("div",Be,[n("span",Fe,g(m(s.createTime)),1),o(u,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:i=>A(s.barrageId)},{reference:c(()=>[s.barrage?(r(),q(b,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:c(()=>[n("span",Ae,"#烂梗："+g(s.barrage),1)]),_:2},1024)):N("",!0)]),default:c(()=>{var i;return[n("div",{style:{cursor:"pointer"},onClick:W=>U(p.value.get(s.barrageId))},g((i=p.value.get(s.barrageId))==null?void 0:i.barrage),9,De)]}),_:2},1032,["onBeforeEnter"])])]),n("span",Te,g(s.content),1),s.postStatement?(r(),d("div",Ue,[(r(!0),d(L,null,R(D(s.postStatement),i=>(r(),d("span",{key:i.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[o(b,{round:""},{default:c(()=>[n("img",{src:i.url},null,8,He),n("span",null,g($(s.postStatement,i.statementNum)),1)]),_:2},1024)]))),128))])):N("",!0),n("div",Re,[n("div",ze,[o(u,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:c(()=>[n("div",Ge,[(r(!0),d(L,null,R(y.value,i=>(r(),d("div",{key:i.statementNum,style:{"margin-right":"10px"}},[n("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:W=>T(s.id,i.statementNum,s.id)},[n("img",{style:{width:"30px",cursor:"pointer"},src:i.url},null,8,Qe),n("span",je,g(i.name),1)],8,Je)]))),128))])]),reference:c(()=>t[1]||(t[1]=[n("span",null,[n("img",{src:ie}),f(" 表态")],-1)])),_:2},1024),n("span",{style:{cursor:"pointer"},onClick:i=>F(s.id)},[t[2]||(t[2]=n("img",{src:ce},null,-1)),n("span",null," "+g(s.commentCount),1)],8,Oe),s.likeFlag?(r(),d("span",{key:0,style:{cursor:"not-allowed"},onClick:i=>I(s)},[t[3]||(t[3]=n("img",{src:de},null,-1)),n("span",null," "+g(s.postLike),1)],8,qe)):(r(),d("span",{key:1,style:{cursor:"pointer"},onClick:i=>I(s)},[t[4]||(t[4]=n("img",{src:me},null,-1)),f(" "+g(s.postLike),1)],8,Ke))]),_.value.get(s.id)?(r(),d("div",Xe,[o(ue,{comments:k.value.get(s.id)||[],"post-id":s.id},null,8,["comments","post-id"])])):N("",!0)])]))),128)),n("div",{class:"card post-card-main",style:{"text-align":"center",cursor:"pointer",color:"orangered"},onClick:t[0]||(t[0]=s=>V())},[t[5]||(t[5]=f("加载更多")),o(P,null,{default:c(()=>[o(z)]),_:1})])])),[[H,V]])}}}),vt=j(We,[["__scopeId","data-v-c0216444"]]);export{vt as default};
