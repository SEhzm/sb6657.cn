import{n as z,o as F,p as $,b as q,l as D,a as T,e as I,k as C,c as L,d as j,r as A,q as O,v as W}from"./element-plus.C3kSHAgf.js";import{d as S,az as Z,Z as H,o as h,M as x,O as a,a as _,U as t,S as c,k as J,r as v,w as G,c as K,P as X,T as P,a2 as Y,R as ee}from"./@vue.kwc71ESp.js";import{u as te,b as oe}from"./vue-router.DkBAQHKx.js";import{M as ae,_ as le}from"./index.DQCVHqXJ.js";import{e as ne,f as se,h as re,c as ie,a as ue,p as ce,t as me,l as pe,b as de}from"./flip-num.D5Td1vT3.js";import"./lodash-es.CiJSjksT.js";import"./@vueuse.Bmvu7DnR.js";import"./@element-plus.CQ2moJ0T.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.CdCgAjqw.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const _e={class:"dialog-footer"},fe=S({__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(U){const i=Z(U,"modelValue"),k={category:[{required:!0,message:"请选择分栏",trigger:"blur"}],content:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},l=H({category:"",content:""});async function m(){return l.content===""?(C.error("烂梗内容不能为空"),!1):l.category===""?(C.error("分类不能为空"),!1):await ne(l.category,l.content)?(C.success("投稿成功，审核完成后展示(一天内)"),!0):(C.error("投稿失败，必要时请及时反馈bug"),!1)}async function b(){await m()&&(i.value=!1,l.content="",l.category="")}async function y(){await m()&&(l.content="")}return(p,o)=>{const s=z,M=F,w=$,V=q,f=D,g=T,n=I;return h(),x(n,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=e=>i.value=e),draggable:"",title:"投稿弹幕",width:"82%"},{footer:a(()=>[_("div",_e,[t(g,{onClick:o[2]||(o[2]=e=>i.value=!1)},{default:a(()=>o[4]||(o[4]=[c("关闭")])),_:1}),t(g,{type:"primary",onClick:b},{default:a(()=>o[5]||(o[5]=[c("投稿并关闭")])),_:1}),t(g,{type:"primary",onClick:y},{default:a(()=>o[6]||(o[6]=[c("连续投稿")])),_:1})])]),default:a(()=>[t(f,{model:l,"label-width":"100px",rules:k,"label-position":"right"},{default:a(()=>[t(w,{label:"分栏","label-width":100,prop:"category"},{default:a(()=>[t(M,{modelValue:l.category,"onUpdate:modelValue":o[0]||(o[0]=e=>l.category=e),placeholder:"选择上传的分栏"},{default:a(()=>[t(s,{label:"喷玩机器篇",value:"machine_penWJQ"}),t(s,{label:"木柜子篇",value:"machine_mygo"}),t(s,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),t(s,{label:"喷选手篇",value:"machine_penPlayer"}),t(s,{label:"+1",value:"machine_p1"}),t(s,{label:"群魔乱舞篇",value:"machine_QMLW"}),t(s,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"弹幕内容",prop:"content"},{default:a(()=>[t(V,{maxlength:"255",modelValue:l.content,"onUpdate:modelValue":o[1]||(o[1]=e=>l.content=e),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ge={class:"memes-view"},ve={class:"card-table"},be={class:"top"},ye={class:"index"},we={class:"pagination-wrapper"},E=50,Ve=S({__name:"memes-view",setup(U){const i=te(),k=oe(),l=J(()=>ae.find(n=>n.path===i.path)),m=v(!0),b=v([]),y=v(0),p=v(1);async function o(n){var d;const e=(d=l.value)==null?void 0:d.category;if(!e){k.push("/404");return}const r=await re(e,n,E);r&&(b.value=r.memeArr,y.value=r.total,m.value=!1)}o(1),G(()=>i.path,()=>{console.log("当前页面path:",i.path),p.value=1,m.value=!0,o(1)});const s=()=>{window.scrollTo({top:0,behavior:"smooth"})},M=n=>{p.value=n,s(),o(n)},w=me(de,pe,2e3);async function V(n){const e=n.content,r=w(e);if(!(!r||r==="limitedSuccess")){if(ie(),await ue(n.category,n.id,p.value,E)){await o(p.value);return}ce()}}const f=v(!1),g=()=>{f.value=!0};return(n,e)=>{const r=T,d=L,B=j,N=A,Q=O,R=W;return h(),K("div",ge,[_("div",ve,[_("div",be,[e[2]||(e[2]=_("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿！→→",-1)),t(r,{type:"primary",onClick:g},{default:a(()=>e[1]||(e[1]=[c("烂梗投稿")])),_:1})]),X((h(),x(B,{class:"main-table",data:b.value,stripe:"","cell-class-name":"hover-pointer",onRowClick:V},{default:a(()=>[t(d,{align:"center",width:"60"},{default:a(u=>[_("span",ye,P(u.row.id),1)]),_:1}),t(d,{prop:"content"},{default:a(u=>[c(P(u.row.content),1)]),_:1}),t(d,{align:"center",width:"100"},{default:a(u=>[t(r,{type:"primary",class:"copy-btn",onClick:Y(Ce=>V(u.row),["stop"])},{default:a(()=>[e[3]||(e[3]=c("复制 (")),t(se,{num:u.row.copyCount},null,8,["num"]),e[4]||(e[4]=c(")"))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,m.value]]),_("div",we,[m.value?ee("",!0):(h(),x(N,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":p.value,total:y.value,"pager-count":4,"page-size":E,onCurrentChange:M},null,8,["current-page","total"]))])]),t(fe,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=u=>f.value=u)},null,8,["modelValue"]),t(Q,{right:50,bottom:50},{default:a(()=>e[5]||(e[5]=[c("UP")])),_:1})])}}}),qe=le(Ve,[["__scopeId","data-v-ed13ec29"]]);export{qe as default};
