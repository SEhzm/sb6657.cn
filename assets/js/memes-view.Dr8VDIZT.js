import{h as p,bK as ie,al as n,I as P,o as g,J as l,a,R as o,O as m,c as w,P as T,d as re,i as O,j as G,ar as ue,L as B,K as de,u as N,Q as me,a6 as ce,W as pe}from"./@vue.BltuATdo.js";import{u as ve,b as ge}from"./vue-router.BFvkXMb7.js";import{_ as q,h as Q,A as H,M as fe}from"./index.DiKPCibB.js";import{u as X,g as _e,e as be,d as ye}from"./time.DaZvP_yg.js";import{f as he,t as we}from"./flip-num.BTxhKlbj.js";import{c as Te,a as J,p as Ve,l as ke,b as xe}from"./setMeme.NV-E0x-S.js";import{t as Y}from"./tag-selector.DqAR65c-.js";import{b as x}from"./element-plus.BELI2msV.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./@element-plus.D0bpsst8.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.BO4JNAXw.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const Ce={class:"footer-container"},Me={class:"match-section"},Se={key:0,class:"match-details-box"},$e={class:"match-info-row"},Ee=["src","alt"],ze={class:"match-name"},De={class:"match-time"},Fe={key:1,class:"no-match-info"},Ue={class:"button-group"},Ie={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(W){const C=X(),v=p(""),D=p([]),M=p([]);C.tagsLoaded.then(()=>{D.value=C.memeTags});const i=p(null);function h(){Q.get("/machine/InProgressMatch").then(c=>{c.code===200&&c.data?i.value=c.data:i.value=null})}h();const S=()=>{const c=M.value.map(t=>t.dictValue);if(c.length===0||!v.value)x.error("请选择标签或输入弹幕");else{if(c.length>5){x.error("最少一个标签，最多五个标签。");return}const t={tags:c.join(","),barrage:v.value};b.value&&i.value&&(t.matchId=i.value.id),Q.post(H.SUBMIT_MEME,t).then(u=>{v.value="",b.value=!1,u.code===200?x.success("投稿成功，待审核(一天内)"):u.code===500?x.error("烂梗已经有了，勿重复提交"):x.error("请求失败")}).catch(u=>{console.error("投稿失败",u),x.error("请求失败")})}},_=ie(W,"modelValue"),b=p(!1);return(c,t)=>{const u=n("Warning"),V=n("el-icon"),F=n("el-popover"),y=n("QuestionFilled"),$=n("el-button"),U=n("el-input"),E=n("el-checkbox"),A=n("el-dialog");return g(),P(A,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=f=>_.value=f),draggable:"",title:"投稿烂梗",width:"82%"},{footer:l(()=>[a("div",Ce,[a("div",Me,[o(E,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=f=>b.value=f),disabled:!i.value,class:"match-checkbox"},{default:l(()=>[t[12]||(t[12]=m(" 关联赛事库 ",-1)),o(V,{color:"#3db302ff",size:"16"},{default:l(()=>[o(y)]),_:1})]),_:1},8,["modelValue","disabled"]),i.value?(g(),w("div",Se,[a("div",$e,[a("img",{src:i.value.matchesImg,class:"match-image",alt:i.value.matchesName},null,8,Ee),a("span",ze,T(i.value.matchesName),1)]),a("div",De,T(i.value.startTime)+" 至 "+T(i.value.endTime),1)])):(g(),w("div",Fe," 当前无正在进行的大型赛事 "))]),a("div",Ue,[o($,{plain:"",onClick:t[3]||(t[3]=f=>_.value=!1)},{default:l(()=>[...t[13]||(t[13]=[m("关闭",-1)])]),_:1}),o($,{type:"primary",onClick:S},{default:l(()=>[...t[14]||(t[14]=[m("投稿",-1)])]),_:1})])])]),default:l(()=>[a("h4",null,[t[11]||(t[11]=m("可选标签",-1)),o(F,{width:300},{reference:l(()=>[o(V,{size:"16"},{default:l(()=>[o(u)]),_:1})]),default:l(()=>[t[5]||(t[5]=m(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[6]||(t[6]=a("br",null,null,-1)),t[7]||(t[7]=a("b",null,"点击标签即可添加",-1))]),_:1}),o($,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[t[10]||(t[10]=m("投稿标签 ",-1)),o(F,{width:300},{reference:l(()=>[o(V,{size:"16"},{default:l(()=>[o(y)]),_:1})]),default:l(()=>[t[8]||(t[8]=a("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[9]||(t[9]=a("br",null,null,-1))]),_:1})]),_:1})]),o(Y,{selectedTags:M.value,"onUpdate:selectedTags":t[0]||(t[0]=f=>M.value=f),tags:D.value},null,8,["selectedTags","tags"]),o(U,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=f=>v.value=f),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Be=q(Ie,[["__scopeId","data-v-88060d73"]]),Ne={class:"memes-view"},Pe={class:"card-table"},Ae={key:0,class:"card"},Le={class:"top"},Re=["onTouchstart","onTouchend"],je={class:"barrage-text"},Qe={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},We={class:"tag-icon-wrapper"},Ke=["src"],Oe={style:{"vertical-align":"middle"}},Ge={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},Je={class:"pagination-wrapper"},j=50,qe=re({__name:"memes-view",setup(W){const C=X(),v=ve(),D=ge(),M=O(()=>(_.value=[],fe.find(s=>s.path===v.path))),i=p(!0),h=p([]),S=p([]);C.tagsLoaded.then(()=>{S.value=C.memeTags});const _=p([]),b=O(()=>_.value.map(s=>s.dictValue).join(","));G(()=>b.value,()=>{y(1)});const c=p(!1);async function t(s){try{const e=await Q.get(H.GET_SORTED_ALL_MEME,{params:{pageNum:s,pageSize:j,tags:b.value}});c.value=!0,h.value=e.data.list.map(d=>({total:d.total,content:d.barrage,id:d.id,copyCount:+d.cnt,tags:d.tags}))}catch(e){console.error("排序失败:",e),h.value=[]}}G(()=>v.path,()=>{console.log("当前页面path:",v.path),c.value=!1,u.value=1,i.value=!0,y(1)});const u=p(1),V=p(0);function F(s){u.value=s,ee(),c.value==!1?y(s):t(s)}async function y(s){var z;const e=(z=M.value)==null?void 0:z.category;if(!e){D.push("/404");return}const d=await ye(e,s,j,b.value||void 0);if(!d){h.value=[];return}h.value=d.memeArr,V.value=d.total,i.value=!1}y(1);const $=we(xe,ke,2e3);async function U(s){const e=s.content,d=$(e);if(!(!d||d==="limitedSuccess")){if(Te(),c.value==!0){if(await J("allbarrage",s.id,u.value)){await t(u.value);return}}else if(await J(s.category||"allbarrage",s.id,u.value)){await y(u.value);return}Ve()}}const E=p(!1);function A(){E.value=!0}function f(s){s.touchStartTime=Date.now()}function Z(s){Date.now()-s.touchStartTime>100&&(s.popoverVisible=!0,setTimeout(()=>{s.popoverVisible=!1},1500))}const ee=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(s,e)=>{const d=n("Warning"),z=n("el-icon"),L=n("el-popover"),te=n("QuestionFilled"),I=n("el-button"),K=n("el-tag"),R=n("el-table-column"),oe=n("el-table"),le=n("el-pagination"),ae=n("el-backtop"),se=ue("loading");return g(),w("div",Ne,[a("div",Pe,[N(v).path==="/memes/AllBarrage"?(g(),w("div",Ae,[a("h4",null,[e[10]||(e[10]=m(" 按标签查看烂梗 ",-1)),o(L,{width:300},{reference:l(()=>[o(z,{size:"16"},{default:l(()=>[o(d)]),_:1})]),default:l(()=>[e[3]||(e[3]=m(" 为解决烂梗分栏不足和分类不清晰问题。 ",-1)),e[4]||(e[4]=a("br",null,null,-1)),e[5]||(e[5]=a("b",null,"点击标签即可添加",-1))]),_:1}),o(I,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[e[9]||(e[9]=m(" 投稿标签 ",-1)),o(L,{width:300},{reference:l(()=>[o(z,{size:"16"},{default:l(()=>[o(te)]),_:1})]),default:l(()=>[e[6]||(e[6]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[7]||(e[7]=a("br",null,null,-1)),e[8]||(e[8]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),o(Y,{selectedTags:_.value,"onUpdate:selectedTags":e[0]||(e[0]=r=>_.value=r),tags:S.value},null,8,["selectedTags","tags"])])):B("",!0),a("div",Le,[e[13]||(e[13]=a("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),o(I,{type:"primary",onClick:A},{default:l(()=>[...e[11]||(e[11]=[m("烂梗投稿",-1)])]),_:1}),N(v).path==="/memes/AllBarrage"?(g(),P(I,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[1]||(e[1]=r=>t(1))},{default:l(()=>[...e[12]||(e[12]=[m("按复制次数排序",-1)])]),_:1})):B("",!0)]),de((g(),P(oe,{class:"main-table",data:h.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:U},{default:l(()=>[o(R,{align:"center",width:"60"},{default:l(r=>[o(K,{round:"",effect:"plain"},{default:l(()=>[m(T(r.row.id),1)]),_:2},1024)]),_:1}),o(R,{prop:"content"},{default:l(r=>[o(L,{placement:"top",width:"auto",trigger:"hover",visible:r.row.popoverVisible},{reference:l(()=>[a("div",{style:{cursor:"pointer"},onTouchstart:k=>f(r.row),onTouchend:k=>Z(r.row)},[a("span",je,T(r.row.content),1)],40,Re)]),default:l(()=>[a("div",Qe,[(g(!0),w(me,null,ce(N(_e)(r.row.tags,S.value),(k,ne)=>(g(),w("div",{key:ne,style:{"margin-right":"8px"}},[o(K,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:l(()=>[a("div",We,[k.iconUrl?(g(),w("img",{key:0,src:k.iconUrl,style:{height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Ke)):B("",!0),a("span",Oe,T(k.label),1)])]),_:2},1024)]))),128)),a("span",Ge,"投稿时间: "+T(N(be)(r.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),o(R,{align:"center",width:"100"},{default:l(r=>[o(I,{type:"primary",class:"copy-btn",onClick:pe(k=>U(r.row),["stop"])},{default:l(()=>[e[14]||(e[14]=m(" 复制 🌈 ",-1)),o(he,{num:r.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,i.value]]),a("div",Je,[i.value?B("",!0):(g(),P(le,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":u.value,total:V.value,"pager-count":5,"page-size":j,onCurrentChange:F},null,8,["current-page","total"]))])]),o(Be,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=r=>E.value=r)},null,8,["modelValue"]),o(ae,{right:50,bottom:50},{default:l(()=>[...e[15]||(e[15]=[m("UP",-1)])]),_:1})])}}}),_t=q(qe,[["__scopeId","data-v-8e40b436"]]);export{_t as default};
