import{d as ae,n as ne,c as se,h as ie,k as _e,o as fe,e as ge,b as M,v as be,g as he,y as ye,f as we,N as ke}from"./element-plus.pEMcb2g5.js";import{r as p,bK as Ce,ag as X,H as C,o as r,I as o,a,Q as n,M as c,c as v,P as j,a6 as R,K as z,O as h,d as xe,k as Te,w as Ve,J as $e,u as te,V as Ee}from"./@vue.Ca5AQEsS.js";import{u as Ue,b as Me}from"./vue-router.DhOS9MZH.js";import{_ as re,h as Q,A as ue,M as ze}from"./index.BLiWtL3W.js";import{b as le}from"./getMeme.CoAYBqlf.js";import{f as De,t as Se}from"./flip-num.crhvVBfe.js";import{c as Ie,l as Le,a as Pe}from"./clipboard.CdBbZ3lO.js";import{c as oe,p as Fe}from"./setMeme.DW4XQJ_p.js";/* empty css                                                                 */import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@element-plus.w7YOadmw.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";const Be={class:"preset-tags-container"},Ae={class:"preset-tags"},Ne=["src"],je={style:{"vertical-align":"middle"}},Re={class:"added-tags"},Qe={class:"footer-container"},We={class:"match-section"},Ke={key:0,class:"match-details-box"},Oe={class:"match-info-row"},Ge=["src","alt"],He={class:"match-name"},Je={class:"match-time"},qe={key:1,class:"no-match-info"},Xe={class:"button-group"},Ye={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(ee){const f=p(""),x=p([]),T=p([]),g=p([]);function D(){Q.get("/machine/dictList").then(s=>{s.code===200&&(x.value=s.data.map(t=>({iconUrl:t.iconUrl,label:t.dictLabel,value:t.dictValue})))})}D();const m=p(null);function w(){Q.get("/machine/InProgressMatch").then(s=>{s.code===200&&s.data?m.value=s.data:m.value=null,console.log(m)})}w();const V=s=>{T.value=T.value.filter(t=>t.value!==s.value),g.value=g.value.filter(t=>t!==s.value),x.value.push(s)},S=s=>{if(g.value.length>=5){M.info("最多5个标签");return}T.value.some(t=>t.value===s.value)||(T.value.push(s),g.value.push(s.value),x.value=x.value.filter(t=>t.value!==s.value))},$=()=>{if(g.value.length===0||f.value===""||f.value===null)M.error("请选择标签或输入弹幕");else{if(g.value.length>5){M.error("最少一个标签，最多五个标签。");return}const s={tags:g.value.join(","),barrage:f.value};_.value&&m.value&&(s.matchId=m.value.id),Q.post(ue.SUBMIT_MEME,s).then(t=>{f.value="",_.value=!1,t.code===200?M.success("投稿成功，待审核(一天内)"):t.code===500?M.error("烂梗已经有了，勿重复提交"):M.error("请求失败")}).catch(t=>{console.error("投稿失败",t),M.error("请求失败")})}},k=Ce(ee,"modelValue"),_=p(!1);return(s,t)=>{const W=X("Warning"),I=ne,L=ae,P=X("QuestionFilled"),E=se,K=ie,O=_e,Y=fe,G=ge;return r(),C(G,{modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=u=>k.value=u),draggable:"",title:"投稿烂梗",width:"82%"},{footer:o(()=>[a("div",Qe,[a("div",We,[n(Y,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=u=>_.value=u),disabled:!m.value,class:"match-checkbox"},{default:o(()=>[t[13]||(t[13]=c(" 关联赛事库 ")),n(I,{color:"#3db302ff",size:"16"},{default:o(()=>[n(P)]),_:1})]),_:1,__:[13]},8,["modelValue","disabled"]),m.value?(r(),v("div",Ke,[a("div",Oe,[a("img",{src:m.value.matchesImg,class:"match-image",alt:m.value.matchesName},null,8,Ge),a("span",He,h(m.value.matchesName),1)]),a("div",Je,h(m.value.startTime)+" 至 "+h(m.value.endTime),1)])):(r(),v("div",qe," 当前无正在进行的大型赛事 "))]),a("div",Xe,[n(E,{type:"plain",onClick:t[2]||(t[2]=u=>k.value=!1)},{default:o(()=>t[14]||(t[14]=[c("关闭")])),_:1,__:[14]}),n(E,{type:"primary",onClick:$},{default:o(()=>t[15]||(t[15]=[c("投稿")])),_:1,__:[15]})])])]),default:o(()=>[a("h4",null,[t[10]||(t[10]=c("可选标签")),n(L,{width:300},{reference:o(()=>[n(I,{size:"16"},{default:o(()=>[n(W)]),_:1})]),default:o(()=>[t[4]||(t[4]=c(" 为解决烂梗分栏不足和分类不清晰问题。")),t[5]||(t[5]=a("br",null,null,-1)),t[6]||(t[6]=a("b",null,"点击标签即可添加",-1))]),_:1,__:[4,5,6]}),n(E,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[t[9]||(t[9]=c("投稿标签 ")),n(L,{width:300},{reference:o(()=>[n(I,{size:"16"},{default:o(()=>[n(P)]),_:1})]),default:o(()=>[t[7]||(t[7]=a("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[8]||(t[8]=a("br",null,null,-1))]),_:1,__:[7,8]})]),_:1,__:[9]})]),a("div",Be,[a("div",Ae,[(r(!0),v(j,null,R(x.value,(u,F)=>(r(),C(K,{round:"",key:F,closable:"",onClose:B=>S(u),onClick:B=>S(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[u.iconUrl?(r(),v("img",{key:0,src:u.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Ne)):z("",!0),a("span",je,h(u.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[t[12]||(t[12]=c("已选标签 ")),n(L,{width:300},{reference:o(()=>[n(I,{size:"16"},{default:o(()=>[n(W)]),_:1})]),default:o(()=>[t[11]||(t[11]=a("b",null,"最少一个标签，最多五个标签。",-1))]),_:1,__:[11]})]),a("div",Re,[(r(!0),v(j,null,R(T.value,(u,F)=>(r(),C(K,{round:"",key:F,closable:"",onClick:B=>V(u),onClose:B=>V(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[c(h(u.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),n(O,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=u=>f.value=u),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Ze=re(Ye,[["__scopeId","data-v-c9f0bfe7"]]),et={class:"memes-view"},tt={class:"card-table"},lt={key:0,class:"card"},ot={class:"preset-tags-container"},at={class:"preset-tags"},nt=["src"],st={style:{"vertical-align":"middle"}},it={class:"added-tags"},rt=["src"],ut={style:{"vertical-align":"middle"}},dt={class:"top"},ct=["onTouchstart","onTouchend"],pt={class:"barrage-text"},mt={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},vt=["src"],_t={style:{"vertical-align":"middle"}},ft={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},gt={class:"pagination-wrapper"},q=50,bt=xe({__name:"memes-view",setup(ee){const f=Ue(),x=Me(),T=Te(()=>(_.value=[],ze.find(l=>l.path===f.path))),g=p(!0),D=p([]),m=p(0),w=p(1),V=p(!1),S=p([]),$=p([]),k=p([]),_=p([]);async function s(l){var U;const e=(U=T.value)==null?void 0:U.category;if(!e){x.push("/404");return}let d;_.value.length==0?d=await le(e,l,q):d=await le(e,l,q,_.value.join(",")),D.value=d.memeArr,m.value=d.total,g.value=!1}s(1);async function t(l){O(),Q.get(ue.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:q,tags:`${_.value}`}}).then(e=>{V.value=!0,D.value=e.data.list.map(d=>({total:d.total,content:d.barrage,id:d.id,copyCount:+d.cnt,tags:d.tags}))}).catch(e=>{D.value=[]})}Ve(()=>f.path,()=>{console.log("当前页面path:",f.path),V.value=!1,w.value=1,g.value=!0,s(1)});const W=()=>{window.scrollTo({top:0,behavior:"smooth"})},I=l=>{w.value=l,W(),V.value==!1?s(l):t(l)},L=Se(Pe,Le,2e3);async function P(l){const e=l.content,d=L(e);if(!(!d||d==="limitedSuccess")){if(Ie(),V.value==!0){if(await oe("allbarrage",l.id,w.value)){await t(w.value);return}}else if(await oe(l.category,l.id,w.value)){await s(w.value);return}Fe()}}const E=p(!1),K=()=>{E.value=!0},O=()=>{Q.get("/machine/dictList").then(l=>{l.code===200&&(S.value=l.data,$.value=l.data.map(e=>({iconUrl:e.iconUrl,label:e.dictLabel,value:e.dictValue})))}).catch(l=>{console.error("获取字典数据失败",l)})},Y=l=>{if(!l||l.trim()==="")return[];const e=Array.from(new Set(l.split(",").map(b=>b.trim())));if(!S.value)return e.map(()=>({label:"",iconUrl:""}));const d=new Map(S.value.map(b=>[String(b.dictValue).trim(),b]));return e.map(b=>{const A=d.get(b);return A?{label:A.dictLabel,iconUrl:A.iconUrl}:{label:"",iconUrl:""}})};O();const G=l=>{k.value=k.value.filter(e=>e.value!==l.value),_.value=_.value.filter(e=>e!==l.value),$.value.push(l),s(1)},u=l=>{k.value.some(e=>e.value===l.value)||(k.value.push(l),_.value.push(l.value),$.value=$.value.filter(e=>e.value!==l.value)),console.log(_.value),s(1)},F=l=>{l.touchStartTime=Date.now()},B=l=>{Date.now()-l.touchStartTime>100&&(l.popoverVisible=!0,setTimeout(()=>{l.popoverVisible=!1},1500))},de=l=>l?l.replace("T"," ").split(".")[0]:"";return(l,e)=>{const d=X("Warning"),U=ne,b=ae,A=X("QuestionFilled"),H=se,J=ie,Z=he,ce=we,pe=ke,me=ye,ve=be;return r(),v("div",et,[a("div",tt,[te(f).path==="/memes/AllBarrage"?(r(),v("div",lt,[a("h4",null,[e[9]||(e[9]=c("按标签查看烂梗")),n(b,{width:300},{reference:o(()=>[n(U,{size:"16"},{default:o(()=>[n(d)]),_:1})]),default:o(()=>[e[2]||(e[2]=c(" 为解决烂梗分栏不足和分类不清晰问题。")),e[3]||(e[3]=a("br",null,null,-1)),e[4]||(e[4]=a("b",null,"点击标签即可添加",-1))]),_:1,__:[2,3,4]}),n(H,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[e[8]||(e[8]=c("投稿标签 ")),n(b,{width:300},{reference:o(()=>[n(U,{size:"16"},{default:o(()=>[n(A)]),_:1})]),default:o(()=>[e[5]||(e[5]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=a("br",null,null,-1)),e[7]||(e[7]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1,__:[5,6,7]})]),_:1,__:[8]})]),a("div",ot,[a("div",at,[(r(!0),v(j,null,R($.value,(i,y)=>(r(),C(J,{round:"",key:y,closable:"",onClose:N=>u(i),onClick:N=>u(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[i.iconUrl?(r(),v("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,nt)):z("",!0),a("span",st,h(i.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[e[11]||(e[11]=c("包含标签 ")),n(b,null,{reference:o(()=>[n(U,{size:"16"},{default:o(()=>[n(d)]),_:1})]),default:o(()=>[e[10]||(e[10]=a("b",null,"烂梗包含该标签",-1))]),_:1,__:[10]})]),a("div",it,[(r(!0),v(j,null,R(k.value,(i,y)=>(r(),C(J,{round:"",key:y,closable:"",onClick:N=>G(i),onClose:N=>G(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[i.iconUrl?(r(),v("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,rt)):z("",!0),a("span",ut,h(i.label),1)]),_:2},1032,["onClick","onClose"]))),128))])])):z("",!0),a("div",dt,[e[14]||(e[14]=a("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),n(H,{type:"primary",onClick:K},{default:o(()=>e[12]||(e[12]=[c("烂梗投稿")])),_:1,__:[12]}),te(f).path==="/memes/AllBarrage"?(r(),C(H,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=i=>t(1))},{default:o(()=>e[13]||(e[13]=[c("按复制次数排序")])),_:1,__:[13]})):z("",!0)]),$e((r(),C(ce,{class:"main-table",data:D.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:P},{default:o(()=>[n(Z,{align:"center",width:"60"},{default:o(i=>[n(J,{round:"",effect:"plain"},{default:o(()=>[c(h(i.row.id),1)]),_:2},1024)]),_:1}),n(Z,{prop:"content"},{default:o(i=>[n(b,{placement:"top",width:"auto",trigger:"hover",visible:i.row.popoverVisible},{reference:o(()=>[a("div",{style:{cursor:"pointer"},onTouchstart:y=>F(i.row),onTouchend:y=>B(i.row)},[a("span",pt,h(i.row.content),1)],40,ct)]),default:o(()=>[a("div",mt,[(r(!0),v(j,null,R(Y(i.row.tags),(y,N)=>(r(),v("div",{key:N,style:{"margin-right":"8px"}},[n(J,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:o(()=>[y.iconUrl?(r(),v("img",{key:0,src:y.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,vt)):z("",!0),a("span",_t,h(y.label),1)]),_:2},1024)]))),128)),a("span",ft,"投稿时间: "+h(de(i.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),n(Z,{align:"center",width:"100"},{default:o(i=>[n(H,{type:"primary",class:"copy-btn",onClick:Ee(y=>P(i.row),["stop"])},{default:o(()=>[e[15]||(e[15]=c("复制 🌈")),n(De,{num:i.row.copyCount},null,8,["num"])]),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,g.value]]),a("div",gt,[g.value?z("",!0):(r(),C(pe,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":w.value,total:m.value,"pager-count":4,"page-size":q,onCurrentChange:I},null,8,["current-page","total"]))])]),n(Ze,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=i=>E.value=i)},null,8,["modelValue"]),n(me,{right:50,bottom:50},{default:o(()=>e[16]||(e[16]=[c("UP")])),_:1,__:[16]})])}}}),jt=re(bt,[["__scopeId","data-v-98976b03"]]);export{jt as default};
