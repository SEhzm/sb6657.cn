import{h as c,bK as de,al as r,I,o as m,J as l,a as s,R as o,O as u,c as w,P as x,d as me,f as ce,i as O,j as G,ar as pe,L as M,K as fe,u as $,Q as ve,a6 as ge,W as _e}from"./@vue.BltuATdo.js";import{u as H,g as be,e as he,d as ye}from"./time.DLSnzd4S.js";import{_ as X,h as L,A as Y,M as we}from"./index.D2zKoqcl.js";import{c as Te,a as J,p as ke,l as xe,b as Ve}from"./setMeme.CWHEP7VL.js";import{f as Ce,t as Se}from"./flip-num.Cn5YxVxm.js";import{t as Z}from"./tag-selector.LoJfJ9Rt.js";import{b as W}from"./element-plus.Devhffg8.js";import{u as Me}from"./shieldWordStore.B3Vt6f0L.js";import{R as q}from"./@element-plus.GoM0nurT.js";import{u as $e,b as We}from"./vue-router.BFvkXMb7.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.BO4JNAXw.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const ze={class:"footer-container"},Ee={class:"match-section"},Fe={key:0,class:"match-details-box"},De={class:"match-info-row"},Ie=["src","alt"],Ue={class:"match-name"},Be={class:"match-time"},Ne={key:1,class:"no-match-info"},Pe={class:"button-group"},Re={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(j){const z=H(),f=c(""),y=c([]),E=c([]);z.tagsLoaded.then(()=>{y.value=z.memeTags});const d=c(null);function V(){L.get("/machine/InProgressMatch").then(p=>{p.code===200&&p.data?d.value=p.data:d.value=null})}V();const T=()=>{const p=E.value.map(t=>t.dictValue);if(p.length===0||!f.value)W.error("请选择标签或输入弹幕");else{if(p.length>5){W.error("最少一个标签，最多五个标签。");return}const t={tags:p.join(","),barrage:f.value};b.value&&d.value&&(t.matchId=d.value.id),L.post(Y.SUBMIT_MEME,t).then(g=>{f.value="",b.value=!1,g.code===200?W.success("投稿成功，待审核(一天内)"):g.code===500?W.error("烂梗已经有了，勿重复提交"):W.error("请求失败")}).catch(g=>{console.error("投稿失败",g),W.error("请求失败")})}},k=de(j,"modelValue"),b=c(!1);return(p,t)=>{const g=r("Warning"),v=r("el-icon"),F=r("el-popover"),U=r("QuestionFilled"),h=r("el-button"),P=r("el-input"),B=r("el-checkbox"),D=r("el-dialog");return m(),I(D,{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=_=>k.value=_),draggable:"",title:"投稿烂梗",width:"82%"},{footer:l(()=>[s("div",ze,[s("div",Ee,[o(B,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=_=>b.value=_),disabled:!d.value,class:"match-checkbox"},{default:l(()=>[t[12]||(t[12]=u(" 关联赛事库 ",-1)),o(v,{color:"#3db302ff",size:"16"},{default:l(()=>[o(U)]),_:1})]),_:1},8,["modelValue","disabled"]),d.value?(m(),w("div",Fe,[s("div",De,[s("img",{src:d.value.matchesImg,class:"match-image",alt:d.value.matchesName},null,8,Ie),s("span",Ue,x(d.value.matchesName),1)]),s("div",Be,x(d.value.startTime)+" 至 "+x(d.value.endTime),1)])):(m(),w("div",Ne," 当前无正在进行的大型赛事 "))]),s("div",Pe,[o(h,{plain:"",onClick:t[3]||(t[3]=_=>k.value=!1)},{default:l(()=>[...t[13]||(t[13]=[u("关闭",-1)])]),_:1}),o(h,{type:"primary",onClick:T},{default:l(()=>[...t[14]||(t[14]=[u("投稿",-1)])]),_:1})])])]),default:l(()=>[s("h4",null,[t[11]||(t[11]=u("可选标签",-1)),o(F,{width:300},{reference:l(()=>[o(v,{size:"16"},{default:l(()=>[o(g)]),_:1})]),default:l(()=>[t[5]||(t[5]=u(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[6]||(t[6]=s("br",null,null,-1)),t[7]||(t[7]=s("b",null,"点击标签即可添加",-1))]),_:1}),o(h,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[t[10]||(t[10]=u("投稿标签 ",-1)),o(F,{width:300},{reference:l(()=>[o(v,{size:"16"},{default:l(()=>[o(U)]),_:1})]),default:l(()=>[t[8]||(t[8]=s("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[9]||(t[9]=s("br",null,null,-1))]),_:1})]),_:1})]),o(Z,{selectedTags:E.value,"onUpdate:selectedTags":t[0]||(t[0]=_=>E.value=_),tags:y.value},null,8,["selectedTags","tags"]),o(P,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=_=>f.value=_),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Ae=X(Re,[["__scopeId","data-v-88060d73"]]),Le={class:"memes-view"},je={class:"card-table"},Qe={key:0,class:"card"},Ke={class:"top"},Oe=["onTouchstart","onTouchend"],Ge={class:"barrage-text"},Je={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},qe={class:"tag-icon-wrapper"},He=["src"],Xe={style:{"vertical-align":"middle"}},Ye={key:0,style:{"font-size":"14px",color:"#e6a23c","margin-left":"4px"}},Ze={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},et={class:"pagination-wrapper"},A=50,tt=me({__name:"memes-view",setup(j){const z=H(),f=Me();ce(async()=>{try{f.shieldWords.length===0&&await f.setShieldWords()}catch(a){console.error("加载屏蔽词失败:",a)}});const y=$e(),E=We(),d=O(()=>(b.value=[],we.find(a=>a.path===y.path))),V=c(!0),T=c([]),k=c([]);z.tagsLoaded.then(()=>{k.value=z.memeTags});const b=c([]),p=O(()=>b.value.map(a=>a.dictValue).join(","));G(()=>p.value,()=>{h(1)});const t=c(!1);async function g(a){try{const e=await L.get(Y.GET_SORTED_ALL_MEME,{params:{pageNum:a,pageSize:A,tags:p.value}});t.value=!0,T.value=e.data.list.map(i=>({total:i.total,content:i.barrage,id:i.id,copyCount:+i.cnt,tags:i.tags}))}catch(e){console.error("排序失败:",e),T.value=[]}}G(()=>y.path,()=>{console.log("当前页面path:",y.path),t.value=!1,v.value=1,V.value=!0,h(1)});const v=c(1),F=c(0);function U(a){v.value=a,oe(),t.value==!1?h(a):g(a)}async function h(a){var C;const e=(C=d.value)==null?void 0:C.category;if(!e){E.push("/404");return}const i=await ye(e,a,A,p.value||void 0);if(!i){T.value=[];return}T.value=i.memeArr,F.value=i.total,V.value=!1}h(1);const P=Se(Ve,xe,2e3);async function B(a){const e=a.content,i=P(e);if(!(!i||i==="limitedSuccess")){if(Te(),t.value==!0){if(await J("allbarrage",a.id,v.value)){await g(v.value);return}}else if(await J(a.category||"allbarrage",a.id,v.value)){await h(v.value);return}ke()}}const D=c(!1);function _(){D.value=!0}function ee(a){a.touchStartTime=Date.now()}function te(a){Date.now()-a.touchStartTime>100&&(a.popoverVisible=!0,setTimeout(()=>{a.popoverVisible=!1},1500))}function Q(a){return!a||!f.shieldWords||f.shieldWords.length===0?!1:f.hasShieldWord(a)}const oe=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(a,e)=>{const i=r("el-icon"),C=r("el-popover"),le=r("QuestionFilled"),N=r("el-button"),K=r("el-tag"),R=r("el-table-column"),ae=r("WarningFilled"),se=r("el-table"),ne=r("el-pagination"),re=r("el-backtop"),ie=pe("loading");return m(),w("div",Le,[s("div",je,[$(y).path==="/memes/AllBarrage"?(m(),w("div",Qe,[s("h4",null,[e[10]||(e[10]=u(" 按标签查看烂梗 ",-1)),o(C,{width:300},{reference:l(()=>[o(i,{size:"16"},{default:l(()=>[o($(q))]),_:1})]),default:l(()=>[e[3]||(e[3]=u(" 为解决烂梗分栏不足和分类不清晰问题。 ",-1)),e[4]||(e[4]=s("br",null,null,-1)),e[5]||(e[5]=s("b",null,"点击标签即可添加",-1))]),_:1}),o(N,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[e[9]||(e[9]=u(" 投稿标签 ",-1)),o(C,{width:300},{reference:l(()=>[o(i,{size:"16"},{default:l(()=>[o(le)]),_:1})]),default:l(()=>[e[6]||(e[6]=s("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[7]||(e[7]=s("br",null,null,-1)),e[8]||(e[8]=s("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),o(Z,{selectedTags:b.value,"onUpdate:selectedTags":e[0]||(e[0]=n=>b.value=n),tags:k.value},null,8,["selectedTags","tags"])])):M("",!0),s("div",Ke,[e[13]||(e[13]=s("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),o(N,{type:"primary",onClick:_},{default:l(()=>[...e[11]||(e[11]=[u("烂梗投稿",-1)])]),_:1}),$(y).path==="/memes/AllBarrage"?(m(),I(N,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[1]||(e[1]=n=>g(1))},{default:l(()=>[...e[12]||(e[12]=[u("按复制次数排序",-1)])]),_:1})):M("",!0)]),fe((m(),I(se,{class:"main-table",data:T.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:B},{default:l(()=>[o(R,{align:"center",width:"60"},{default:l(n=>[o(K,{round:"",effect:"plain"},{default:l(()=>[u(x(n.row.id),1)]),_:2},1024)]),_:1}),o(R,{prop:"content"},{default:l(n=>[o(C,{placement:"top",width:"auto",trigger:"hover",visible:n.row.popoverVisible},{reference:l(()=>[s("div",{style:{cursor:"pointer"},onTouchstart:S=>ee(n.row),onTouchend:S=>te(n.row)},[Q(n.row.content)?(m(),I(i,{key:0,style:{color:"#e6a23c","flex-shrink":"0"},size:"large"},{default:l(()=>[o(ae)]),_:1})):M("",!0),s("span",Ge,x(n.row.content),1)],40,Oe)]),default:l(()=>[s("div",Je,[(m(!0),w(ve,null,ge($(be)(n.row.tags,k.value),(S,ue)=>(m(),w("div",{key:ue,style:{"margin-right":"8px"}},[o(K,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:l(()=>[s("div",qe,[S.iconUrl?(m(),w("img",{key:0,src:S.iconUrl,style:{height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,He)):M("",!0),s("span",Xe,x(S.label),1)])]),_:2},1024)]))),128)),Q(n.row.content)?(m(),w("span",Ye,[o(i,{style:{"margin-right":"2px","vertical-align":"middle"}},{default:l(()=>[o($(q))]),_:1}),e[14]||(e[14]=u(" 包含屏蔽词 ",-1))])):M("",!0),s("span",Ze,"投稿时间: "+x($(he)(n.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),o(R,{align:"center",width:"100"},{default:l(n=>[o(N,{type:"primary",class:"copy-btn",onClick:_e(S=>B(n.row),["stop"])},{default:l(()=>[e[15]||(e[15]=u(" 复制 🌈 ",-1)),o(Ce,{num:n.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,V.value]]),s("div",et,[V.value?M("",!0):(m(),I(ne,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":v.value,total:F.value,"pager-count":5,"page-size":A,onCurrentChange:U},null,8,["current-page","total"]))])]),o(Ae,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value=n)},null,8,["modelValue"]),o(re,{right:50,bottom:50},{default:l(()=>[...e[16]||(e[16]=[u("UP",-1)])]),_:1})])}}}),xt=X(tt,[["__scopeId","data-v-9fe8e4b9"]]);export{xt as default};
