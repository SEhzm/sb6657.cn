import{k as m,n as R,o as A,p as I,b as N,l as q,a as M,e as L,c as $,d as j,r as D,q as O,v as W}from"./element-plus.C3kSHAgf.js";import{u as Z,b as H}from"./vue-router.DkBAQHKx.js";import{h as U,M as J,_ as G}from"./index.DsKgPaFS.js";import{e as K,c as X,a as Y,p as ee,t as te,l as oe,b as ae}from"./setMeme.CwV0zanJ.js";import{d as P,az as le,Z as ne,o as E,M as T,O as l,a as f,U as e,S as d,k as re,r as g,w as se,c as ie,P as ue,F as ce}from"./@vue.kwc71ESp.js";import"./lodash-es.CiJSjksT.js";import"./@vueuse.Bmvu7DnR.js";import"./@element-plus.CQ2moJ0T.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.CdCgAjqw.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const pe={class:"dialog-footer"},me=P({__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(k){const i=le(k,"modelValue"),y={category:[{required:!0,message:"请选择分栏",trigger:"blur"}],content:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},o=ne({category:"",content:""}),_=()=>{o.category===""||o.content===""?m.error("请选择分栏或输入弹幕"):U.post("/machine/addUnaudit",{table:o.category,barrage:o.content}).then(u=>{i.value=!1,o.content="",o.category="",u.code==="200"?m.success("投稿成功，待审核(一天内)"):m.error("请求失败")})},v=()=>{o.category===""||o.content===""?m.error("请选择分栏或输入弹幕"):U.post("/machine/addUnaudit",{table:o.category,barrage:o.content}).then(u=>{o.content="",u.code==="200"?m.success("投稿成功，待审核(一天内)"):m.error("投稿失败，必要时请及时反馈")})};return(u,t)=>{const r=R,h=A,b=I,w=N,V=q,c=M,C=L;return E(),T(C,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=a=>i.value=a),draggable:"",title:"投稿弹幕",width:"82%"},{footer:l(()=>[f("div",pe,[e(c,{onClick:t[2]||(t[2]=a=>i.value=!1)},{default:l(()=>t[4]||(t[4]=[d("关闭")])),_:1}),e(c,{type:"primary",onClick:_},{default:l(()=>t[5]||(t[5]=[d("投稿并关闭")])),_:1}),e(c,{type:"primary",onClick:v},{default:l(()=>t[6]||(t[6]=[d("连续投稿")])),_:1})])]),default:l(()=>[e(V,{model:o,"label-width":"100px",rules:y,"label-position":"right"},{default:l(()=>[e(b,{label:"分栏","label-width":100,prop:"category"},{default:l(()=>[e(h,{modelValue:o.category,"onUpdate:modelValue":t[0]||(t[0]=a=>o.category=a),placeholder:"选择上传的分栏"},{default:l(()=>[e(r,{label:"喷玩机器篇",value:"machine_penWJQ"}),e(r,{label:"木柜子篇",value:"machine_mygo"}),e(r,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),e(r,{label:"喷选手篇",value:"machine_penPlayer"}),e(r,{label:"+1",value:"machine_p1"}),e(r,{label:"群魔乱舞篇",value:"machine_QMLW"}),e(r,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"弹幕内容",prop:"content"},{default:l(()=>[e(w,{maxlength:"255",modelValue:o.content,"onUpdate:modelValue":t[1]||(t[1]=a=>o.content=a),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),de={class:"cardTable",style:{position:"relative"}},_e={class:"pagination-wrapper"},x=50,ge=P({__name:"memes-view",setup(k){const i=Z(),y=H(),o=re(()=>J.find(a=>a.path===i.path)),_=g(!0),v=g([]),u=g(0),t=g(1);async function r(a){var p;const n=(p=o.value)==null?void 0:p.category;if(!n){y.push("/404");return}const s=await K(n,a,x);s&&(v.value=s.memeArr,u.value=s.total,_.value=!1)}r(1),se(()=>i.path,()=>{console.log("当前页面path:",i.path),t.value=1,_.value=!0,r(1)});const h=()=>{window.scrollTo({top:0,behavior:"smooth"})},b=a=>{t.value=a,h(),r(a)},w=te(ae,oe,2e3);async function V(a){const n=a.content,s=w(n);if(!(!s||s==="limitedSuccess")){if(X(),await Y(a.category,a.id,t.value,x)){await r(t.value);return}ee()}}const c=g(!1),C=()=>{c.value=!0};return(a,n)=>{const s=M,p=$,B=j,S=D,F=O,Q=W;return E(),ie(ce,null,[f("div",null,[f("div",de,[e(s,{type:"primary",class:"handleAdd",onClick:C},{default:l(()=>n[1]||(n[1]=[d("烂梗投稿")])),_:1}),ue((E(),T(B,{stripe:"",data:v.value,"empty-text":"我还没有加载完喔~~",class:"eldtable","header-cell-style":{color:"#ff0000",fontSize:"13px",whitespace:"normal !important"},"cell-style":{cursor:"Pointer"},onRowClick:V},{default:l(()=>[e(p,{width:"58",prop:"id",label:"序号"}),e(p,{prop:"content","min-width":"90",label:"弹幕"}),e(p,{label:"",align:"center",width:"85"},{default:l(()=>[e(s,{type:"primary",label:"操作"},{default:l(()=>n[2]||(n[2]=[d("复制")])),_:1})]),_:1}),e(p,{prop:"copyCount",label:"复制次数",width:"55"})]),_:1},8,["data"])),[[Q,_.value]])]),f("div",_e,[f("div",null,[e(S,{background:"red",layout:"prev, pager, next, jumper","current-page":t.value,total:u.value,"pager-count":4,"page-size":x,onCurrentChange:b},null,8,["current-page","total"])])])]),e(me,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=z=>c.value=z)},null,8,["modelValue"]),e(F,{right:50,bottom:50},{default:l(()=>n[3]||(n[3]=[d("UP")])),_:1})],64)}}}),Se=G(ge,[["__scopeId","data-v-2d269702"]]);export{Se as default};
