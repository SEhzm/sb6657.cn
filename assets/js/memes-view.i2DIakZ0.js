import{m as L,g as le,d as oe,a as ne,b as ae,h as ce,f as ve,c as me,e as fe,u as ge,o as _e,v as be}from"./element-plus.DVYLd97e.js";import{r as c,ay as ye,ag as O,o as d,G as C,H as l,P as n,L as r,a,c as y,O as I,a4 as A,M as h,d as we,k as Ce,w as ke,u as Z,K as W,I as xe,V as Ve}from"./@vue.BkZGu_Ap.js";import{u as Te,b as Ee}from"./vue-router.CJ_8Ucol.js";import{_ as se,h as H,A as re,M as he}from"./index.D22UXix9.js";import{f as Me,e as ee,c as $e,a as te,p as ze,t as Le,l as De,b as Fe}from"./flip-num.BoPwhSII.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.B3BMR0ps.js";import"./@element-plus.imH8POSc.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DXEKZA6n.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./fireworks-js.1hhxDOOS.js";const Pe={class:"preset-tags-container"},Se={class:"preset-tags"},Ue={class:"added-tags"},Be={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(J){const v=c(""),k=c([]),x=c([]),m=c([]);function M(){H.get("/machine/dictList").then(s=>{s.code==="200"&&(k.value=s.data.map(t=>({label:t.dictLabel,value:t.dictValue})))})}M();const D=s=>{x.value=x.value.filter(t=>t.value!==s.value),m.value=m.value.filter(t=>t!==s.value),k.value.push(s)},_=s=>{if(m.value.length>=5){L.info("最多5个标签");return}x.value.some(t=>t.value===s.value)||(x.value.push(s),m.value.push(s.value),k.value=k.value.filter(t=>t.value!==s.value))},$=()=>{if(m.value.length===0||v.value===""||v.value===null)L.error("请选择标签或输入弹幕");else{if(m.value.length>5){L.error("最少一个标签，最多五个标签。");return}H.post(re.SUBMIT_MEME,{tags:m.value.join(","),barrage:v.value}).then(s=>{v.value="",s.code==="200"?L.success("投稿成功，待审核(一天内)"):L.error("请求失败")}).catch(s=>{console.error("投稿失败",s),L.error("请求失败")})}},V=ye(J,"modelValue");return(s,t)=>{const f=O("Warning"),b=le,T=oe,K=O("QuestionFilled"),F=ne,R=ae,j=ce,P=ve;return d(),C(P,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=p=>V.value=p),draggable:"",title:"投稿烂梗",width:"82%"},{footer:l(()=>[n(F,{type:"plain",onClick:t[1]||(t[1]=p=>V.value=!1)},{default:l(()=>t[13]||(t[13]=[r("关闭")])),_:1}),n(F,{type:"primary",onClick:$},{default:l(()=>t[14]||(t[14]=[r("投稿")])),_:1})]),default:l(()=>[a("h4",null,[t[10]||(t[10]=r("可选标签")),n(T,{width:300},{reference:l(()=>[n(b,{size:"16"},{default:l(()=>[n(f)]),_:1})]),default:l(()=>[t[3]||(t[3]=r(" 为解决烂梗分栏不足和分类不清晰问题。")),t[4]||(t[4]=a("br",null,null,-1)),t[5]||(t[5]=a("b",null,"点击标签即可添加",-1))]),_:1}),n(F,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[t[9]||(t[9]=r("投稿标签 ")),n(T,{width:300},{reference:l(()=>[n(b,{size:"16"},{default:l(()=>[n(K)]),_:1})]),default:l(()=>[t[6]||(t[6]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),t[7]||(t[7]=a("br",null,null,-1)),t[8]||(t[8]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),a("div",Pe,[a("div",Se,[(d(!0),y(I,null,A(k.value,(p,z)=>(d(),C(R,{round:"",key:z,closable:"",onClose:S=>_(p),onClick:S=>_(p),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:l(()=>[r(h(p.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[t[12]||(t[12]=r("已选标签 ")),n(T,{width:300},{reference:l(()=>[n(b,{size:"16"},{default:l(()=>[n(f)]),_:1})]),default:l(()=>[t[11]||(t[11]=a("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),a("div",Ue,[(d(!0),y(I,null,A(x.value,(p,z)=>(d(),C(R,{round:"",key:z,closable:"",onClick:S=>D(p),onClose:S=>D(p),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:l(()=>[r(h(p.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),n(j,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=p=>v.value=p),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Ie=se(Be,[["__scopeId","data-v-5438370f"]]),Ae={class:"memes-view"},Re={class:"card-table"},je={key:0,class:"card"},Ne={class:"preset-tags-container"},Qe={class:"preset-tags"},We={class:"added-tags"},Ge={class:"top"},Oe={style:{cursor:"pointer"}},He={class:"barrage-text"},Ke={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},qe=["src"],Je={class:"pagination-wrapper"},G=50,Xe=we({__name:"memes-view",setup(J){const v=Te(),k=Ee(),x=Ce(()=>(f.value=[],he.find(o=>o.path===v.path))),m=c(!0),M=c([]),D=c(0),_=c(1),$=c(!1),V=c([]),s=c([]),t=c([]),f=c([]);async function b(o){var E;const e=(E=x.value)==null?void 0:E.category;if(!e){k.push("/404");return}let u;console.log(f.value.join(",")),f.value.length==0?u=await ee(e,o,G):u=await ee(e,o,G,f.value.join(",")),M.value=u.memeArr,D.value=u.total,m.value=!1}b(1);async function T(o){z(),H.get(re.GET_SORTED_ALL_MEME,{params:{pageNum:o,pageSize:G,tags:`${f.value}`}}).then(e=>{$.value=!0,M.value=e.data.list.map(u=>({total:u.total,content:u.barrage,id:u.id,copyCount:+u.cnt,tags:u.tags}))}).catch(e=>{M.value=[]})}ke(()=>v.path,()=>{console.log("当前页面path:",v.path),$.value=!1,_.value=1,m.value=!0,b(1)});const K=()=>{window.scrollTo({top:0,behavior:"smooth"})},F=o=>{_.value=o,K(),$.value==!1?b(o):T(o)},R=Le(Fe,De,2e3);async function j(o){const e=o.content,u=R(e);if(!(!u||u==="limitedSuccess")){if($e(),$.value==!0){if(await te("allbarrage",o.id,_.value)){await T(_.value);return}}else if(await te(o.category,o.id,_.value)){await b(_.value);return}ze()}}const P=c(!1),p=()=>{P.value=!0},z=()=>{H.get("/machine/dictList").then(o=>{o.code==="200"&&(V.value=o.data,s.value=o.data.map(e=>({label:e.dictLabel,value:e.dictValue})))}).catch(o=>{console.error("获取字典数据失败",o)})},S=o=>{if(!o||o.trim()==="")return[];const e=Array.from(new Set(o.split(",").map(g=>g.trim())));if(!V.value)return e.map(()=>({label:"",iconUrl:""}));const u=new Map(V.value.map(g=>[String(g.dictValue).trim(),g]));return e.map(g=>{const U=u.get(g);return U?{label:U.dictLabel,iconUrl:U.iconUrl}:{label:"",iconUrl:""}})};z();const X=o=>{t.value=t.value.filter(e=>e.value!==o.value),f.value=f.value.filter(e=>e!==o.value),s.value.push(o),b(1)},Y=o=>{t.value.some(e=>e.value===o.value)||(t.value.push(o),f.value.push(o.value),s.value=s.value.filter(e=>e.value!==o.value)),console.log(f.value),b(1)};return(o,e)=>{const u=O("Warning"),E=le,g=oe,U=O("QuestionFilled"),N=ne,Q=ae,q=me,ue=fe,ie=ge,de=_e,pe=be;return d(),y("div",Ae,[a("div",Re,[Z(v).path==="/memes/AllBarrage"?(d(),y("div",je,[a("h4",null,[e[9]||(e[9]=r("按标签查看烂梗")),n(g,{width:300},{reference:l(()=>[n(E,{size:"16"},{default:l(()=>[n(u)]),_:1})]),default:l(()=>[e[2]||(e[2]=r(" 为解决烂梗分栏不足和分类不清晰问题。")),e[3]||(e[3]=a("br",null,null,-1)),e[4]||(e[4]=a("b",null,"点击标签即可添加",-1))]),_:1}),n(N,{link:"",type:"success",style:{"margin-left":"50%"}},{default:l(()=>[e[8]||(e[8]=r("投稿标签 ")),n(g,{width:300},{reference:l(()=>[n(E,{size:"16"},{default:l(()=>[n(U)]),_:1})]),default:l(()=>[e[5]||(e[5]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=a("br",null,null,-1)),e[7]||(e[7]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),a("div",Ne,[a("div",Qe,[(d(!0),y(I,null,A(s.value,(i,w)=>(d(),C(Q,{round:"",key:w,closable:"",onClose:B=>Y(i),onClick:B=>Y(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:l(()=>[r(h(i.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[e[11]||(e[11]=r("包含标签 ")),n(g,null,{reference:l(()=>[n(E,{size:"16"},{default:l(()=>[n(u)]),_:1})]),default:l(()=>[e[10]||(e[10]=a("b",null,"烂梗包含该标签",-1))]),_:1})]),a("div",We,[(d(!0),y(I,null,A(t.value,(i,w)=>(d(),C(Q,{round:"",key:w,closable:"",onClick:B=>X(i),onClose:B=>X(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:l(()=>[r(h(i.label),1)]),_:2},1032,["onClick","onClose"]))),128))])])):W("",!0),a("div",Ge,[e[14]||(e[14]=a("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),n(N,{type:"primary",onClick:p},{default:l(()=>e[12]||(e[12]=[r("烂梗投稿")])),_:1}),Z(v).path==="/memes/AllBarrage"?(d(),C(N,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=i=>T(1))},{default:l(()=>e[13]||(e[13]=[r("按复制次数排序")])),_:1})):W("",!0)]),xe((d(),C(ue,{class:"main-table",data:M.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:j},{default:l(()=>[n(q,{align:"center",width:"60"},{default:l(i=>[n(Q,{round:"",effect:"plain"},{default:l(()=>[r(h(i.row.id),1)]),_:2},1024)]),_:1}),n(q,{prop:"content"},{default:l(i=>[n(g,{placement:"top",width:"auto",trigger:"hover"},{reference:l(()=>[a("div",Oe,[a("span",He,h(i.row.content),1)])]),default:l(()=>[a("div",Ke,[(d(!0),y(I,null,A(S(i.row.tags),(w,B)=>(d(),y("div",{key:B,style:{"margin-right":"8px"}},[n(Q,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:l(()=>[w.iconUrl?(d(),y("img",{key:0,src:w.iconUrl,style:{width:"16px",height:"16px","object-fit":"cover","vertical-align":"middle"}},null,8,qe)):W("",!0),r(" "+h(w.label),1)]),_:2},1024)]))),128))])]),_:2},1024)]),_:1}),n(q,{align:"center",width:"100"},{default:l(i=>[n(N,{type:"primary",class:"copy-btn",onClick:Ve(w=>j(i.row),["stop"])},{default:l(()=>[e[15]||(e[15]=r("复制 🎈")),n(Me,{num:i.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,m.value]]),a("div",Je,[m.value?W("",!0):(d(),C(ie,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":_.value,total:D.value,"pager-count":4,"page-size":G,onCurrentChange:F},null,8,["current-page","total"]))])]),n(Ie,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=i=>P.value=i)},null,8,["modelValue"]),n(de,{right:50,bottom:50},{default:l(()=>e[16]||(e[16]=[r("UP")])),_:1})])}}}),ft=se(Xe,[["__scopeId","data-v-9f7412db"]]);export{ft as default};
