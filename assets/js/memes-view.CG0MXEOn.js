import{m as M,g as se,d as re,a as ie,b as ue,h as ye,f as we,c as ke,e as Ce,u as he,o as Te,v as xe}from"./element-plus.DVYLd97e.js";import{r as c,ay as Ve,ag as O,o as d,G as k,H as o,P as n,L as u,a,c as w,O as B,a4 as I,M as $,d as Ee,k as Me,w as $e,u as ee,K as W,I as Le,V as te}from"./@vue.BkZGu_Ap.js";import{u as Se,b as ze}from"./vue-router.CJ_8Ucol.js";import{_ as de,h as H,A as pe,M as Pe}from"./index.C_NblXT8.js";import{b as le}from"./getMeme.b9PLEm_g.js";import{f as De,c as Fe,a as oe,p as Ue,t as ne,b as Be,d as Ie,e as Ae,g as ae,h as Ne}from"./flip-num.SzPvNpjy.js";import{L as Re}from"./like-num.CR_9Vh4Z.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.B3BMR0ps.js";import"./@element-plus.imH8POSc.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DXEKZA6n.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const je={class:"preset-tags-container"},Qe={class:"preset-tags"},We={class:"added-tags"},Ge={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(J){const v=c(""),C=c([]),h=c([]),m=c([]);function L(){H.get("/machine/dictList").then(r=>{r.code==="200"&&(C.value=r.data.map(t=>({label:t.dictLabel,value:t.dictValue})))})}L();const z=r=>{h.value=h.value.filter(t=>t.value!==r.value),m.value=m.value.filter(t=>t!==r.value),C.value.push(r)},g=r=>{if(m.value.length>=5){M.info("最多5个标签");return}h.value.some(t=>t.value===r.value)||(h.value.push(r),m.value.push(r.value),C.value=C.value.filter(t=>t.value!==r.value))},S=()=>{if(m.value.length===0||v.value===""||v.value===null)M.error("请选择标签或输入弹幕");else{if(m.value.length>5){M.error("最少一个标签，最多五个标签。");return}H.post(pe.SUBMIT_MEME,{tags:m.value.join(","),barrage:v.value}).then(r=>{v.value="",r.code==="200"?M.success("投稿成功，待审核(一天内)"):r.code==="500"?M.error("烂梗已经有了，勿重复提交"):M.error("请求失败")}).catch(r=>{console.error("投稿失败",r),M.error("请求失败")})}},T=Ve(J,"modelValue");return(r,t)=>{const f=O("Warning"),_=se,x=re,K=O("QuestionFilled"),P=ie,A=ue,q=ye,N=we;return d(),k(N,{modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=p=>T.value=p),draggable:"",title:"投稿烂梗",width:"82%"},{footer:o(()=>[n(P,{type:"plain",onClick:t[1]||(t[1]=p=>T.value=!1)},{default:o(()=>t[13]||(t[13]=[u("关闭")])),_:1}),n(P,{type:"primary",onClick:S},{default:o(()=>t[14]||(t[14]=[u("投稿")])),_:1})]),default:o(()=>[a("h4",null,[t[10]||(t[10]=u("可选标签")),n(x,{width:300},{reference:o(()=>[n(_,{size:"16"},{default:o(()=>[n(f)]),_:1})]),default:o(()=>[t[3]||(t[3]=u(" 为解决烂梗分栏不足和分类不清晰问题。")),t[4]||(t[4]=a("br",null,null,-1)),t[5]||(t[5]=a("b",null,"点击标签即可添加",-1))]),_:1}),n(P,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[t[9]||(t[9]=u("投稿标签 ")),n(x,{width:300},{reference:o(()=>[n(_,{size:"16"},{default:o(()=>[n(K)]),_:1})]),default:o(()=>[t[6]||(t[6]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),t[7]||(t[7]=a("br",null,null,-1)),t[8]||(t[8]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),a("div",je,[a("div",Qe,[(d(!0),w(B,null,I(C.value,(p,V)=>(d(),k(A,{round:"",key:V,closable:"",onClose:D=>g(p),onClick:D=>g(p),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[u($(p.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[t[12]||(t[12]=u("已选标签 ")),n(x,{width:300},{reference:o(()=>[n(_,{size:"16"},{default:o(()=>[n(f)]),_:1})]),default:o(()=>[t[11]||(t[11]=a("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),a("div",We,[(d(!0),w(B,null,I(h.value,(p,V)=>(d(),k(A,{round:"",key:V,closable:"",onClick:D=>z(p),onClose:D=>z(p),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[u($(p.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),n(q,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=p=>v.value=p),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Oe=de(Ge,[["__scopeId","data-v-9a6ee391"]]),He={class:"memes-view"},Ke={class:"card-table"},qe={key:0,class:"card"},Je={class:"preset-tags-container"},Xe={class:"preset-tags"},Ye={class:"added-tags"},Ze={class:"top"},et=["onTouchstart","onTouchend"],tt={class:"barrage-text"},lt={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},ot=["src"],nt={class:"pagination-wrapper"},G=50,at=Ee({__name:"memes-view",setup(J){const v=Se(),C=ze(),h=Me(()=>(f.value=[],Pe.find(l=>l.path===v.path))),m=c(!0),L=c([]),z=c(0),g=c(1),S=c(!1),T=c([]),r=c([]),t=c([]),f=c([]);async function _(l){var E;const e=(E=h.value)==null?void 0:E.category;if(!e){C.push("/404");return}let i;console.log(f.value.join(",")),f.value.length==0?i=await le(e,l,G):i=await le(e,l,G,f.value.join(",")),L.value=i.memeArr,z.value=i.total,m.value=!1}_(1);async function x(l){X(),H.get(pe.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:G,tags:`${f.value}`}}).then(e=>{S.value=!0,L.value=e.data.list.map(i=>({total:i.total,content:i.barrage,id:i.id,copyCount:+i.cnt,tags:i.tags}))}).catch(e=>{L.value=[]})}$e(()=>v.path,()=>{console.log("当前页面path:",v.path),S.value=!1,g.value=1,m.value=!0,_(1)});const K=()=>{window.scrollTo({top:0,behavior:"smooth"})},P=l=>{g.value=l,K(),S.value==!1?_(l):x(l)},A=ne(ae,Ae,2e3),q=ne(ae,Ne,2e3);async function N(l){const e=l.content,i=A(e);if(!(!i||i==="limitedSuccess")){if(Fe(),S.value==!0){if(await oe("allbarrage",l.id,g.value)){await x(g.value);return}}else if(await oe(l.category,l.id,g.value)){await _(g.value);return}Ue()}}async function p(l){const e=l.content,i=q(e);if(!(!i||i==="limitedSuccess")){if(await Be(l.id)){await _(g.value);return}Ie()}}const V=c(!1),D=()=>{V.value=!0},X=()=>{H.get("/machine/dictList").then(l=>{l.code==="200"&&(T.value=l.data,r.value=l.data.map(e=>({label:e.dictLabel,value:e.dictValue})))}).catch(l=>{console.error("获取字典数据失败",l)})},ce=l=>{if(!l||l.trim()==="")return[];const e=Array.from(new Set(l.split(",").map(b=>b.trim())));if(!T.value)return e.map(()=>({label:"",iconUrl:""}));const i=new Map(T.value.map(b=>[String(b.dictValue).trim(),b]));return e.map(b=>{const F=i.get(b);return F?{label:F.dictLabel,iconUrl:F.iconUrl}:{label:"",iconUrl:""}})};X();const Y=l=>{t.value=t.value.filter(e=>e.value!==l.value),f.value=f.value.filter(e=>e!==l.value),r.value.push(l),_(1)},Z=l=>{t.value.some(e=>e.value===l.value)||(t.value.push(l),f.value.push(l.value),r.value=r.value.filter(e=>e.value!==l.value)),console.log(f.value),_(1)},ve=l=>{l.touchStartTime=Date.now()},me=l=>{Date.now()-l.touchStartTime>200&&(l.popoverVisible=!0,setTimeout(()=>{l.popoverVisible=!1},1500))};return(l,e)=>{const i=O("Warning"),E=se,b=re,F=O("QuestionFilled"),R=ie,j=ue,Q=ke,fe=Ce,ge=he,_e=Te,be=xe;return d(),w("div",He,[a("div",Ke,[ee(v).path==="/memes/AllBarrage"?(d(),w("div",qe,[a("h4",null,[e[9]||(e[9]=u("按标签查看烂梗")),n(b,{width:300},{reference:o(()=>[n(E,{size:"16"},{default:o(()=>[n(i)]),_:1})]),default:o(()=>[e[2]||(e[2]=u(" 为解决烂梗分栏不足和分类不清晰问题。")),e[3]||(e[3]=a("br",null,null,-1)),e[4]||(e[4]=a("b",null,"点击标签即可添加",-1))]),_:1}),n(R,{link:"",type:"success",style:{"margin-left":"50%"}},{default:o(()=>[e[8]||(e[8]=u("投稿标签 ")),n(b,{width:300},{reference:o(()=>[n(E,{size:"16"},{default:o(()=>[n(F)]),_:1})]),default:o(()=>[e[5]||(e[5]=a("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=a("br",null,null,-1)),e[7]||(e[7]=a("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),a("div",Je,[a("div",Xe,[(d(!0),w(B,null,I(r.value,(s,y)=>(d(),k(j,{round:"",key:y,closable:"",onClose:U=>Z(s),onClick:U=>Z(s),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:o(()=>[u($(s.label),1)]),_:2},1032,["onClose","onClick"]))),128))])]),a("h4",null,[e[11]||(e[11]=u("包含标签 ")),n(b,null,{reference:o(()=>[n(E,{size:"16"},{default:o(()=>[n(i)]),_:1})]),default:o(()=>[e[10]||(e[10]=a("b",null,"烂梗包含该标签",-1))]),_:1})]),a("div",Ye,[(d(!0),w(B,null,I(t.value,(s,y)=>(d(),k(j,{round:"",key:y,closable:"",onClick:U=>Y(s),onClose:U=>Y(s),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:o(()=>[u($(s.label),1)]),_:2},1032,["onClick","onClose"]))),128))])])):W("",!0),a("div",Ze,[e[14]||(e[14]=a("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),n(R,{type:"primary",onClick:D},{default:o(()=>e[12]||(e[12]=[u("烂梗投稿")])),_:1}),ee(v).path==="/memes/AllBarrage"?(d(),k(R,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=s=>x(1))},{default:o(()=>e[13]||(e[13]=[u("按复制次数排序")])),_:1})):W("",!0)]),Le((d(),k(fe,{class:"main-table",data:L.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:N},{default:o(()=>[n(Q,{align:"center",width:"60"},{default:o(s=>[n(j,{round:"",effect:"plain"},{default:o(()=>[u($(s.row.id),1)]),_:2},1024)]),_:1}),n(Q,{prop:"content"},{default:o(s=>[n(b,{placement:"top",width:"auto",trigger:"hover",visible:s.row.popoverVisible},{reference:o(()=>[a("div",{style:{cursor:"pointer"},onTouchstart:y=>ve(s.row),onTouchend:y=>me(s.row)},[a("span",tt,$(s.row.content),1)],40,et)]),default:o(()=>[a("div",lt,[(d(!0),w(B,null,I(ce(s.row.tags),(y,U)=>(d(),w("div",{key:U,style:{"margin-right":"8px"}},[n(j,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:o(()=>[y.iconUrl?(d(),w("img",{key:0,src:y.iconUrl,style:{width:"16px",height:"16px","object-fit":"cover","vertical-align":"middle"}},null,8,ot)):W("",!0),u(" "+$(y.label),1)]),_:2},1024)]))),128))])]),_:2},1032,["visible"])]),_:1}),n(Q,{align:"center",width:"40"},{default:o(s=>[n(Re,{likeCount:s.row.likes,onClick:te(y=>p(s.row),["stop"])},null,8,["likeCount","onClick"])]),_:1}),n(Q,{align:"center",width:"100"},{default:o(s=>[n(R,{type:"primary",class:"copy-btn",onClick:te(y=>N(s.row),["stop"])},{default:o(()=>[e[15]||(e[15]=u("复制 🎈")),n(De,{num:s.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[be,m.value]]),a("div",nt,[m.value?W("",!0):(d(),k(ge,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":g.value,total:z.value,"pager-count":4,"page-size":G,onCurrentChange:P},null,8,["current-page","total"]))])]),n(Oe,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s)},null,8,["modelValue"]),n(_e,{right:50,bottom:50},{default:o(()=>e[16]||(e[16]=[u("UP")])),_:1})])}}}),Tt=de(at,[["__scopeId","data-v-01e27350"]]);export{Tt as default};
