import{m as q,a as w,E as B,c as P,j as U,k as A}from"./element-plus.DX6Kv4BD.js";import{b as n,c as V,P as r,H as l,u as t,o as h,a as y,L as M,a5 as b,G as T,K,V as Z}from"./@vue.BqJqC78G.js";import{_ as L}from"./validCode.DOM1axl7.js";import{_ as N,h as x}from"./index.BVYcCDf1.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.C-35htfh.js";import"./@element-plus.Du5FBV_q.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.D6RD0Zoz.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.PTNpl1pN.js";const R={class:"register"},$={class:"register-code"},F=["src"],H={key:0},j={key:1},D={__name:"test",setup(G){const C=n(),a=n({username:"",password:"",confirmPassword:"",code:"",uuid:"",emailCode:""}),k={username:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/,message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,trigger:"blur",message:"请输入您的密码"},{min:6,max:20,message:"用户密码长度必须介于 6 和 20 之间，且数字和英文混合",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,20}$/,message:"密码必须是数字和英文混合",trigger:"blur"}],confirmPassword:[{required:!0,trigger:"blur",message:"请再次输入您的密码"},{required:!0,validator:(o,e,i)=>{a.value.password!==e?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}],code:[{required:!0,trigger:"change",message:"请输入验证码"}],emailCode:[{required:!0,trigger:"change",message:"请输入邮箱验证码"}]},E=n(""),d=n(!1),m=n(!0),p=n("发送邮箱验证码"),g=n(!1);let f=null;function z(){if(!a.value.username){w.info("请先输入邮箱");return}g.value=!0;let o=10;p.value=`${o}分钟 后重试`,f=setInterval(()=>{o--,o<=0?(clearInterval(f),g.value=!1,p.value="发送邮箱验证码"):p.value=`邮箱中已有验证码，或请 ${o}分钟 后重试`},1e3*60*10),console.log(a.value.username),x.get("/login/getMailCode",{params:{toEMail:a.value.username}}).then(e=>{e.code===200?w.success("验证码已发送，请查收邮箱"):(w.error(e.msg),clearInterval(f),g.value=!1,p.value="发送邮箱验证码")}).catch(()=>{clearInterval(f),g.value=!1,p.value="发送邮箱验证码"})}function _(){C.value.validate(o=>{o&&(d.value=!0,x.post("/register",a.value).then(e=>{const i=a.value.username;e.code===200?B.alert("<font color='red'>恭喜你，您的账号 "+i+" 注册成功！</font>","系统提示",{dangerouslyUseHTMLString:!0,type:"success"}).then(()=>{}).catch(()=>{}):(w.error(e.msg),d.value=!1,m&&v())}).catch(()=>{d.value=!1,m&&v()}))})}function v(){x.get("/captchaImage").then(o=>{m.value=o.captchaEnabled===void 0?!0:o.captchaEnabled,m.value&&(E.value="data:image/gif;base64,"+o.img,a.value.uuid=o.uuid)})}return v(),(o,e)=>{const i=P,c=U,u=A,I=q;return h(),V("div",R,[r(I,{ref_key:"registerRef",ref:C,model:t(a),rules:k,class:"register-form"},{default:l(()=>[e[7]||(e[7]=y("h3",{class:"title"},"注册",-1)),r(u,{prop:"username"},{default:l(()=>[r(c,{modelValue:t(a).username,"onUpdate:modelValue":e[0]||(e[0]=s=>t(a).username=s),type:"text",size:"large",clearable:"","prefix-icon":"Avatar","auto-complete":"off",placeholder:"邮箱"},{append:l(()=>[r(i,{type:"primary",size:"small",style:{padding:"0","font-weight":"500"},onClick:z},{default:l(()=>e[5]||(e[5]=[M("发送邮箱验证码")])),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,{prop:"emailCode"},{default:l(()=>[r(c,{modelValue:t(a).emailCode,"onUpdate:modelValue":e[1]||(e[1]=s=>t(a).emailCode=s),type:"text",maxlength:"4",size:"large",clearable:"",placeholder:"请输入邮箱验证码"},null,8,["modelValue"])]),_:1}),r(u,{prop:"password"},{default:l(()=>[r(c,{modelValue:t(a).password,"onUpdate:modelValue":e[2]||(e[2]=s=>t(a).password=s),type:"password",size:"large","show-password":"","prefix-icon":"Lock","auto-complete":"off",placeholder:"密码",onKeyup:b(_,["enter"])},null,8,["modelValue"])]),_:1}),r(u,{prop:"confirmPassword"},{default:l(()=>[r(c,{modelValue:t(a).confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=s=>t(a).confirmPassword=s),type:"password",size:"large","show-password":"","prefix-icon":"Lock","auto-complete":"off",placeholder:"确认密码",onKeyup:b(_,["enter"])},null,8,["modelValue"])]),_:1}),t(m)?(h(),T(u,{key:0,prop:"code"},{default:l(()=>[r(c,{size:"large",modelValue:t(a).code,"onUpdate:modelValue":e[4]||(e[4]=s=>t(a).code=s),"auto-complete":"off",clearable:"",placeholder:"请输入右侧验证码",style:{width:"63%"},onKeyup:b(_,["enter"])},{prefix:l(()=>e[6]||(e[6]=[y("img",{src:L,style:{width:"16px"}},null,-1)])),_:1},8,["modelValue"]),y("div",$,[y("img",{src:t(E),onClick:v,class:"register-code-img"},null,8,F)])]),_:1})):K("",!0),r(u,{style:{width:"100%"}},{default:l(()=>[r(i,{loading:t(d),size:"large",type:"primary",style:{width:"100%"},onClick:Z(_,["prevent"])},{default:l(()=>[t(d)?(h(),V("span",j,"注 册 中...")):(h(),V("span",H,"注 册"))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},me=N(D,[["__scopeId","data-v-f865c902"]]);export{me as default};
