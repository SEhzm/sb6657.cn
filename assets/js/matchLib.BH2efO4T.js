import{K as ae,f as oe,g as se,h as ne,d as le,c as re,v as ie,e as ce,a as b,n as de,A as ue}from"./element-plus.nxJ_dmmw.js";import{d as pe,r as l,i as me,c as m,o as c,a,Q as s,P as I,a6 as $,I as n,J as _e,H as z,M as L,O as r,K as j,V as ge,u as S}from"./@vue.Ca5AQEsS.js";import{S as he,n as A}from"./@element-plus.BuV21Ltw.js";import{h as k,_ as ve}from"./index.C4Q93sfu.js";import{f as fe}from"./flip-num.DVIh8Pcm.js";import{a as be,c as ye}from"./clipboard.CIFstMBw.js";import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.DhOS9MZH.js";const we={class:"match-library"},Ce={class:"match-list"},Te={class:"card-content"},xe={class:"image-container"},ze=["src"],Le={class:"match-info"},Se={class:"match-header"},ke={class:"match-name"},Ee={class:"match-details"},Ve={class:"match-location"},Me={class:"match-time"},Pe={class:"time-item"},Ue={class:"time-item"},Be={class:"pagination-container"},De={class:"memes-view"},Ne={class:"card-table"},Ie=["onTouchstart","onTouchend"],$e={class:"barrage-text"},je={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Ae=["src"],Ke={style:{"vertical-align":"middle"}},Fe={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},He={class:"pagination-wrapper"},Je=pe({__name:"matchLib",setup(Oe){const E=l([]),V=l(0),_=l(1),g=l(10),y=l(!1),h=l(null),M=l([]),v=l(!1),P=l(0),U=l(50),w=l(1),C=l([]),T=async()=>{try{const e=await k.get("/machine/getMatchList",{params:{pageNum:_.value,pageSize:g.value}});e.code===200?(E.value=e.data.list,V.value=e.data.total):b.error(e.msg||"获取赛事列表失败")}catch(e){b.error("获取赛事列表失败"),console.error("获取赛事列表失败:",e)}},K=e=>{g.value=e,T()},F=e=>{_.value=e,T()},H=e=>{h.value=e,y.value=!0,w.value=1,B(1)},B=async e=>{if(h.value){v.value=!0;try{const o=await k.get("/machine/matchPageList",{params:{pageNum:e,pageSize:U.value,matchId:h.value.id}});o.code===200?(M.value=o.data.list,P.value=o.data.total):b.error(o.msg||"获取烂梗列表失败")}catch(o){b.error("获取烂梗列表失败"),console.error("获取烂梗列表失败:",o)}finally{v.value=!1}}},D=async e=>{be(e.barrage)&&ye()},J=e=>{w.value=e,B(e)},O=e=>{if(!e||e.trim()==="")return[];const o=Array.from(new Set(e.split(",").map(i=>i.trim())));if(!C.value)return o.map(()=>({label:"",iconUrl:""}));const p=new Map(C.value.map(i=>[String(i.dictValue).trim(),i]));return o.map(i=>{const u=p.get(i);return u?{label:u.dictLabel,iconUrl:u.iconUrl}:{label:"",iconUrl:""}})},Q=()=>{k.get("/machine/dictList").then(e=>{e.code===200&&(C.value=e.data)}).catch(e=>{console.error("获取字典数据失败",e)})},R=e=>{e.touchStartTime=Date.now()},q=e=>{Date.now()-e.touchStartTime>100&&(e.popoverVisible=!0,setTimeout(()=>{e.popoverVisible=!1},1500))},G=e=>e?e.replace("T"," ").split(".")[0]:"";return me(()=>{Q(),T()}),(e,o)=>{var N;const p=ne,f=de,i=ue,u=ae,x=se,W=le,X=re,Y=oe,Z=ce,ee=ie;return c(),m("div",we,[o[4]||(o[4]=a("div",{class:"card"},[a("span",null,"投稿时勾选关联赛事库将加入某一赛事创作的烂梗，目前只收录大型赛事")],-1)),a("div",Ce,[(c(!0),m(I,null,$(E.value,t=>(c(),z(i,{key:t.id,class:"match-card","body-style":{padding:"0px"},onClick:d=>H(t)},{default:n(()=>[a("div",Te,[a("div",xe,[a("img",{src:t.matchesImg,class:"match-image"},null,8,ze)]),a("div",Le,[a("div",Se,[a("h3",ke,r(t.matchesName),1),s(p,{size:"small",type:"success",class:"match-level"},{default:n(()=>[L(r(t.level),1)]),_:2},1024)]),a("div",Ee,[a("div",Ve,[s(f,null,{default:n(()=>[s(S(he))]),_:1}),a("span",null,r(t.matchesLocation),1)]),a("div",Me,[a("div",Pe,[s(f,null,{default:n(()=>[s(S(A))]),_:1}),a("span",null,"开始："+r(t.startTime),1)]),a("div",Ue,[s(f,null,{default:n(()=>[s(S(A))]),_:1}),a("span",null,"结束："+r(t.endTime),1)])])])])])]),_:2},1032,["onClick"]))),128))]),a("div",Be,[s(u,{"current-page":_.value,"onUpdate:currentPage":o[0]||(o[0]=t=>_.value=t),"page-size":g.value,"onUpdate:pageSize":o[1]||(o[1]=t=>g.value=t),"page-sizes":[10,20,30,50],total:V.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:F},null,8,["current-page","page-size","total"])]),s(Z,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=t=>y.value=t),title:(N=h.value)==null?void 0:N.matchesName,width:"80%",class:"match-dialog","destroy-on-close":""},{default:n(()=>[a("div",De,[a("div",Ne,[_e((c(),z(Y,{data:M.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"暂无烂梗，快来投稿吧！",onRowClick:D},{default:n(()=>[s(x,{align:"center",width:"60"},{default:n(t=>[s(p,{round:"",effect:"plain"},{default:n(()=>[L(r(t.row.id),1)]),_:2},1024)]),_:1}),s(x,{prop:"barrage"},{default:n(t=>[s(W,{placement:"top",width:"auto",trigger:"hover",visible:t.row.popoverVisible},{reference:n(()=>[a("div",{style:{cursor:"pointer"},onTouchstart:d=>R(t.row),onTouchend:d=>q(t.row)},[a("span",$e,r(t.row.barrage),1)],40,Ie)]),default:n(()=>[a("div",je,[(c(!0),m(I,null,$(O(t.row.tags),(d,te)=>(c(),m("div",{key:te,style:{"margin-right":"8px"}},[s(p,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:n(()=>[d.iconUrl?(c(),m("img",{key:0,src:d.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,Ae)):j("",!0),a("span",Ke,r(d.label),1)]),_:2},1024)]))),128)),a("span",Fe," 投稿时间: "+r(G(t.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),s(x,{align:"center",width:"100"},{default:n(t=>[s(X,{type:"primary",class:"copy-btn",onClick:ge(d=>D(t.row),["stop"])},{default:n(()=>[o[3]||(o[3]=L(" 复制 🌈")),s(fe,{num:t.row.cnt},null,8,["num"])]),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,v.value]]),a("div",He,[v.value?j("",!0):(c(),z(u,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":w.value,total:P.value,"pager-count":4,"page-size":U.value,onCurrentChange:J},null,8,["current-page","total","page-size"]))])])])]),_:1},8,["modelValue","title"])])}}}),ut=ve(Je,[["__scopeId","data-v-2f87d0dc"]]);export{ut as default};
