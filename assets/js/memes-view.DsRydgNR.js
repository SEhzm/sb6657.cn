import{n as z,o as A,p as F,b as $,l as q,a as P,e as D,k as V,c as I,d as L,r as j,q as O,v as W}from"./element-plus.C3kSHAgf.js";import{d as S,az as Z,Z as H,o as C,M as T,O as a,a as _,U as e,S as m,k as J,r as v,w as G,c as K,P as X,T as E,a2 as Y,R as ee}from"./@vue.kwc71ESp.js";import{u as te,b as oe}from"./vue-router.DkBAQHKx.js";import{M as ae,_ as le}from"./index.WIwieCo7.js";import{e as ne,f as re,c as se,a as ie,p as ue,t as ce,l as me,b as pe}from"./setMeme.CiFfga5D.js";import"./lodash-es.CiJSjksT.js";import"./@vueuse.Bmvu7DnR.js";import"./@element-plus.CQ2moJ0T.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.CdCgAjqw.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const de={class:"dialog-footer"},_e=S({__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(U){const i=Z(U,"modelValue"),k={category:[{required:!0,message:"请选择分栏",trigger:"blur"}],content:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},l=H({category:"",content:""});async function c(){return l.content===""?(V.error("烂梗内容不能为空"),!1):l.category===""?(V.error("分类不能为空"),!1):await ne(l.category,l.content)?(V.success("投稿成功，审核完成后展示(一天内)"),!0):(V.error("投稿失败，必要时请及时反馈bug"),!1)}async function y(){await c()&&(i.value=!1,l.content="",l.category="")}async function b(){await c()&&(l.content="")}return(p,o)=>{const r=z,M=A,w=F,h=$,f=q,g=P,n=D;return C(),T(n,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value=t),draggable:"",title:"投稿弹幕",width:"82%"},{footer:a(()=>[_("div",de,[e(g,{onClick:o[2]||(o[2]=t=>i.value=!1)},{default:a(()=>o[4]||(o[4]=[m("关闭")])),_:1}),e(g,{type:"primary",onClick:y},{default:a(()=>o[5]||(o[5]=[m("投稿并关闭")])),_:1}),e(g,{type:"primary",onClick:b},{default:a(()=>o[6]||(o[6]=[m("连续投稿")])),_:1})])]),default:a(()=>[e(f,{model:l,"label-width":"100px",rules:k,"label-position":"right"},{default:a(()=>[e(w,{label:"分栏","label-width":100,prop:"category"},{default:a(()=>[e(M,{modelValue:l.category,"onUpdate:modelValue":o[0]||(o[0]=t=>l.category=t),placeholder:"选择上传的分栏"},{default:a(()=>[e(r,{label:"喷玩机器篇",value:"machine_penWJQ"}),e(r,{label:"木柜子篇",value:"machine_mygo"}),e(r,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),e(r,{label:"喷选手篇",value:"machine_penPlayer"}),e(r,{label:"+1",value:"machine_p1"}),e(r,{label:"群魔乱舞篇",value:"machine_QMLW"}),e(r,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"弹幕内容",prop:"content"},{default:a(()=>[e(h,{maxlength:"255",modelValue:l.content,"onUpdate:modelValue":o[1]||(o[1]=t=>l.content=t),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),fe={class:"cardTable"},ge={class:"top"},ve={class:"index"},ye={class:"pagination-wrapper"},x=50,be=S({__name:"memes-view",setup(U){const i=te(),k=oe(),l=J(()=>ae.find(n=>n.path===i.path)),c=v(!0),y=v([]),b=v(0),p=v(1);async function o(n){var d;const t=(d=l.value)==null?void 0:d.category;if(!t){k.push("/404");return}const s=await re(t,n,x);s&&(y.value=s.memeArr,b.value=s.total,c.value=!1)}o(1),G(()=>i.path,()=>{console.log("当前页面path:",i.path),p.value=1,c.value=!0,o(1)});const r=()=>{window.scrollTo({top:0,behavior:"smooth"})},M=n=>{p.value=n,r(),o(n)},w=ce(pe,me,2e3);async function h(n){const t=n.content,s=w(t);if(!(!s||s==="limitedSuccess")){if(se(),await ie(n.category,n.id,p.value,x)){await o(p.value);return}ue()}}const f=v(!1),g=()=>{f.value=!0};return(n,t)=>{const s=P,d=I,B=L,Q=j,R=O,N=W;return C(),K("div",null,[_("div",fe,[_("div",ge,[t[2]||(t[2]=_("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿！→→",-1)),e(s,{type:"primary",class:"handleAdd",onClick:g},{default:a(()=>t[1]||(t[1]=[m("烂梗投稿")])),_:1})]),X((C(),T(B,{data:y.value,stripe:"","cell-class-name":"hover-pointer",onRowClick:h},{default:a(()=>[e(d,{align:"center",width:"60"},{default:a(u=>[_("span",ve,E(u.row.id),1)]),_:1}),e(d,{prop:"content"},{default:a(u=>[m(E(u.row.content),1)]),_:1}),e(d,{align:"center",width:"100"},{default:a(u=>[e(s,{type:"primary",class:"copy-btn",onClick:Y(we=>h(u.row),["stop"])},{default:a(()=>[m("复制 ("+E(u.row.copyCount)+")",1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,c.value]])]),_("div",ye,[c.value?ee("",!0):(C(),T(Q,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":p.value,total:b.value,"pager-count":4,"page-size":x,onCurrentChange:M},null,8,["current-page","total"]))]),e(_e,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=u=>f.value=u)},null,8,["modelValue"]),e(R,{right:50,bottom:50},{default:a(()=>t[3]||(t[3]=[m("UP")])),_:1})])}}}),Ae=le(be,[["__scopeId","data-v-6a5c7094"]]);export{Ae as default};
