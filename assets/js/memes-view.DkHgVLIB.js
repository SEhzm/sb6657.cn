import{k as u,a as j,c as D,d as O,r as W,n as Z,o as H,p as J,b as $,l as G,e as K,q as X,v as Y}from"./element-plus.C3kSHAgf.js";import{h as C,M as ee,_ as te}from"./index.Bk4ZnkiT.js";import{u as oe,b as ae}from"./vue-router.DkBAQHKx.js";import{e as le,c as ne,a as re,p as se,t as ie,l as ce,b as ue}from"./setMeme.D5yZhydv.js";import{d as pe,k as me,r as _,w as de,Z as _e,o as E,c as ge,a as g,U as t,O as l,S as p,P as fe,M as be,F as ve}from"./@vue.kwc71ESp.js";import"./lodash-es.CiJSjksT.js";import"./@vueuse.Bmvu7DnR.js";import"./@element-plus.CQ2moJ0T.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.CdCgAjqw.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";const ye={class:"cardTable",style:{position:"relative"}},he={class:"pagination-wrapper"},we={class:"dialog-footer"},v=50,Ce=pe({__name:"memes-view",setup(Ee){const f=oe(),V=ae(),k=me(()=>ee.find(a=>a.path===f.path)),b=_(!0),y=_([]),h=_(0),m=_(1);async function i(a){var r;const e=(r=k.value)==null?void 0:r.category;if(!e){V.push("/404");return}const n=await le(e,a,v);n&&(y.value=n.memeArr,h.value=n.total,b.value=!1)}i(1),de(()=>f.path,()=>{console.log("当前页面path:",f.path),m.value=1,b.value=!0,i(1)});const x=()=>{window.scrollTo({top:0,behavior:"smooth"})},U=a=>{m.value=a,x(),i(a)},P=ie(ue,ce,2e3);async function M(a){const e=a.content,n=P(e);if(!(!n||n==="limitedSuccess")){if(ne(),await re(a.category,a.id,m.value,v)){await i(m.value);return}se()}}const T={table:[{required:!0,message:"请选择分栏",trigger:"blur"}],barrage:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},d=_(!1),o=_e({category:"",content:""}),B=()=>{o.category="",o.content="",d.value=!0},S=()=>{o.category===""||o.content===""?u.error("请选择分栏或输入弹幕"):C.post("/machine/addUnaudit",{table:o.category,barrage:o.content}).then(a=>{i(1),d.value=!1,a.code==="200"?u.success("投稿成功，待审核(一天内)"):u.error("请求失败")})},Q=()=>{o.category===""||o.content===""?u.error("请选择分栏或输入弹幕"):C.post("/machine/addUnaudit",{table:o.category,barrage:o.content}).then(a=>{i(1),o.content="",a.code==="200"?(u.success("投稿成功，待审核(一天内)"),data.barrage=""):u.error("投稿失败，必要时请及时反馈")})};return(a,e)=>{const n=j,r=D,F=O,R=W,s=Z,z=H,w=J,A=$,I=G,N=K,q=X,L=Y;return E(),ge(ve,null,[g("div",null,[g("div",ye,[t(n,{type:"primary",class:"handleAdd",onClick:B},{default:l(()=>e[4]||(e[4]=[p("投稿弹幕")])),_:1}),fe((E(),be(F,{stripe:"",data:y.value,"empty-text":"我还没有加载完喔~~",class:"eldtable","header-cell-style":{color:"#ff0000",fontSize:"13px",whitespace:"normal !important"},"cell-style":{cursor:"Pointer"},onRowClick:M},{default:l(()=>[t(r,{width:"58",prop:"id",label:"序号"}),t(r,{prop:"content","min-width":"90",label:"弹幕"}),t(r,{label:"",align:"center",width:"85"},{default:l(()=>[t(n,{type:"primary",label:"操作"},{default:l(()=>e[5]||(e[5]=[p("复制")])),_:1})]),_:1}),t(r,{prop:"copyCount",label:"复制次数",width:"55"})]),_:1},8,["data"])),[[L,b.value]])]),g("div",he,[g("div",null,[t(R,{background:"red",layout:"prev, pager, next, jumper","current-page":m.value,total:h.value,"pager-count":4,"page-size":v,onCurrentChange:U},null,8,["current-page","total"])])]),t(N,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=c=>d.value=c),draggable:"",title:"投稿弹幕",width:"82%"},{footer:l(()=>[g("div",we,[t(n,{onClick:e[2]||(e[2]=c=>d.value=!1)},{default:l(()=>e[6]||(e[6]=[p("关闭")])),_:1}),t(n,{type:"primary",onClick:S},{default:l(()=>e[7]||(e[7]=[p("投稿并关闭")])),_:1}),t(n,{type:"primary",onClick:Q},{default:l(()=>e[8]||(e[8]=[p("连续投稿")])),_:1})])]),default:l(()=>[t(I,{model:o,"label-width":"100px",rules:T,"label-position":"right"},{default:l(()=>[t(w,{label:"分栏","label-width":100,prop:"table"},{default:l(()=>[t(z,{modelValue:o.category,"onUpdate:modelValue":e[0]||(e[0]=c=>o.category=c),placeholder:"选择上传的分栏"},{default:l(()=>[t(s,{label:"喷玩机器篇",value:"machine_penWJQ"}),t(s,{label:"木柜子篇",value:"machine_mygo"}),t(s,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),t(s,{label:"喷选手篇",value:"machine_penPlayer"}),t(s,{label:"+1",value:"machine_p1"}),t(s,{label:"群魔乱舞篇",value:"machine_QMLW"}),t(s,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"弹幕内容",prop:"barrage"},{default:l(()=>[t(A,{maxlength:"255",modelValue:o.content,"onUpdate:modelValue":e[1]||(e[1]=c=>o.content=c),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(q,{right:50,bottom:50},{default:l(()=>e[9]||(e[9]=[p("UP")])),_:1})],64)}}}),qe=te(Ce,[["__scopeId","data-v-618551e0"]]);export{qe as default};
