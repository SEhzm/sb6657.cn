import{d as X,r as n,i as Z,c as d,o as i,a as t,K as ee,M as h,P as V,a6 as C,O as L,J as O,ak as te,ac as ae,V as se,Q as w,I as U,u as p,H as le,D as oe,n as I}from"./@vue.Ca5AQEsS.js";import{h as P,_ as ne}from"./index.DtmArXH0.js";import{A as F,B as W,a as H}from"./element-plus.pEMcb2g5.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.DhOS9MZH.js";import"./@element-plus.w7YOadmw.js";import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";const j="/assets/png/user-img-0.DNvIIjpW.png",ie="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1750002304231'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5531'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M1024%20544c0%20265.12-214.944%20480-480%20480h-64C214.912%201024%200%20809.12%200%20544v-64C0%20214.912%20214.912%200%20480%200h64c265.056%200%20480%20214.912%20480%20480v64z'%20fill='%23085684'%20p-id='5532'%3e%3c/path%3e%3cpath%20d='M512.032%20160a216.896%20216.896%200%200%200-216.64%20216.64%20216.896%20216.896%200%200%200%20216.64%20216.608c119.424%200%20216.672-97.248%20216.672-216.608A216.96%20216.96%200%200%200%20512.032%20160z'%20fill='%23FFFFFF'%20p-id='5533'%3e%3c/path%3e%3cpath%20d='M678.976%20588.256c-46.112%2036.512-103.584%2059.104-166.944%2059.104s-120.768-22.656-167.04-59.104c-87.584%2055.776-148.544%20153.696-156.928%20267.104%2030.656%204.16%2085.248%208.64%20163.104%208.64h321.568c77.92%200%20132.512-4.48%20163.232-8.672-8.32-113.44-69.312-211.296-156.992-267.072z'%20fill='%23FFFFFF'%20p-id='5534'%3e%3c/path%3e%3c/svg%3e",re={class:"chatgpt-container"},ue={key:0,class:"bubble ai-bubble"},de=["innerHTML"],ce={key:1,class:"bubble user-bubble"},me={class:"bubble-content"},pe={key:0,class:"message ai"},ve={class:"bubble ai-bubble"},be={class:"bubble-content"},fe=["disabled"],ge=["disabled"],he={class:"reasoning"},we=["disabled"],ye={class:"controls-container"},ke={class:"control-item"},xe={class:"control-item"},_e=X({__name:"AIChat",setup(Te){const v=n([]),c=n(""),s=n(!1),r=n(""),y=n(!1),k=n(null),b=n(3),x=n([]),m=n(""),G=l=>{let e=l;return e=e.replace(/<think>/g,""),e=e.replace(/<\/think>/g,""),e=e.replace(/^data:.*\n?/gm,""),e=e.replace(/^\s+|\s+$/g,""),e.trim()},f=async()=>{var l;await I(),(l=k.value)==null||l.scrollTo({top:k.value.scrollHeight,behavior:"smooth"})},J=async()=>{if(!c.value.trim()||s.value)return;const l=c.value;v.value.push({role:"user",content:l}),c.value="",r.value="",s.value=!0,await I(),f();let e=0;const a=1;let u=null;const _=async()=>{var A,D,N;const S=localStorage.getItem("Admin-Token");if(!S){H.warning("请先登录！"),s.value=!1;return}try{const o=new URLSearchParams;o.append("prompt",l),o.append("needReasoning",String(y.value)),o.append("memesNum",String(b.value)),m.value!==""&&o.append("tag",m.value);const T=await fetch(`${P.defaults.baseURL}/suanli/stream`,{method:"POST",headers:{Authorization:S},body:o});if(T.code===401){H.warning("请先登录！"),s.value=!1;return}if(!T.body)throw new Error("响应流为空");const $=T.body.getReader(),q=new TextDecoder("utf-8");let g=!1;for(u&&(clearTimeout(u),u=null);!g;){const{value:B,done:K}=await $.read();if(B){const Q=q.decode(B,{stream:!0}).split(`
`);for(const R of Q)if(R.startsWith("data:")){const z=R.replace(/^data:\s*/,"");if(z==="[DONE]"){g=!0;break}try{const E=(N=(D=(A=JSON.parse(z).choices)==null?void 0:A[0])==null?void 0:D.delta)==null?void 0:N.content;E!==void 0&&(r.value+=E,await I(),f())}catch{}}}g=g||K}v.value.push({role:"ai",content:G(r.value)}),r.value=""}catch(o){e<a?(console.warn("请求失败，正在重试...",o),e++,setTimeout(_,1e3)):r.value="请求失败："+((o==null?void 0:o.message)||o)}finally{s.value=!1,f(),u&&clearTimeout(u)}};u=setTimeout(()=>{s.value&&(console.warn("AI响应超时，此刻算力不足，请重试..."),e<a?(e++,_()):(r.value="AI响应超时，此刻算力不足，请重试。",s.value=!1,f()))},9e4),_()},M=async()=>{v.value=[],c.value="",r.value="",s.value=!1,b.value=3,m.value="",x.value=[];try{const l=await P.get("/machine/dictList");l.data&&l.code===200&&(x.value=l.data)}catch(l){console.error("获取标签列表失败:",l)}};return Z(()=>{M()}),(l,e)=>(i(),d("div",re,[t("div",{class:"chat-window",ref_key:"chatWindow",ref:k},[t("div",{class:"ai-welcome-message"},[e[4]||(e[4]=h(" AI造梗助手Demo（32B模型，算力一般）")),e[5]||(e[5]=t("span",{style:{"font-size":"small"}},[h("每天50次"),t("span",{style:{"font-size":"smaller"}},"(成本不低..)")],-1)),e[6]||(e[6]=t("b",null,"卡了可以刷新",-1)),t("button",{class:"refresh-button",onClick:M}," 刷新 ")]),(i(!0),d(V,null,C(v.value,(a,u)=>(i(),d("div",{key:u,class:oe(["message",a.role])},[a.role==="ai"?(i(),d("div",ue,[e[7]||(e[7]=t("img",{class:"avatar",src:j,alt:"AI"},null,-1)),t("div",{class:"bubble-content",innerHTML:a.content},null,8,de)])):(i(),d("div",ce,[e[8]||(e[8]=t("img",{class:"avatar",src:ie,alt:"你"},null,-1)),t("div",me,L(a.content),1)]))],2))),128)),s.value?(i(),d("div",pe,[t("div",ve,[e[10]||(e[10]=t("img",{class:"avatar",src:j,alt:"AI"},null,-1)),t("div",be,[h(L(r.value),1),e[9]||(e[9]=t("span",{class:"cursor"},"|",-1))])])])):ee("",!0)],512),t("form",{class:"input-form",onSubmit:se(J,["prevent"])},[O(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),placeholder:"请输入…",disabled:s.value,autocomplete:"off"},null,8,fe),[[te,c.value]]),t("button",{disabled:s.value||!c.value.trim(),type:"submit"}," 发送 ",8,ge),t("label",he,[O(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),disabled:s.value},null,8,we),[[ae,y.value]]),e[11]||(e[11]=h(" 需要查看思考过程 "))])],32),e[14]||(e[14]=t("span",{style:{"font-size":"small","text-align":"center","user-select":"none"}},"服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，不代表我们的态度或观点。",-1)),t("div",ye,[t("div",ke,[e[12]||(e[12]=t("label",{for:"memesNum"},"造梗数量:",-1)),w(p(W),{id:"memesNum",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),disabled:s.value,placeholder:"选择梗数量"},{default:U(()=>[(i(),d(V,null,C(10,a=>w(p(F),{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue","disabled"])]),t("div",xe,[e[13]||(e[13]=t("label",{for:"tagSelect"},"梗标签:",-1)),w(p(W),{id:"tagSelect",modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value=a),disabled:s.value,placeholder:"全部"},{default:U(()=>[w(p(F),{label:"全部",value:""}),(i(!0),d(V,null,C(x.value,a=>(i(),le(p(F),{key:a.dictValue,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])]))}}),He=ne(_e,[["__scopeId","data-v-1805a27a"]]);export{He as default};
