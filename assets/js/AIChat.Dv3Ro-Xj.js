import{d as K,h as u,f as Q,c as r,o as n,a as s,L as Y,O as p,Q as C,a6 as I,P as V,K as R,aj as X,ae as Z,W as ee,R as g,J as z,u as v,I as te,E as se,n as B}from"./@vue.BltuATdo.js";import{h as U,_ as ae}from"./index.C7cp5ExU.js";import{c as F,d as O,a as P}from"./element-plus.DQRrSmQa.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.oDprkwHL.js";import"./@element-plus.BgPfl9pw.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const W="/assets/png/user-img-0.DNvIIjpW.png",le="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1750002304231'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5531'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M1024%20544c0%20265.12-214.944%20480-480%20480h-64C214.912%201024%200%20809.12%200%20544v-64C0%20214.912%20214.912%200%20480%200h64c265.056%200%20480%20214.912%20480%20480v64z'%20fill='%23085684'%20p-id='5532'%3e%3c/path%3e%3cpath%20d='M512.032%20160a216.896%20216.896%200%200%200-216.64%20216.64%20216.896%20216.896%200%200%200%20216.64%20216.608c119.424%200%20216.672-97.248%20216.672-216.608A216.96%20216.96%200%200%200%20512.032%20160z'%20fill='%23FFFFFF'%20p-id='5533'%3e%3c/path%3e%3cpath%20d='M678.976%20588.256c-46.112%2036.512-103.584%2059.104-166.944%2059.104s-120.768-22.656-167.04-59.104c-87.584%2055.776-148.544%20153.696-156.928%20267.104%2030.656%204.16%2085.248%208.64%20163.104%208.64h321.568c77.92%200%20132.512-4.48%20163.232-8.672-8.32-113.44-69.312-211.296-156.992-267.072z'%20fill='%23FFFFFF'%20p-id='5534'%3e%3c/path%3e%3c/svg%3e",oe={class:"chatgpt-container"},ne={key:0,class:"bubble ai-bubble"},ie=["innerHTML"],re={key:1,class:"bubble user-bubble"},ue={class:"bubble-content"},de={key:0,class:"message ai"},ce={class:"bubble ai-bubble"},me={key:0,class:"bubble-content"},pe={key:1,class:"bubble-content"},ve=["disabled"],be=["disabled"],fe={class:"reasoning"},ge=["disabled"],he={class:"controls-container"},we={class:"control-item"},ye={class:"control-item"},ke=K({__name:"AIChat",setup(xe){const b=u([]),d=u(""),a=u(!1),i=u(""),h=u(!1),w=u(null),f=u(3),y=u([]),c=u(""),$=l=>{let e=l;return e=e.replace(/<think>/g,""),e=e.replace(/<\/think>/g,""),e=e.replace(/(\d+)\s*\n\s*\.\s*\n?\s*/g,"$1. "),e=e.replace(/(\d+)\s*\.\s*/g,"$1. "),e=e.replace(/^\s+/,""),e=e.replace(/\n{3,}/g,`

`),e=e.split(`
`).map(t=>t.trim()).join(`
`),e=e.replace(/^\s+|\s+$/g,""),e.trim()},k=async()=>{var l;await B(),(l=w.value)==null||l.scrollTo({top:w.value.scrollHeight,behavior:"smooth"})},j=async()=>{if(!d.value.trim()||a.value)return;const l=d.value;b.value.push({role:"user",content:l}),d.value="",i.value="",a.value=!0,await B(),k();let e=0;const t=1;let m=null;const x=async()=>{const M=localStorage.getItem("Admin-Token");if(!M){P.warning("请先登录！"),a.value=!1;return}try{const o=new URLSearchParams;o.append("prompt",l),o.append("needReasoning",String(h.value)),o.append("memesNum",String(f.value)),c.value!==""&&o.append("tag",c.value);const _=await fetch(`${U.defaults.baseURL}/suanli/stream`,{method:"POST",headers:{Authorization:M},body:o});if(_.code===401){P.warning("请先登录！"),a.value=!1;return}if(!_.body)throw new Error("响应流为空");let A="";const G=new TextDecoder("utf-8"),H=_.body.getReader();for(;;){const{done:J,value:q}=await H.read();if(J)break;G.decode(q,{stream:!0}).split("data:").forEach(N=>{var D,E,L;if(N.trim())try{const T=JSON.parse(N.trim());(L=(E=(D=T.choices)==null?void 0:D[0])==null?void 0:E.delta)!=null&&L.content&&(A+=T.choices[0].delta.content,i.value=A)}catch{}})}b.value.push({role:"ai",content:$(i.value)}),i.value=""}catch(o){e<t?(console.warn("请求失败，正在重试...",o),e++,setTimeout(x,1e3)):i.value="请求失败："+((o==null?void 0:o.message)||o)}finally{a.value=!1,k(),m&&clearTimeout(m)}};m=setTimeout(()=>{a.value&&(console.warn("AI响应超时，此刻算力不足，请重试..."),e<t?(e++,x()):(i.value="AI响应超时，此刻算力不足，请重试。",a.value=!1,k()))},9e4),x()},S=async()=>{b.value=[],d.value="",i.value="",a.value=!1,f.value=3,c.value="",y.value=[];try{const l=await U.get("/machine/dictList");l.data&&l.code===200&&(y.value=l.data)}catch(l){console.error("获取标签列表失败:",l)}};return Q(()=>{S()}),(l,e)=>(n(),r("div",oe,[s("div",{class:"chat-window",ref_key:"chatWindow",ref:w},[s("div",{class:"ai-welcome-message"},[e[4]||(e[4]=p(" AI造梗助手Demo（32B模型，算力一般）",-1)),e[5]||(e[5]=s("span",{style:{"font-size":"small"}},[p("每天50次"),s("span",{style:{"font-size":"smaller"}},"(成本不低..)")],-1)),e[6]||(e[6]=s("b",null,"等待两分钟卡了可以刷新",-1)),s("button",{class:"refresh-button",onClick:S}," 刷新 ")]),(n(!0),r(C,null,I(b.value,(t,m)=>(n(),r("div",{key:m,class:se(["message",t.role])},[t.role==="ai"?(n(),r("div",ne,[e[7]||(e[7]=s("img",{class:"avatar",src:W,alt:"AI"},null,-1)),s("div",{class:"bubble-content",innerHTML:t.content},null,8,ie)])):(n(),r("div",re,[e[8]||(e[8]=s("img",{class:"avatar",src:le,alt:"你"},null,-1)),s("div",ue,V(t.content),1)]))],2))),128)),a.value?(n(),r("div",de,[s("div",ce,[e[11]||(e[11]=s("img",{class:"avatar",src:W,alt:"AI"},null,-1)),i.value?(n(),r("div",me,[p(V(i.value),1),e[9]||(e[9]=s("span",{class:"cursor"},"|",-1))])):(n(),r("div",pe,[p(V(i.value),1),e[10]||(e[10]=s("span",{class:"cursor-wait"},"(排队中，耐心等待一分钟左右,毕竟算力有限🥺)|",-1))]))])])):Y("",!0)],512),s("form",{class:"input-form",onSubmit:ee(j,["prevent"])},[R(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"请输入…",disabled:a.value,autocomplete:"off"},null,8,ve),[[X,d.value]]),s("button",{disabled:a.value||!d.value.trim(),type:"submit"}," 发送 ",8,be),s("label",fe,[R(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),disabled:a.value},null,8,ge),[[Z,h.value]]),e[12]||(e[12]=p(" 需要查看思考过程 ",-1))])],32),e[15]||(e[15]=s("span",{style:{"font-size":"small","text-align":"center","user-select":"none"}},"服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，不代表我们的态度或观点。",-1)),s("div",he,[s("div",we,[e[13]||(e[13]=s("label",{for:"memesNum"},"造梗数量:",-1)),g(v(O),{id:"memesNum",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),disabled:a.value,placeholder:"选择梗数量"},{default:z(()=>[(n(),r(C,null,I(10,t=>g(v(F),{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue","disabled"])]),s("div",ye,[e[14]||(e[14]=s("label",{for:"tagSelect"},"梗标签:",-1)),g(v(O),{id:"tagSelect",modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),disabled:a.value,placeholder:"全部"},{default:z(()=>[g(v(F),{label:"全部",value:""}),(n(!0),r(C,null,I(y.value,t=>(n(),te(v(F),{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])]))}}),Pe=ae(ke,[["__scopeId","data-v-5a745605"]]);export{Pe as default};
