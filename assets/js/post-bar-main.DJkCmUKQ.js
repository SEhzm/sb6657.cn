import{a as S,j as O,n as q,l as X,c as W,J as Y,K as Z,H as ee,e as te,f as ae,d as ne,L as se}from"./element-plus.DX6Kv4BD.js";import{_ as oe,a as re,b as le,c as ie,C as ce}from"./sendPost.vue_vue_type_style_index_0_scoped_86d80eb7_lang.bUvFpfQu.js";import{h,A as de,_ as J}from"./index.DmgoweOK.js";import{a as me}from"./setMeme.Cy9g8Te8.js";import{C as ue}from"./CommunityNorms.B1CUO8-P.js";import{d as Q,b as i,X as pe,k as R,o as r,c,a as n,P as l,H as d,L as f,K as N,D as be,G as j,u as ge,O as $,ag as fe,f as _e,I as ye,a4 as D,M as g}from"./@vue.BqJqC78G.js";import{a as ve}from"./clipboard.CwvAt65k.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.C-35htfh.js";import"./@element-plus.Du5FBV_q.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.D6RD0Zoz.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.PTNpl1pN.js";const he={class:"post-form"},ke={class:"form-header"},Ce={key:0},we={key:0,style:{display:"flex",gap:"10px"}},Se={class:"form-footer"},Ne=["innerHTML"],xe=Q({__name:"sendPost",setup(G){const k=i(!1),_=i(!1),y=i("");i(0);const v=i(!1),p=i(""),C=i(null),w=pe({filteredItems:[]}),x=()=>{h.post(de.SEARCH_MEME,{barrage:p.value}).then(m=>{w.filteredItems=m.data||[]}).catch(m=>{console.error("搜索失败",m)})},L=R(()=>p.value===""?"width: 80%;":"width: 20%;"),B=R(()=>w.filteredItems.map(m=>({id:m.id,barrage:m.barrage}))),V=async()=>{if(!y.value.trim()){S.warning("内容不能为空");return}try{const m=await h.post("/machine/Post/ReviewPost/submit",{barrageId:C.value,content:y.value.trim()});m.code===200?(S.success("发帖成功！等待审核中～"),y.value=""):S.error(m.msg||"发帖失败")}catch{S.error("网络错误，发帖失败")}};return(m,a)=>{const M=O,F=fe("InfoFilled"),I=q,E=X,P=W,T=Y,A=Z,U=ee,e=te;return r(),c($,null,[n("div",he,[l(U,null,{default:d(()=>[n("div",ke,[a[10]||(a[10]=n("h3",null,"发帖",-1)),l(M,{type:"textarea",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),placeholder:"发布帖子...   使用AI辅助人工自动审核，请注意发言规范。",maxlength:"299","show-word-limit":""},null,8,["modelValue"]),l(E,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),size:"large"},{default:d(()=>[a[8]||(a[8]=f(" 关联烂梗 ")),v.value?(r(),c("span",Ce,[l(I,null,{default:d(()=>[l(F)]),_:1}),a[7]||(a[7]=f(" 先在左边搜索然后右边选择一条关联⬇️"))])):N("",!0)]),_:1},8,["modelValue"]),v.value?(r(),c("span",we,[l(M,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=t=>p.value=t),placeholder:"查找烂梗,点击搜索后右边选择关联",style:be(L.value)},null,8,["modelValue","style"]),l(P,{style:{width:"70px"},type:"primary",onClick:x},{default:d(()=>a[9]||(a[9]=[f("搜索")])),_:1}),w.filteredItems.length?(r(),j(T,{key:0,options:B.value,props:{checkStrictly:!0,emitPath:!1,label:"barrage",value:"id"},clearable:"",teleported:"true","popper-class":"barrage-cascader-popper",placeholder:"选择关联的烂梗",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=t=>C.value=t),style:{width:"100%","word-wrap":"break-word","word-break":"break-all"}},null,8,["options","modelValue"])):N("",!0)])):N("",!0)]),n("div",Se,[l(E,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=t=>k.value=t),size:"large"},{default:d(()=>[a[12]||(a[12]=f(" 已同意 ")),l(A,{type:"primary",onClick:a[4]||(a[4]=t=>_.value=!0)},{default:d(()=>a[11]||(a[11]=[f("《社区规范》")])),_:1}),a[13]||(a[13]=f(" ，不发布违反规范内容 "))]),_:1},8,["modelValue"]),l(P,{type:"primary",onClick:V,disabled:k.value===!1},{default:d(()=>a[14]||(a[14]=[f("发布")])),_:1},8,["disabled"])])]),_:1})]),l(e,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=t=>_.value=t),title:"社区规范与隐私政策",width:"800"},{default:d(()=>[n("div",{innerHTML:ge(ue)},null,8,Ne)]),_:1},8,["modelValue"])],64)}}}),Ve=J(xe,[["__scopeId","data-v-86d80eb7"]]),Me={class:"main-post"},Ie={class:"post-card-header"},Ee=["src"],Pe={class:"post-user-name"},$e={class:"post-meta"},Le={class:"post-createTime"},Be={style:{color:"black"}},Fe=["onClick"],Te={class:"post-content"},Ae={key:0,class:"post-statements"},Ue=["src"],De={class:"post-footer"},He={class:"post-footer-meta"},Re={style:{display:"flex"}},ze=["onClick"],Je=["src"],Qe={style:{cursor:"pointer"}},je=["onClick"],Ge=["onClick"],Ke=["onClick"],Oe={key:0},z=5,qe=Q({__name:"post-bar-main",setup(G){const k=i(new Map),_=i(new Map),y=i([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),v=i([]),p=i(new Map);i({});const C=i(1),w=i(!0),x=i(!1),L=async e=>{const t=await h.get(`/machine/Post/Comment/getComment/${e}`);k.value.set(e,t.data)},B=async e=>{_.value.get(e)||await L(e),_.value.set(e,!_.value.get(e))},V=async()=>{if(!(x.value||!w.value)){x.value=!0,console.log("Loading more posts...");try{const e=await h.get("/machine/Post/list",{params:{pageNum:C.value,pageSize:z}});e.data.list.length<z&&(w.value=!1),v.value.push(...e.data.list),C.value++}catch{}finally{x.value=!1}}},m=e=>new Date(e).toLocaleString(),a=["https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab62.jpg","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab65.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab64.png","https://pic1.imgdb.cn/item/6807007258cb8da5c8bdbbbc.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce4.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce7.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce3.png","https://pic1.imgdb.cn/item/680700aa58cb8da5c8bdbce1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd7.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd6.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd5.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd3.png","https://pic1.imgdb.cn/item/680700f858cb8da5c8bdbe94.png","https://pic1.imgdb.cn/item/6807011a58cb8da5c8bdbf61.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf64.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf62.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf63.png"],M=e=>{const t=Math.floor(Math.random()*20);return a[t]},F=async e=>{if(p.value.has(e))return p.value.get(e);const b=(await h.get(`/machine/getBarrageInfo/${e}`)).data;return p.value.set(e,b),b};function I(e){e.likeFlag||h.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const E=(e,t)=>{const u={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return!!u&&e[u]>0},P=(e,t)=>{const u={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return u?e[u]:0},T=e=>e?y.value.filter(t=>E(e,t.statementNum)):[];function A(e,t,b){const u=v.value.find(o=>o.id===b);if(!u||!u.postStatement)return;const s={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];s&&h.post("/machine/Post/Statement",{portId:e,postId:b,statementNum:t}).then(()=>{u.postStatement[s]++,S.success("表态成功")})}function U(e){e&&(ve(e.barrage),me(e.id.toString()).then(()=>{S.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return _e(()=>{V()}),(e,t)=>{const b=ae,u=ne,H=se;return ye((r(),c("div",Me,[l(Ve),(r(!0),c($,null,D(v.value,s=>(r(),c("div",{key:s.id,class:"card post-card-main"},[n("div",null,[n("div",Ie,[n("img",{class:"user-img",src:M(s.userName),alt:""},null,8,Ee),n("span",Pe,g(s.userName),1)]),n("div",$e,[n("span",Le,g(m(s.createTime)),1),l(u,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:o=>F(s.barrageId)},{reference:d(()=>[s.barrage?(r(),j(b,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:d(()=>[n("span",Be,"#烂梗："+g(s.barrage),1)]),_:2},1024)):N("",!0)]),default:d(()=>{var o;return[n("div",{style:{cursor:"pointer"},onClick:K=>U(p.value.get(s.barrageId))},g((o=p.value.get(s.barrageId))==null?void 0:o.barrage),9,Fe)]}),_:2},1032,["onBeforeEnter"])])]),n("span",Te,g(s.content),1),s.postStatement?(r(),c("div",Ae,[(r(!0),c($,null,D(T(s.postStatement),o=>(r(),c("span",{key:o.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[l(b,{round:""},{default:d(()=>[n("img",{src:o.url},null,8,Ue),n("span",null,g(P(s.postStatement,o.statementNum)),1)]),_:2},1024)]))),128))])):N("",!0),n("div",De,[n("div",He,[l(u,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:d(()=>[n("div",Re,[(r(!0),c($,null,D(y.value,o=>(r(),c("div",{key:o.statementNum,style:{"margin-right":"10px"}},[n("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:K=>A(s.id,o.statementNum,s.id)},[n("img",{style:{width:"30px",cursor:"pointer"},src:o.url},null,8,Je),n("span",Qe,g(o.name),1)],8,ze)]))),128))])]),reference:d(()=>t[0]||(t[0]=[n("span",null,[n("img",{src:oe}),f(" 表态")],-1)])),_:2},1024),n("span",{style:{cursor:"pointer"},onClick:o=>B(s.id)},[t[1]||(t[1]=n("img",{src:re},null,-1)),n("span",null," "+g(s.commentCount),1)],8,je),s.likeFlag?(r(),c("span",{key:0,style:{cursor:"not-allowed"},onClick:o=>I(s)},[t[2]||(t[2]=n("img",{src:le},null,-1)),n("span",null," "+g(s.postLike),1)],8,Ge)):(r(),c("span",{key:1,style:{cursor:"pointer"},onClick:o=>I(s)},t[3]||(t[3]=[n("img",{src:ie},null,-1),f(" 赞 ")]),8,Ke))]),_.value.get(s.id)?(r(),c("div",Oe,[l(ce,{comments:k.value.get(s.id)||[],"post-id":s.id},null,8,["comments","post-id"])])):N("",!0)])]))),128))])),[[H,V]])}}}),ft=J(qe,[["__scopeId","data-v-a5d0d1f0"]]);export{ft as default};
