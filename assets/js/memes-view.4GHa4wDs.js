import{h as v,bK as pe,al as d,I as C,o as r,J as a,a as l,R as n,O as p,c as f,Q as R,a6 as Q,L as S,P as h,d as me,i as ve,j as fe,ar as _e,K as ge,u as te,W as be}from"./@vue.BltuATdo.js";import{u as he,b as ye}from"./vue-router.oDprkwHL.js";import{_ as ae,h as Z,A as ne,M as we}from"./index.BBfoH8pv.js";import{u as se,b as le}from"./memeTags.Dg3Agatx.js";import{f as ke,t as xe}from"./flip-num.CU8-DjBm.js";import{c as Ce,a as oe,p as Te,l as Ve,b as $e}from"./setMeme.BQIukcnw.js";import{b as M}from"./element-plus.DQRrSmQa.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./@element-plus.BgPfl9pw.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const Ue={class:"preset-tags-container"},Me={class:"preset-tags"},Se={class:"tag-icon-wrapper"},ze=["src"],De={style:{"vertical-align":"middle"}},Ee={class:"added-tags"},Le={class:"footer-container"},Fe={class:"match-section"},Ie={key:0,class:"match-details-box"},Pe={class:"match-info-row"},je=["src","alt"],Ae={class:"match-name"},Be={class:"match-time"},Ne={key:1,class:"no-match-info"},Re={class:"button-group"},Qe={__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(ee){const z=se(),_=v(""),T=v([]),V=v([]),g=v([]);z.tagsLoaded.then(()=>{T.value=z.memeTags.map(s=>({iconUrl:s.iconUrl,label:s.dictLabel,value:s.dictValue}))});const m=v(null);function W(){Z.get("/machine/InProgressMatch").then(s=>{s.code===200&&s.data?m.value=s.data:m.value=null})}W();const y=s=>{V.value=V.value.filter(t=>t.value!==s.value),g.value=g.value.filter(t=>t!==s.value),T.value.push(s)},$=s=>{if(g.value.length>=5){M.info("最多5个标签");return}V.value.some(t=>t.value===s.value)||(V.value.push(s),g.value.push(s.value),T.value=T.value.filter(t=>t.value!==s.value))},I=()=>{if(g.value.length===0||_.value===""||_.value===null)M.error("请选择标签或输入弹幕");else{if(g.value.length>5){M.error("最少一个标签，最多五个标签。");return}const s={tags:g.value.join(","),barrage:_.value};w.value&&m.value&&(s.matchId=m.value.id),Z.post(ne.SUBMIT_MEME,s).then(t=>{_.value="",w.value=!1,t.code===200?M.success("投稿成功，待审核(一天内)"):t.code===500?M.error("烂梗已经有了，勿重复提交"):M.error("请求失败")}).catch(t=>{console.error("投稿失败",t),M.error("请求失败")})}},x=pe(ee,"modelValue"),w=v(!1);return(s,t)=>{const D=d("Warning"),E=d("el-icon"),P=d("el-popover"),K=d("QuestionFilled"),L=d("el-button"),F=d("el-tag"),H=d("el-input"),X=d("el-checkbox"),O=d("el-dialog");return r(),C(O,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=u=>x.value=u),draggable:"",title:"投稿烂梗",width:"82%"},{footer:a(()=>[l("div",Le,[l("div",Fe,[n(X,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=u=>w.value=u),disabled:!m.value,class:"match-checkbox"},{default:a(()=>[t[13]||(t[13]=p(" 关联赛事库 ",-1)),n(E,{color:"#3db302ff",size:"16"},{default:a(()=>[n(K)]),_:1})]),_:1},8,["modelValue","disabled"]),m.value?(r(),f("div",Ie,[l("div",Pe,[l("img",{src:m.value.matchesImg,class:"match-image",alt:m.value.matchesName},null,8,je),l("span",Ae,h(m.value.matchesName),1)]),l("div",Be,h(m.value.startTime)+" 至 "+h(m.value.endTime),1)])):(r(),f("div",Ne," 当前无正在进行的大型赛事 "))]),l("div",Re,[n(L,{plain:"",onClick:t[2]||(t[2]=u=>x.value=!1)},{default:a(()=>[...t[14]||(t[14]=[p("关闭",-1)])]),_:1}),n(L,{type:"primary",onClick:I},{default:a(()=>[...t[15]||(t[15]=[p("投稿",-1)])]),_:1})])])]),default:a(()=>[l("h4",null,[t[10]||(t[10]=p("可选标签",-1)),n(P,{width:300},{reference:a(()=>[n(E,{size:"16"},{default:a(()=>[n(D)]),_:1})]),default:a(()=>[t[4]||(t[4]=p(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),t[5]||(t[5]=l("br",null,null,-1)),t[6]||(t[6]=l("b",null,"点击标签即可添加",-1))]),_:1}),n(L,{link:"",type:"success",style:{"margin-left":"50%"}},{default:a(()=>[t[9]||(t[9]=p("投稿标签 ",-1)),n(P,{width:300},{reference:a(()=>[n(E,{size:"16"},{default:a(()=>[n(K)]),_:1})]),default:a(()=>[t[7]||(t[7]=l("b",null,"请在上方(建议/提交)问卷投稿。",-1)),t[8]||(t[8]=l("br",null,null,-1))]),_:1})]),_:1})]),l("div",Ue,[l("div",Me,[(r(!0),f(R,null,Q(T.value,(u,j)=>(r(),C(F,{round:"",key:j,closable:"",onClose:A=>$(u),onClick:A=>$(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:a(()=>[l("div",Se,[u.iconUrl?(r(),f("img",{key:0,src:u.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,ze)):S("",!0),l("span",De,h(u.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),l("h4",null,[t[12]||(t[12]=p("已选标签 ",-1)),n(P,{width:300},{reference:a(()=>[n(E,{size:"16"},{default:a(()=>[n(D)]),_:1})]),default:a(()=>[t[11]||(t[11]=l("b",null,"最少一个标签，最多五个标签。",-1))]),_:1})]),l("div",Ee,[(r(!0),f(R,null,Q(V.value,(u,j)=>(r(),C(F,{round:"",key:j,closable:"",onClick:A=>y(u),onClose:A=>y(u),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:a(()=>[p(h(u.label),1)]),_:2},1032,["onClick","onClose"]))),128))]),n(H,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=u=>_.value=u),maxlength:"255",autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea",placeholder:" 烂梗...."},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},We=ae(Qe,[["__scopeId","data-v-6cb563de"]]),Ke={class:"memes-view"},Oe={class:"card-table"},Ge={key:0,class:"card"},Je={class:"preset-tags-container"},qe={class:"preset-tags"},He={class:"tag-icon-wrapper"},Xe=["src"],Ye={style:{"vertical-align":"middle"}},Ze={class:"added-tags"},et={class:"tag-icon-wrapper"},tt=["src"],lt={style:{"vertical-align":"middle"}},ot={class:"top"},at=["onTouchstart","onTouchend"],nt={class:"barrage-text"},st={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},it={class:"tag-icon-wrapper"},rt=["src"],ut={style:{"vertical-align":"middle"}},dt={style:{position:"absolute",bottom:"0",right:"0","font-size":"11px","min-width":"170px"}},ct={class:"pagination-wrapper"},q=50,pt=me({__name:"memes-view",setup(ee){const z=se(),_=he(),T=ye(),V=ve(()=>(s.value=[],we.find(o=>o.path===_.path))),g=v(!0),m=v([]),W=v(0),y=v(1),$=v(!1),I=v([]),x=v([]),w=v([]),s=v([]);async function t(o){var U;const e=(U=V.value)==null?void 0:U.category;if(!e){T.push("/404");return}let c;s.value.length==0?c=await le(e,o,q):c=await le(e,o,q,s.value.join(",")),m.value=c.memeArr,W.value=c.total,g.value=!1}t(1);async function D(o){getDict(),Z.get(ne.GET_SORTED_ALL_MEME,{params:{pageNum:o,pageSize:q,tags:`${s.value}`}}).then(e=>{$.value=!0,m.value=e.data.list.map(c=>({total:c.total,content:c.barrage,id:c.id,copyCount:+c.cnt,tags:c.tags}))}).catch(e=>{m.value=[]})}fe(()=>_.path,()=>{console.log("当前页面path:",_.path),$.value=!1,y.value=1,g.value=!0,t(1)});const E=()=>{window.scrollTo({top:0,behavior:"smooth"})},P=o=>{y.value=o,E(),$.value==!1?t(o):D(o)},K=xe($e,Ve,2e3);async function L(o){const e=o.content,c=K(e);if(!(!c||c==="limitedSuccess")){if(Ce(),$.value==!0){if(await oe("allbarrage",o.id,y.value)){await D(y.value);return}}else if(await oe(o.category,o.id,y.value)){await t(y.value);return}Te()}}const F=v(!1),H=()=>{F.value=!0};z.tagsLoaded.then(()=>{I.value=z.memeTags,x.value=z.memeTags.map(o=>({iconUrl:o.iconUrl,label:o.dictLabel,value:o.dictValue}))});const X=o=>{if(!o||o.trim()==="")return[];const e=Array.from(new Set(o.split(",").map(b=>b.trim())));if(!I.value)return e.map(()=>({label:"",iconUrl:""}));const c=new Map(I.value.map(b=>[String(b.dictValue).trim(),b]));return e.map(b=>{const B=c.get(b);return B?{label:B.dictLabel,iconUrl:B.iconUrl}:{label:"",iconUrl:""}})},O=o=>{w.value=w.value.filter(e=>e.value!==o.value),s.value=s.value.filter(e=>e!==o.value),x.value.push(o),t(1)},u=o=>{w.value.some(e=>e.value===o.value)||(w.value.push(o),s.value.push(o.value),x.value=x.value.filter(e=>e.value!==o.value)),console.log(s.value),t(1)},j=o=>{o.touchStartTime=Date.now()},A=o=>{Date.now()-o.touchStartTime>100&&(o.popoverVisible=!0,setTimeout(()=>{o.popoverVisible=!1},1500))},ie=o=>o?o.replace("T"," ").split(".")[0]:"";return(o,e)=>{const c=d("Warning"),U=d("el-icon"),b=d("el-popover"),B=d("QuestionFilled"),G=d("el-button"),J=d("el-tag"),Y=d("el-table-column"),re=d("el-table"),ue=d("el-pagination"),de=d("el-backtop"),ce=_e("loading");return r(),f("div",Ke,[l("div",Oe,[te(_).path==="/memes/AllBarrage"?(r(),f("div",Ge,[l("h4",null,[e[9]||(e[9]=p("按标签查看烂梗",-1)),n(b,{width:300},{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(c)]),_:1})]),default:a(()=>[e[2]||(e[2]=p(" 为解决烂梗分栏不足和分类不清晰问题。",-1)),e[3]||(e[3]=l("br",null,null,-1)),e[4]||(e[4]=l("b",null,"点击标签即可添加",-1))]),_:1}),n(G,{link:"",type:"success",style:{"margin-left":"50%"}},{default:a(()=>[e[8]||(e[8]=p("投稿标签 ",-1)),n(b,{width:300},{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(B)]),_:1})]),default:a(()=>[e[5]||(e[5]=l("b",null,"功能待完善(后续更新将添加)，请在上方(建议/提交)问卷投稿，sry。",-1)),e[6]||(e[6]=l("br",null,null,-1)),e[7]||(e[7]=l("b",null,"审核巨严格，(重复，相似等)将不通过",-1))]),_:1})]),_:1})]),l("div",Je,[l("div",qe,[(r(!0),f(R,null,Q(x.value,(i,k)=>(r(),C(J,{round:"",key:k,closable:"",onClose:N=>u(i),onClick:N=>u(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},type:"primary"},{default:a(()=>[l("div",He,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"25px","object-fit":"cover","vertical-align":"middle"}},null,8,Xe)):S("",!0),l("span",Ye,h(i.label),1)])]),_:2},1032,["onClose","onClick"]))),128))])]),l("h4",null,[e[11]||(e[11]=p("包含标签 ",-1)),n(b,null,{reference:a(()=>[n(U,{size:"16"},{default:a(()=>[n(c)]),_:1})]),default:a(()=>[e[10]||(e[10]=l("b",null,"烂梗包含该标签",-1))]),_:1})]),l("div",Ze,[(r(!0),f(R,null,Q(w.value,(i,k)=>(r(),C(J,{round:"",key:k,closable:"",onClick:N=>O(i),onClose:N=>O(i),style:{padding:"15px",cursor:"pointer","font-size":"16px"},effect:"dark"},{default:a(()=>[l("div",et,[i.iconUrl?(r(),f("img",{key:0,src:i.iconUrl,style:{width:"22px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,tt)):S("",!0),l("span",lt,h(i.label),1)])]),_:2},1032,["onClick","onClose"]))),128))])])):S("",!0),l("div",ot,[e[14]||(e[14]=l("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),n(G,{type:"primary",onClick:H},{default:a(()=>[...e[12]||(e[12]=[p("烂梗投稿",-1)])]),_:1}),te(_).path==="/memes/AllBarrage"?(r(),C(G,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:e[0]||(e[0]=i=>D(1))},{default:a(()=>[...e[13]||(e[13]=[p("按复制次数排序",-1)])]),_:1})):S("",!0)]),ge((r(),C(re,{class:"main-table",data:m.value,stripe:"","cell-class-name":"hover-pointer","empty-text":"该标签组合为空，期待投稿！",onRowClick:L},{default:a(()=>[n(Y,{align:"center",width:"60"},{default:a(i=>[n(J,{round:"",effect:"plain"},{default:a(()=>[p(h(i.row.id),1)]),_:2},1024)]),_:1}),n(Y,{prop:"content"},{default:a(i=>[n(b,{placement:"top",width:"auto",trigger:"hover",visible:i.row.popoverVisible},{reference:a(()=>[l("div",{style:{cursor:"pointer"},onTouchstart:k=>j(i.row),onTouchend:k=>A(i.row)},[l("span",nt,h(i.row.content),1)],40,at)]),default:a(()=>[l("div",st,[(r(!0),f(R,null,Q(X(i.row.tags),(k,N)=>(r(),f("div",{key:N,style:{"margin-right":"8px"}},[n(J,{round:"",effect:"dark",style:{fontSize:"16px",cursor:"pointer"}},{default:a(()=>[l("div",it,[k.iconUrl?(r(),f("img",{key:0,src:k.iconUrl,style:{width:"16px",height:"22px","object-fit":"cover","vertical-align":"middle"}},null,8,rt)):S("",!0),l("span",ut,h(k.label),1)])]),_:2},1024)]))),128)),l("span",dt,"投稿时间: "+h(ie(i.row.submitTime)),1)])]),_:2},1032,["visible"])]),_:1}),n(Y,{align:"center",width:"100"},{default:a(i=>[n(G,{type:"primary",class:"copy-btn",onClick:be(k=>L(i.row),["stop"])},{default:a(()=>[e[15]||(e[15]=p("复制 🌈",-1)),n(ke,{num:i.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,g.value]]),l("div",ct,[g.value?S("",!0):(r(),C(ue,{key:0,background:"",layout:"prev, pager, next, jumper","current-page":y.value,total:W.value,"pager-count":5,"page-size":q,onCurrentChange:P},null,8,["current-page","total"]))])]),n(We,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=i=>F.value=i)},null,8,["modelValue"]),n(de,{right:50,bottom:50},{default:a(()=>[...e[16]||(e[16]=[p("UP",-1)])]),_:1})])}}}),Et=ae(pt,[["__scopeId","data-v-627407f4"]]);export{Et as default};
