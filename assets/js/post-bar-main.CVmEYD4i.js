import{_ as X,a as Y,b as Z,c as ee,C as te}from"./sendPost.vue_vue_type_style_index_0_scoped_3951dd6e_lang.CltTXpF5.js";import{h as k,A as ne,_ as j}from"./index.CBew2oej.js";import{a as ae}from"./setMeme.BTSbtzQA.js";import{C as se}from"./CommunityNorms.CUOXHbp7.js";import{a as N}from"./element-plus.DQRrSmQa.js";import{d as q,h as i,l as oe,i as H,al as u,c as d,o as r,Q as F,a,R as o,J as c,L as x,O as _,I as G,D as re,u as ie,f as le,ar as ce,K as de,a6 as J,P as f}from"./@vue.BltuATdo.js";import{a as me}from"./clipboard.DDFaJN9F.js";import"./pinia.DfSVr1RC.js";import"./axios.ngrFHoWO.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.oDprkwHL.js";import"./@element-plus.BgPfl9pw.js";import"./lodash-es.CDeyng3v.js";import"./@vueuse.7i1SIcsD.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.BKG3DVjA.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.D0iZPv2f.js";const ue={class:"post-form"},pe={class:"form-header"},be={key:0},ge={key:0,style:{display:"flex",gap:"10px"}},fe={class:"form-footer"},_e=["innerHTML"],ye=q({__name:"sendPost",setup(K){const C=i(!1),y=i(!1),v=i("");i(0);const h=i(!1),b=i(""),w=i(null),S=oe({filteredItems:[]}),V=()=>{k.post(ne.SEARCH_MEME,{barrage:b.value}).then(m=>{S.filteredItems=m.data.list||[]}).catch(m=>{console.error("搜索失败",m)})},A=H(()=>b.value===""?"width: 80%;":"width: 20%;"),D=H(()=>S.filteredItems.map(m=>({id:m.id,barrage:m.barrage}))),M=async()=>{if(!v.value.trim()){N.warning("内容不能为空");return}try{const m=await k.post("/machine/Post/ReviewPost/submit",{barrageId:w.value,content:v.value.trim()});m.code===200?(N.success("发帖成功！等待审核中～"),v.value=""):N.error(m.msg||"发帖失败")}catch{N.error("网络错误，发帖失败")}};return(m,n)=>{const $=u("el-input"),E=u("InfoFilled"),I=u("el-icon"),P=u("el-checkbox"),L=u("el-button"),T=u("el-cascader"),U=u("el-link"),R=u("el-card"),e=u("el-dialog");return r(),d(F,null,[a("div",ue,[o(R,null,{default:c(()=>[a("div",pe,[n[10]||(n[10]=a("h3",null,"发帖",-1)),o($,{type:"textarea",modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=t=>v.value=t),placeholder:"发布帖子...   使用AI辅助人工自动审核，请注意发言规范。",maxlength:"299","show-word-limit":""},null,8,["modelValue"]),o(P,{modelValue:h.value,"onUpdate:modelValue":n[1]||(n[1]=t=>h.value=t),size:"large"},{default:c(()=>[n[8]||(n[8]=_(" 关联烂梗 ",-1)),h.value?(r(),d("span",be,[o(I,null,{default:c(()=>[o(E)]),_:1}),n[7]||(n[7]=_(" 先在左边搜索然后右边选择一条关联⬇️",-1))])):x("",!0)]),_:1},8,["modelValue"]),h.value?(r(),d("span",ge,[o($,{modelValue:b.value,"onUpdate:modelValue":n[2]||(n[2]=t=>b.value=t),placeholder:"查找烂梗,点击搜索后右边选择关联",style:re(A.value)},null,8,["modelValue","style"]),o(L,{style:{width:"70px"},type:"primary",onClick:V},{default:c(()=>[...n[9]||(n[9]=[_("搜索",-1)])]),_:1}),S.filteredItems.length?(r(),G(T,{key:0,options:D.value,props:{checkStrictly:!0,emitPath:!1,label:"barrage",value:"id"},clearable:"",teleported:"true","popper-class":"barrage-cascader-popper",placeholder:"选择关联的烂梗",modelValue:w.value,"onUpdate:modelValue":n[3]||(n[3]=t=>w.value=t),style:{width:"100%","word-wrap":"break-word","word-break":"break-all"}},null,8,["options","modelValue"])):x("",!0)])):x("",!0)]),a("div",fe,[o(P,{modelValue:C.value,"onUpdate:modelValue":n[5]||(n[5]=t=>C.value=t),size:"large"},{default:c(()=>[n[12]||(n[12]=_(" 已同意 ",-1)),o(U,{type:"primary",onClick:n[4]||(n[4]=t=>y.value=!0)},{default:c(()=>[...n[11]||(n[11]=[_("《社区规范》",-1)])]),_:1}),n[13]||(n[13]=_(" ，不发布违反规范内容 ",-1))]),_:1},8,["modelValue"]),o(L,{type:"primary",onClick:M,disabled:C.value===!1},{default:c(()=>[...n[14]||(n[14]=[_("发布",-1)])]),_:1},8,["disabled"])])]),_:1})]),o(e,{modelValue:y.value,"onUpdate:modelValue":n[6]||(n[6]=t=>y.value=t),title:"社区规范与隐私政策",width:"800"},{default:c(()=>[a("div",{innerHTML:ie(se)},null,8,_e)]),_:1},8,["modelValue"])],64)}}}),ve=j(ye,[["__scopeId","data-v-3951dd6e"]]),he={class:"main-post"},ke={class:"post-card-header"},Ce=["src"],we={class:"post-user-name"},Se={class:"post-meta"},Ne={class:"post-createTime"},xe={style:{color:"black"}},Ve=["onClick"],Me={class:"post-content"},$e={key:0,class:"post-statements"},Ie=["src"],Pe={class:"post-footer"},Le={class:"post-footer-meta"},Be={style:{display:"flex"}},Fe=["onClick"],Ae=["src"],De={style:{cursor:"pointer"}},Ee=["onClick"],Te=["onClick"],Ue=["onClick"],Re={key:0},O=5,ze=q({__name:"post-bar-main",setup(K){const C=i(new Map),y=i(new Map),v=i([{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/7c72e4d78ebd97382d3f26e5a19811e8/7c72e4d78ebd97382d3f26e5a19811e8.gif",statementNum:"0",name:"点赞"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/db9196946fade857487d59be68b36267/db9196946fade857487d59be68b36267.gif",statementNum:"1",name:"小丑"},{url:"https://c-yuba.douyucdn.cn/yubavod/admin/common/acf317da9ad35fa498442d704d98d5d3.gif",statementNum:"2",name:"6"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/83fdf1c0f5cbe371f27e802561c77e20/83fdf1c0f5cbe371f27e802561c77e20.gif",statementNum:"3",name:"星星眼"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/5fb9b6546d750d4de5a8ef871371c582/5fb9b6546d750d4de5a8ef871371c582.gif",statementNum:"4",name:"已阅"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/d93d137765536483b8b6c1fdd0539474/d93d137765536483b8b6c1fdd0539474.gif",statementNum:"5",name:"快哭了"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/44ab7dd05057009730686e0a9b779e08/44ab7dd05057009730686e0a9b779e08.gif",statementNum:"6",name:"生气"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/a9521ac5aff85035d247362b18e7ae76/a9521ac5aff85035d247362b18e7ae76.gif",statementNum:"7",name:"问号"},{url:"https://c-yuba.douyucdn.cn/yubares/2024/06/24/922b1ee01ed1b330cf7aa37e2cf28e74/922b1ee01ed1b330cf7aa37e2cf28e74.gif",statementNum:"8",name:"吃瓜"}]),h=i([]),b=i(new Map);i({});const w=i(1),S=i(!0),V=i(!1),A=async e=>{const t=await k.get(`/machine/Post/Comment/getComment/${e}`);C.value.set(e,t.data)},D=async e=>{y.value.get(e)||await A(e),y.value.set(e,!y.value.get(e))},M=async()=>{if(!(V.value||!S.value)){V.value=!0,console.log("Loading more posts...");try{const e=await k.get("/machine/Post/list",{params:{pageNum:w.value,pageSize:O}});e.data.list.length<O&&(S.value=!1),h.value.push(...e.data.list),w.value++}catch{}finally{V.value=!1}}},m=e=>new Date(e).toLocaleString(),n=["https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab62.jpg","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab65.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab66.png","https://pic1.imgdb.cn/item/6806fcac58cb8da5c8bdab64.png","https://pic1.imgdb.cn/item/6807007258cb8da5c8bdbbbc.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce4.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce7.png","https://pic1.imgdb.cn/item/680700ab58cb8da5c8bdbce3.png","https://pic1.imgdb.cn/item/680700aa58cb8da5c8bdbce1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd7.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd6.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd1.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd5.png","https://pic1.imgdb.cn/item/680700d458cb8da5c8bdbdd3.png","https://pic1.imgdb.cn/item/680700f858cb8da5c8bdbe94.png","https://pic1.imgdb.cn/item/6807011a58cb8da5c8bdbf61.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf64.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf62.png","https://pic1.imgdb.cn/item/6807011b58cb8da5c8bdbf63.png"],$=e=>{const t=Math.floor(Math.random()*20);return n[t]},E=async e=>{if(b.value.has(e))return b.value.get(e);const g=(await k.get(`/machine/getBarrageInfo/${e}`)).data;return b.value.set(e,g),g};function I(e){e.likeFlag||k.post(`/machine/Post/like/${e.id}`).then(()=>{e.likeFlag=!0,e.postLike+=1})}const P=(e,t)=>{const p={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return!!p&&e[p]>0},L=(e,t)=>{const p={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];return p?e[p]:0},T=e=>e?v.value.filter(t=>P(e,t.statementNum)):[];function U(e,t,g){const p=h.value.find(z=>z.id===g);if(!p||!p.postStatement)return;const B={0:"btLike",1:"btJoker",2:"btSix",3:"btStar",4:"btRead",5:"btCry",6:"btAngry",7:"btQuestion",8:"btMelon"}[t];B&&k.post("/machine/Post/Statement",{portId:e,postId:g,statementNum:t}).then(()=>{p.postStatement[B]++,N.success("表态成功")})}function R(e){e&&(me(e.barrage),ae(e.id.toString()).then(()=>{N.success("复制成功")}).catch(()=>{console.log("复制失败")}))}return le(()=>{M()}),(e,t)=>{const g=u("el-tag"),p=u("el-popover"),Q=u("ArrowDownBold"),B=u("el-icon"),z=ce("infinite-scroll");return de((r(),d("div",he,[o(ve),(r(!0),d(F,null,J(h.value,s=>(r(),d("div",{key:s.id,class:"card post-card-main"},[a("div",null,[a("div",ke,[a("img",{class:"user-img",src:$(s.userName),alt:""},null,8,Ce),a("span",we,f(s.userName),1)]),a("div",Se,[a("span",Ne,f(m(s.createTime)),1),o(p,{placement:"top-start",trigger:"hover",width:"auto",onBeforeEnter:l=>E(s.barrageId)},{reference:c(()=>[s.barrage?(r(),G(g,{key:0,effect:"dark",round:"",color:"#00FFFF",class:"meme-tag"},{default:c(()=>[a("span",xe,"#烂梗："+f(s.barrage),1)]),_:2},1024)):x("",!0)]),default:c(()=>{var l;return[a("div",{style:{cursor:"pointer"},onClick:W=>R(b.value.get(s.barrageId))},f((l=b.value.get(s.barrageId))==null?void 0:l.barrage),9,Ve)]}),_:2},1032,["onBeforeEnter"])])]),a("span",Me,f(s.content),1),s.postStatement?(r(),d("div",$e,[(r(!0),d(F,null,J(T(s.postStatement),l=>(r(),d("span",{key:l.statementNum,style:{display:"flex","align-items":"center","margin-right":"10px"}},[o(g,{round:""},{default:c(()=>[a("img",{src:l.url},null,8,Ie),a("span",null,f(L(s.postStatement,l.statementNum)),1)]),_:2},1024)]))),128))])):x("",!0),a("div",Pe,[a("div",Le,[o(p,{placement:"top-start",trigger:"hover",width:"auto",content:""},{default:c(()=>[a("div",Be,[(r(!0),d(F,null,J(v.value,l=>(r(),d("div",{key:l.statementNum,style:{"margin-right":"10px"}},[a("span",{style:{display:"flex","flex-direction":"column","align-items":"center"},onClick:W=>U(s.id,l.statementNum,s.id)},[a("img",{style:{width:"30px",cursor:"pointer"},src:l.url},null,8,Ae),a("span",De,f(l.name),1)],8,Fe)]))),128))])]),reference:c(()=>[...t[1]||(t[1]=[a("span",null,[a("img",{src:X}),_(" 表态")],-1)])]),_:2},1024),a("span",{style:{cursor:"pointer"},onClick:l=>D(s.id)},[t[2]||(t[2]=a("img",{src:Y},null,-1)),a("span",null," "+f(s.commentCount),1)],8,Ee),s.likeFlag?(r(),d("span",{key:0,style:{cursor:"not-allowed"},onClick:l=>I(s)},[t[3]||(t[3]=a("img",{src:Z},null,-1)),a("span",null," "+f(s.postLike),1)],8,Te)):(r(),d("span",{key:1,style:{cursor:"pointer"},onClick:l=>I(s)},[t[4]||(t[4]=a("img",{src:ee},null,-1)),_(" "+f(s.postLike),1)],8,Ue))]),y.value.get(s.id)?(r(),d("div",Re,[o(te,{comments:C.value.get(s.id)||[],"post-id":s.id},null,8,["comments","post-id"])])):x("",!0)])]))),128)),a("div",{class:"card post-card-main",style:{"text-align":"center",cursor:"pointer",color:"orangered"},onClick:t[0]||(t[0]=s=>M())},[t[5]||(t[5]=_("加载更多",-1)),o(B,null,{default:c(()=>[o(Q)]),_:1})])])),[[z,M]])}}}),ct=j(ze,[["__scopeId","data-v-c0216444"]]);export{ct as default};
