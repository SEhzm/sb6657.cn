import{y as D,A as z,B as j,s as q,x as G,a as I,h as H,b as M,f as O,e as W,g as J,i as K,C as X,v as Z}from"./element-plus.CxvSu1tc.js";import{d as L,ay as Y,X as ee,o as w,G as k,H as a,a as C,P as e,L as c,k as te,r as g,w as oe,c as ae,u as le,K as B,I as ne,M as A,V as re}from"./@vue.BkZGu_Ap.js";import{u as se,b as ie}from"./vue-router.CJ_8Ucol.js";import{h as ue,a as ce,M as me,_ as pe}from"./index.BET8SP_O.js";import{e as de,f as _e,h as fe,c as ge,a as F,p as ve,t as be,l as ye,b as we}from"./flip-num.m-dM1KzK.js";import"./lodash-es.C-zDejYo.js";import"./@vueuse.B3BMR0ps.js";import"./@element-plus.imH8POSc.js";import"./@popperjs.D9SI2xQl.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DXEKZA6n.js";import"./async-validator.DKvM95Vc.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.B6fDCfyv.js";import"./@floating-ui.8uccrNCM.js";import"./axios.CCb-kr4I.js";import"./fireworks-js.1hhxDOOS.js";const Ce={class:"dialog-footer"},Ve=L({__name:"submission-dialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(U){const i=Y(U,"modelValue"),x={category:[{required:!0,message:"请选择分栏",trigger:"blur"}],content:[{required:!0,message:"请输入弹幕",trigger:"blur"}]},r=ee({category:"",content:""});async function d(){return r.content===""?(M.error("烂梗内容不能为空"),!1):r.category===""?(M.error("分类不能为空"),!1):await de(r.category,r.content)?(M.success("投稿成功，审核完成后展示(一天内)"),!0):(M.error("投稿失败，必要时请及时反馈bug"),!1)}async function _(){await d()&&(i.value=!1,r.content="",r.category="")}async function V(){await d()&&(r.content="")}return(m,o)=>{const s=D,v=z,h=j,T=q,P=G,f=I,b=H;return w(),k(b,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=p=>i.value=p),draggable:"",title:"投稿弹幕",width:"82%"},{footer:a(()=>[C("div",Ce,[e(f,{onClick:o[2]||(o[2]=p=>i.value=!1)},{default:a(()=>o[4]||(o[4]=[c("关闭")])),_:1}),e(f,{type:"primary",onClick:_},{default:a(()=>o[5]||(o[5]=[c("投稿并关闭")])),_:1}),e(f,{type:"primary",onClick:V},{default:a(()=>o[6]||(o[6]=[c("连续投稿")])),_:1})])]),default:a(()=>[e(P,{model:r,"label-width":"100px",rules:x,"label-position":"right"},{default:a(()=>[e(h,{label:"分栏","label-width":100,prop:"category"},{default:a(()=>[e(v,{modelValue:r.category,"onUpdate:modelValue":o[0]||(o[0]=p=>r.category=p),placeholder:"选择上传的分栏"},{default:a(()=>[e(s,{label:"喷玩机器篇",value:"machine_penWJQ"}),e(s,{label:"木柜子篇",value:"machine_mygo"}),e(s,{label:"直播间互喷篇",value:"machine_ZbjHuPen"}),e(s,{label:"喷选手篇",value:"machine_penPlayer"}),e(s,{label:"+1",value:"machine_p1"}),e(s,{label:"群魔乱舞篇",value:"machine_QMLW"}),e(s,{label:"QUQU",value:"machine_QUQU"})]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"弹幕内容",prop:"content"},{default:a(()=>[e(T,{maxlength:"255",modelValue:r.content,"onUpdate:modelValue":o[1]||(o[1]=p=>r.content=p),autocomplete:"off",autosize:{minRows:2,maxRows:4},"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),he={class:"memes-view"},Ee={class:"card-table"},Me={class:"top"},ke={class:"pagination-wrapper"},y=50,xe=L({__name:"memes-view",setup(U){const i=se(),x=ie(),r=te(()=>me.find(l=>l.path===i.path)),d=g(!0),_=g([]),V=g(0),m=g(1),o=g(!1);async function s(l){var E;const t=(E=r.value)==null?void 0:E.category;if(!t){x.push("/404");return}const n=await fe(t,l,y);n&&(_.value=n.memeArr,V.value=n.total,d.value=!1)}s(1);async function v(l){ue.get(ce.GET_SORTED_ALL_MEME,{params:{pageNum:l,pageSize:y,order:"desc"}}).then(t=>{o.value=!0,_.value=t.data.list.map(n=>({total:n.total,content:n.barrage,id:n.id,copyCount:+n.cnt}))}).catch(t=>{_.value=[]})}oe(()=>i.path,()=>{console.log("当前页面path:",i.path),o.value=!1,m.value=1,d.value=!0,s(1)});const h=()=>{window.scrollTo({top:0,behavior:"smooth"})},T=l=>{m.value=l,h(),o.value==!1?s(l):v(l)},P=be(we,ye,2e3);async function f(l){const t=l.content,n=P(t);if(!(!n||n==="limitedSuccess")){if(ge(),o.value==!0){if(await F("allbarrage",l.id,m.value,y,"desc")){await v(m.value);return}}else if(await F(l.category,l.id,m.value,y)){await s(m.value);return}ve()}}const b=g(!1),p=()=>{b.value=!0};return(l,t)=>{const n=I,E=O,S=W,N=J,Q=K,R=X,$=Z;return w(),ae("div",he,[C("div",Ee,[C("div",Me,[t[4]||(t[4]=C("div",{class:"submit-tips"},"想要补充更多烂梗？点击这里投稿→",-1)),e(n,{type:"primary",onClick:p},{default:a(()=>t[2]||(t[2]=[c("烂梗投稿")])),_:1}),le(i).path==="/memes/AllBarrage"?(w(),k(n,{key:0,class:"btn-animate btn-animate__ball-collision",color:"#66CCFF",onClick:t[0]||(t[0]=u=>v(1))},{default:a(()=>t[3]||(t[3]=[c("按复制次数排序")])),_:1})):B("",!0)]),ne((w(),k(N,{class:"main-table",data:_.value,stripe:"","cell-class-name":"hover-pointer",onRowClick:f},{default:a(()=>[e(S,{align:"center",width:"60"},{default:a(u=>[e(E,{round:"",effect:"plain"},{default:a(()=>[c(A(u.row.id),1)]),_:2},1024)]),_:1}),e(S,{prop:"content"},{default:a(u=>[c(A(u.row.content),1)]),_:1}),e(S,{align:"center",width:"100"},{default:a(u=>[e(n,{type:"primary",class:"copy-btn",onClick:re(Te=>f(u.row),["stop"])},{default:a(()=>[t[5]||(t[5]=c("复制 🎈")),e(_e,{num:u.row.copyCount},null,8,["num"])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,d.value]]),C("div",ke,[d.value?B("",!0):(w(),k(Q,{key:0,background:"red",layout:"prev, pager, next, jumper","current-page":m.value,total:V.value,"pager-count":4,"page-size":y,onCurrentChange:T},null,8,["current-page","total"]))])]),e(Ve,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=u=>b.value=u)},null,8,["modelValue"]),e(R,{right:50,bottom:50},{default:a(()=>t[6]||(t[6]=[c("UP")])),_:1})])}}}),He=pe(xe,[["__scopeId","data-v-4459003d"]]);export{He as default};
