import{d as K,r as n,i as Q,c as u,o as i,a,K as Y,M as f,P as C,a6 as V,O as z,J as E,ak as X,ac as Z,V as ee,Q as g,I as L,u as p,H as te,D as ae,n as R}from"./@vue.Ca5AQEsS.js";import{h as U,_ as se}from"./index.B-OWe_n7.js";import{A as I,B as O,a as P}from"./element-plus.pEMcb2g5.js";import"./pinia.Dz8zdBJG.js";import"./axios.xsH4HHeE.js";import"./js-cookie.Cz0CWeBA.js";import"./vue-router.DhOS9MZH.js";import"./@element-plus.w7YOadmw.js";import"./lodash-es.S0Y0Up6J.js";import"./@vueuse.BFkoDYlQ.js";import"./@popperjs.D_chPuIy.js";import"./@ctrl.r5W6hzzQ.js";import"./dayjs.DcnvBwdO.js";import"./async-validator.9PlIezaS.js";import"./memoize-one.BdPwpGay.js";import"./normalize-wheel-es.BQoi3Ox2.js";import"./@floating-ui.58V2siOx.js";const H="/assets/png/user-img-0.DNvIIjpW.png",le="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1750002304231'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5531'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M1024%20544c0%20265.12-214.944%20480-480%20480h-64C214.912%201024%200%20809.12%200%20544v-64C0%20214.912%20214.912%200%20480%200h64c265.056%200%20480%20214.912%20480%20480v64z'%20fill='%23085684'%20p-id='5532'%3e%3c/path%3e%3cpath%20d='M512.032%20160a216.896%20216.896%200%200%200-216.64%20216.64%20216.896%20216.896%200%200%200%20216.64%20216.608c119.424%200%20216.672-97.248%20216.672-216.608A216.96%20216.96%200%200%200%20512.032%20160z'%20fill='%23FFFFFF'%20p-id='5533'%3e%3c/path%3e%3cpath%20d='M678.976%20588.256c-46.112%2036.512-103.584%2059.104-166.944%2059.104s-120.768-22.656-167.04-59.104c-87.584%2055.776-148.544%20153.696-156.928%20267.104%2030.656%204.16%2085.248%208.64%20163.104%208.64h321.568c77.92%200%20132.512-4.48%20163.232-8.672-8.32-113.44-69.312-211.296-156.992-267.072z'%20fill='%23FFFFFF'%20p-id='5534'%3e%3c/path%3e%3c/svg%3e",oe={class:"chatgpt-container"},ne={key:0,class:"bubble ai-bubble"},ie=["innerHTML"],re={key:1,class:"bubble user-bubble"},ue={class:"bubble-content"},de={key:0,class:"message ai"},ce={class:"bubble ai-bubble"},me={class:"bubble-content"},pe=["disabled"],ve=["disabled"],be={class:"reasoning"},fe=["disabled"],ge={class:"controls-container"},he={class:"control-item"},we={class:"control-item"},ye=K({__name:"AIChat",setup(ke){const v=n([]),d=n(""),s=n(!1),r=n(""),h=n(!1),w=n(null),b=n(3),y=n([]),c=n(""),W=l=>{let e=l;return e=e.replace(/<think>/g,""),e=e.replace(/<\/think>/g,""),e=e.replace(/(\d+)\s*\n\s*\.\s*\n?\s*/g,"$1. "),e=e.replace(/(\d+)\s*\.\s*/g,"$1. "),e=e.replace(/^\s+/,""),e=e.replace(/\n{3,}/g,`

`),e=e.split(`
`).map(t=>t.trim()).join(`
`),e=e.replace(/^\s+|\s+$/g,""),e.trim()},k=async()=>{var l;await R(),(l=w.value)==null||l.scrollTo({top:w.value.scrollHeight,behavior:"smooth"})},$=async()=>{if(!d.value.trim()||s.value)return;const l=d.value;v.value.push({role:"user",content:l}),d.value="",r.value="",s.value=!0,await R(),k();let e=0;const t=1;let m=null;const x=async()=>{const M=localStorage.getItem("Admin-Token");if(!M){P.warning("请先登录！"),s.value=!1;return}try{const o=new URLSearchParams;o.append("prompt",l),o.append("needReasoning",String(h.value)),o.append("memesNum",String(b.value)),c.value!==""&&o.append("tag",c.value);const _=await fetch(`${U.defaults.baseURL}/suanli/stream`,{method:"POST",headers:{Authorization:M},body:o});if(_.code===401){P.warning("请先登录！"),s.value=!1;return}if(!_.body)throw new Error("响应流为空");let S="";const G=new TextDecoder("utf-8"),j=_.body.getReader();for(;;){const{done:J,value:q}=await j.read();if(J)break;G.decode(q,{stream:!0}).split("data:").forEach(A=>{var D,N,B;if(A.trim())try{const T=JSON.parse(A.trim());(B=(N=(D=T.choices)==null?void 0:D[0])==null?void 0:N.delta)!=null&&B.content&&(S+=T.choices[0].delta.content,r.value=S)}catch{}})}v.value.push({role:"ai",content:W(r.value)}),r.value=""}catch(o){e<t?(console.warn("请求失败，正在重试...",o),e++,setTimeout(x,1e3)):r.value="请求失败："+((o==null?void 0:o.message)||o)}finally{s.value=!1,k(),m&&clearTimeout(m)}};m=setTimeout(()=>{s.value&&(console.warn("AI响应超时，此刻算力不足，请重试..."),e<t?(e++,x()):(r.value="AI响应超时，此刻算力不足，请重试。",s.value=!1,k()))},9e4),x()},F=async()=>{v.value=[],d.value="",r.value="",s.value=!1,b.value=3,c.value="",y.value=[];try{const l=await U.get("/machine/dictList");l.data&&l.code===200&&(y.value=l.data)}catch(l){console.error("获取标签列表失败:",l)}};return Q(()=>{F()}),(l,e)=>(i(),u("div",oe,[a("div",{class:"chat-window",ref_key:"chatWindow",ref:w},[a("div",{class:"ai-welcome-message"},[e[4]||(e[4]=f(" AI造梗助手Demo（32B模型，算力一般）")),e[5]||(e[5]=a("span",{style:{"font-size":"small"}},[f("每天50次"),a("span",{style:{"font-size":"smaller"}},"(成本不低..)")],-1)),e[6]||(e[6]=a("b",null,"卡了可以刷新",-1)),a("button",{class:"refresh-button",onClick:F}," 刷新 ")]),(i(!0),u(C,null,V(v.value,(t,m)=>(i(),u("div",{key:m,class:ae(["message",t.role])},[t.role==="ai"?(i(),u("div",ne,[e[7]||(e[7]=a("img",{class:"avatar",src:H,alt:"AI"},null,-1)),a("div",{class:"bubble-content",innerHTML:t.content},null,8,ie)])):(i(),u("div",re,[e[8]||(e[8]=a("img",{class:"avatar",src:le,alt:"你"},null,-1)),a("div",ue,z(t.content),1)]))],2))),128)),s.value?(i(),u("div",de,[a("div",ce,[e[10]||(e[10]=a("img",{class:"avatar",src:H,alt:"AI"},null,-1)),a("div",me,[f(z(r.value),1),e[9]||(e[9]=a("span",{class:"cursor"},"|",-1))])])])):Y("",!0)],512),a("form",{class:"input-form",onSubmit:ee($,["prevent"])},[E(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"请输入…",disabled:s.value,autocomplete:"off"},null,8,pe),[[X,d.value]]),a("button",{disabled:s.value||!d.value.trim(),type:"submit"}," 发送 ",8,ve),a("label",be,[E(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),disabled:s.value},null,8,fe),[[Z,h.value]]),e[11]||(e[11]=f(" 需要查看思考过程 "))])],32),e[14]||(e[14]=a("span",{style:{"font-size":"small","text-align":"center","user-select":"none"}},"服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，不代表我们的态度或观点。",-1)),a("div",ge,[a("div",he,[e[12]||(e[12]=a("label",{for:"memesNum"},"造梗数量:",-1)),g(p(O),{id:"memesNum",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),disabled:s.value,placeholder:"选择梗数量"},{default:L(()=>[(i(),u(C,null,V(10,t=>g(p(I),{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue","disabled"])]),a("div",we,[e[13]||(e[13]=a("label",{for:"tagSelect"},"梗标签:",-1)),g(p(O),{id:"tagSelect",modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),disabled:s.value,placeholder:"全部"},{default:L(()=>[g(p(I),{label:"全部",value:""}),(i(!0),u(C,null,V(y.value,t=>(i(),te(p(I),{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])]))}}),Oe=se(ye,[["__scopeId","data-v-7edf3a6a"]]);export{Oe as default};
